
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="🛰️ Process raster data in python">
      
      
        <meta name="author" content="Gonzalo Mateo-García">
      
      
        <link rel="canonical" href="https://spaceml-org.github.io/georeader/modules/readers_module/">
      
      
        <link rel="prev" href="../ee_image/">
      
      
        <link rel="next" href="../../read_overlapping_probav_and_sentinel2/">
      
      
      <link rel="icon" href="../../images/logo_georeader.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.43">
    
    
      
        <title>readers - georeader</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="readers - georeader" >
      
        <meta  property="og:description"  content="🛰️ Process raster data in python" >
      
        <meta  property="og:image"  content="https://spaceml-org.github.io/georeader/assets/images/social/modules/readers_module.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://spaceml-org.github.io/georeader/modules/readers_module/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="readers - georeader" >
      
        <meta  name="twitter:description"  content="🛰️ Process raster data in python" >
      
        <meta  name="twitter:image"  content="https://spaceml-org.github.io/georeader/assets/images/social/modules/readers_module.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#satellite-data-readers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="georeader" class="md-header__button md-logo" aria-label="georeader" data-md-component="logo">
      
  <img src="../../images/logo_georeader.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            georeader
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              readers
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/spaceml-org/georeader" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    spaceml-org/georeader
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="georeader" class="md-nav__button md-logo" aria-label="georeader" data-md-component="logo">
      
  <img src="../../images/logo_georeader.png" alt="logo">

    </a>
    georeader
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spaceml-org/georeader" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    spaceml-org/georeader
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../read_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    read
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../save_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    save
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reflectance_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reflectance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geotensor_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GeoTensor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rasterio_reader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RasterioReader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rasterize_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rasterize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vectorize_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vectorize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ee_image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ee_image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    readers
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    readers
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sentinel-2-reader" class="md-nav__link">
    <span class="md-ellipsis">
      Sentinel-2 Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sentinel-2 Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader" class="md-nav__link">
    <span class="md-ellipsis">
      S2_SAFE_reader
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image" class="md-nav__link">
    <span class="md-ellipsis">
      S2Image
    </span>
  </a>
  
    <nav class="md-nav" aria-label="S2Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.cache_product_to_local_dir" class="md-nav__link">
    <span class="md-ellipsis">
      cache_product_to_local_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.get_reader" class="md-nav__link">
    <span class="md-ellipsis">
      get_reader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.quantification_value" class="md-nav__link">
    <span class="md-ellipsis">
      quantification_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.read_from_band_names" class="md-nav__link">
    <span class="md-ellipsis">
      read_from_band_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.solar_irradiance" class="md-nav__link">
    <span class="md-ellipsis">
      solar_irradiance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C" class="md-nav__link">
    <span class="md-ellipsis">
      S2ImageL1C
    </span>
  </a>
  
    <nav class="md-nav" aria-label="S2ImageL1C">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C.cache_product_to_local_dir" class="md-nav__link">
    <span class="md-ellipsis">
      cache_product_to_local_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C.read_metadata_tl" class="md-nav__link">
    <span class="md-ellipsis">
      read_metadata_tl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2ImageL2A" class="md-nav__link">
    <span class="md-ellipsis">
      S2ImageL2A
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.s2loader" class="md-nav__link">
    <span class="md-ellipsis">
      s2loader
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.s2_public_bucket_path" class="md-nav__link">
    <span class="md-ellipsis">
      s2_public_bucket_path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.read_srf" class="md-nav__link">
    <span class="md-ellipsis">
      read_srf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proba-v-reader" class="md-nav__link">
    <span class="md-ellipsis">
      Proba-V Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proba-V Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_1" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational" class="md-nav__link">
    <span class="md-ellipsis">
      probav_image_operational
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaV" class="md-nav__link">
    <span class="md-ellipsis">
      ProbaV
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProbaV">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaV.load_mask" class="md-nav__link">
    <span class="md-ellipsis">
      load_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaV.load_sm" class="md-nav__link">
    <span class="md-ellipsis">
      load_sm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaV.save_bands" class="md-nav__link">
    <span class="md-ellipsis">
      save_bands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaVRadiometry" class="md-nav__link">
    <span class="md-ellipsis">
      ProbaVRadiometry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaVSM" class="md-nav__link">
    <span class="md-ellipsis">
      ProbaVSM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spot-vgt-reader" class="md-nav__link">
    <span class="md-ellipsis">
      SPOT-VGT Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SPOT-VGT Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_2" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.spotvgt_image_operational" class="md-nav__link">
    <span class="md-ellipsis">
      spotvgt_image_operational
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.spotvgt_image_operational.SpotVGT" class="md-nav__link">
    <span class="md-ellipsis">
      SpotVGT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpotVGT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.spotvgt_image_operational.SpotVGT.load_mask" class="md-nav__link">
    <span class="md-ellipsis">
      load_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.spotvgt_image_operational.SpotVGT.load_sm" class="md-nav__link">
    <span class="md-ellipsis">
      load_sm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prisma-reader" class="md-nav__link">
    <span class="md-ellipsis">
      PRISMA Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PRISMA Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_3" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.prisma" class="md-nav__link">
    <span class="md-ellipsis">
      prisma
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.prisma.PRISMA" class="md-nav__link">
    <span class="md-ellipsis">
      PRISMA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PRISMA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.prisma.PRISMA.load_raw" class="md-nav__link">
    <span class="md-ellipsis">
      load_raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.prisma.PRISMA.load_wavelengths" class="md-nav__link">
    <span class="md-ellipsis">
      load_wavelengths
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emit-reader" class="md-nav__link">
    <span class="md-ellipsis">
      EMIT Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EMIT Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_4" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit" class="md-nav__link">
    <span class="md-ellipsis">
      emit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage" class="md-nav__link">
    <span class="md-ellipsis">
      EMITImage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EMITImage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.mask_bands" class="md-nav__link">
    <span class="md-ellipsis">
      mask_bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.mean_sza" class="md-nav__link">
    <span class="md-ellipsis">
      mean_sza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.mean_vza" class="md-nav__link">
    <span class="md-ellipsis">
      mean_vza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.nc_ds_l2amask" class="md-nav__link">
    <span class="md-ellipsis">
      nc_ds_l2amask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.nc_ds_obs" class="md-nav__link">
    <span class="md-ellipsis">
      nc_ds_obs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.observation_bands" class="md-nav__link">
    <span class="md-ellipsis">
      observation_bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.percentage_clear" class="md-nav__link">
    <span class="md-ellipsis">
      percentage_clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.shape_raw" class="md-nav__link">
    <span class="md-ellipsis">
      shape_raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.footprint" class="md-nav__link">
    <span class="md-ellipsis">
      footprint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.georreference" class="md-nav__link">
    <span class="md-ellipsis">
      georreference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.invalid_mask_raw" class="md-nav__link">
    <span class="md-ellipsis">
      invalid_mask_raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.load_raw" class="md-nav__link">
    <span class="md-ellipsis">
      load_raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.mask" class="md-nav__link">
    <span class="md-ellipsis">
      mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.observation" class="md-nav__link">
    <span class="md-ellipsis">
      observation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.set_band_selection" class="md-nav__link">
    <span class="md-ellipsis">
      set_band_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.sza" class="md-nav__link">
    <span class="md-ellipsis">
      sza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.to_crs" class="md-nav__link">
    <span class="md-ellipsis">
      to_crs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.validmask" class="md-nav__link">
    <span class="md-ellipsis">
      validmask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.vza" class="md-nav__link">
    <span class="md-ellipsis">
      vza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.water_mask" class="md-nav__link">
    <span class="md-ellipsis">
      water_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.download_product" class="md-nav__link">
    <span class="md-ellipsis">
      download_product
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.get_radiance_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_radiance_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.get_obs_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_obs_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.get_ch4enhancement_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_ch4enhancement_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.get_l2amask_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_l2amask_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.valid_mask" class="md-nav__link">
    <span class="md-ellipsis">
      valid_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enmap-reader" class="md-nav__link">
    <span class="md-ellipsis">
      EnMAP Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnMAP Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_5" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.enmap" class="md-nav__link">
    <span class="md-ellipsis">
      enmap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.enmap.EnMAP" class="md-nav__link">
    <span class="md-ellipsis">
      EnMAP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnMAP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.enmap.EnMAP.load_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      load_rgb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.enmap.EnMAP.load_wavelengths" class="md-nav__link">
    <span class="md-ellipsis">
      load_wavelengths
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Read overlapping rasters
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Read overlapping rasters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../read_overlapping_probav_and_sentinel2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overlapping S2 and Proba-V
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reading_overlapping_sentinel2_aviris/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overlapping S2 and AVIRIS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/tiling_and_stitching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tile and stitch AI predictions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sentinel-2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Sentinel-2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sentinel-2/run_in_gee_image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    From Google Earth Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../read_S2_SAFE_from_bucket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    From the public bucket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sentinel-2/explore_metadata_s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sentinel-2/query_mosaic_s2_images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mosaic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sentinel-2/s2_mosaic_from_gee/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mosaic from GEE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sentinel-2/convert_to_radiance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ToA reflectance to radiance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hyperspectral sensors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Hyperspectral sensors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../emit_explore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMIT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simultaneous_prisma_emit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PRISMA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../enmap_with_cloudsen12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EnMAP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prisma_with_cloudsen12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PRISMA cloud detection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/error_read_write_in_remote_path/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSIL cache problem
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sentinel-2-reader" class="md-nav__link">
    <span class="md-ellipsis">
      Sentinel-2 Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sentinel-2 Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader" class="md-nav__link">
    <span class="md-ellipsis">
      S2_SAFE_reader
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image" class="md-nav__link">
    <span class="md-ellipsis">
      S2Image
    </span>
  </a>
  
    <nav class="md-nav" aria-label="S2Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.cache_product_to_local_dir" class="md-nav__link">
    <span class="md-ellipsis">
      cache_product_to_local_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.get_reader" class="md-nav__link">
    <span class="md-ellipsis">
      get_reader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.quantification_value" class="md-nav__link">
    <span class="md-ellipsis">
      quantification_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.read_from_band_names" class="md-nav__link">
    <span class="md-ellipsis">
      read_from_band_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2Image.solar_irradiance" class="md-nav__link">
    <span class="md-ellipsis">
      solar_irradiance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C" class="md-nav__link">
    <span class="md-ellipsis">
      S2ImageL1C
    </span>
  </a>
  
    <nav class="md-nav" aria-label="S2ImageL1C">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C.cache_product_to_local_dir" class="md-nav__link">
    <span class="md-ellipsis">
      cache_product_to_local_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C.read_metadata_tl" class="md-nav__link">
    <span class="md-ellipsis">
      read_metadata_tl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.S2ImageL2A" class="md-nav__link">
    <span class="md-ellipsis">
      S2ImageL2A
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.s2loader" class="md-nav__link">
    <span class="md-ellipsis">
      s2loader
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.s2_public_bucket_path" class="md-nav__link">
    <span class="md-ellipsis">
      s2_public_bucket_path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.S2_SAFE_reader.read_srf" class="md-nav__link">
    <span class="md-ellipsis">
      read_srf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proba-v-reader" class="md-nav__link">
    <span class="md-ellipsis">
      Proba-V Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proba-V Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_1" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational" class="md-nav__link">
    <span class="md-ellipsis">
      probav_image_operational
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaV" class="md-nav__link">
    <span class="md-ellipsis">
      ProbaV
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProbaV">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaV.load_mask" class="md-nav__link">
    <span class="md-ellipsis">
      load_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaV.load_sm" class="md-nav__link">
    <span class="md-ellipsis">
      load_sm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaV.save_bands" class="md-nav__link">
    <span class="md-ellipsis">
      save_bands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaVRadiometry" class="md-nav__link">
    <span class="md-ellipsis">
      ProbaVRadiometry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.probav_image_operational.ProbaVSM" class="md-nav__link">
    <span class="md-ellipsis">
      ProbaVSM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spot-vgt-reader" class="md-nav__link">
    <span class="md-ellipsis">
      SPOT-VGT Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SPOT-VGT Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_2" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.spotvgt_image_operational" class="md-nav__link">
    <span class="md-ellipsis">
      spotvgt_image_operational
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.spotvgt_image_operational.SpotVGT" class="md-nav__link">
    <span class="md-ellipsis">
      SpotVGT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpotVGT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.spotvgt_image_operational.SpotVGT.load_mask" class="md-nav__link">
    <span class="md-ellipsis">
      load_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.spotvgt_image_operational.SpotVGT.load_sm" class="md-nav__link">
    <span class="md-ellipsis">
      load_sm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prisma-reader" class="md-nav__link">
    <span class="md-ellipsis">
      PRISMA Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PRISMA Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_3" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.prisma" class="md-nav__link">
    <span class="md-ellipsis">
      prisma
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.prisma.PRISMA" class="md-nav__link">
    <span class="md-ellipsis">
      PRISMA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PRISMA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.prisma.PRISMA.load_raw" class="md-nav__link">
    <span class="md-ellipsis">
      load_raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.prisma.PRISMA.load_wavelengths" class="md-nav__link">
    <span class="md-ellipsis">
      load_wavelengths
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emit-reader" class="md-nav__link">
    <span class="md-ellipsis">
      EMIT Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EMIT Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_4" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit" class="md-nav__link">
    <span class="md-ellipsis">
      emit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage" class="md-nav__link">
    <span class="md-ellipsis">
      EMITImage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EMITImage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.mask_bands" class="md-nav__link">
    <span class="md-ellipsis">
      mask_bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.mean_sza" class="md-nav__link">
    <span class="md-ellipsis">
      mean_sza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.mean_vza" class="md-nav__link">
    <span class="md-ellipsis">
      mean_vza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.nc_ds_l2amask" class="md-nav__link">
    <span class="md-ellipsis">
      nc_ds_l2amask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.nc_ds_obs" class="md-nav__link">
    <span class="md-ellipsis">
      nc_ds_obs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.observation_bands" class="md-nav__link">
    <span class="md-ellipsis">
      observation_bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.percentage_clear" class="md-nav__link">
    <span class="md-ellipsis">
      percentage_clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.shape_raw" class="md-nav__link">
    <span class="md-ellipsis">
      shape_raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.footprint" class="md-nav__link">
    <span class="md-ellipsis">
      footprint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.georreference" class="md-nav__link">
    <span class="md-ellipsis">
      georreference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.invalid_mask_raw" class="md-nav__link">
    <span class="md-ellipsis">
      invalid_mask_raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.load_raw" class="md-nav__link">
    <span class="md-ellipsis">
      load_raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.mask" class="md-nav__link">
    <span class="md-ellipsis">
      mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.observation" class="md-nav__link">
    <span class="md-ellipsis">
      observation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.set_band_selection" class="md-nav__link">
    <span class="md-ellipsis">
      set_band_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.sza" class="md-nav__link">
    <span class="md-ellipsis">
      sza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.to_crs" class="md-nav__link">
    <span class="md-ellipsis">
      to_crs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.validmask" class="md-nav__link">
    <span class="md-ellipsis">
      validmask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.vza" class="md-nav__link">
    <span class="md-ellipsis">
      vza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.emit.EMITImage.water_mask" class="md-nav__link">
    <span class="md-ellipsis">
      water_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.download_product" class="md-nav__link">
    <span class="md-ellipsis">
      download_product
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.get_radiance_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_radiance_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.get_obs_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_obs_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.get_ch4enhancement_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_ch4enhancement_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.get_l2amask_link" class="md-nav__link">
    <span class="md-ellipsis">
      get_l2amask_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.emit.valid_mask" class="md-nav__link">
    <span class="md-ellipsis">
      valid_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enmap-reader" class="md-nav__link">
    <span class="md-ellipsis">
      EnMAP Reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnMAP Reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-reference_5" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.enmap" class="md-nav__link">
    <span class="md-ellipsis">
      enmap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#georeader.readers.enmap.EnMAP" class="md-nav__link">
    <span class="md-ellipsis">
      EnMAP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnMAP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#georeader.readers.enmap.EnMAP.load_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      load_rgb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#georeader.readers.enmap.EnMAP.load_wavelengths" class="md-nav__link">
    <span class="md-ellipsis">
      load_wavelengths
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="satellite-data-readers">Satellite Data Readers<a class="headerlink" href="#satellite-data-readers" title="Permanent link">&para;</a></h1>
<p>This module provides specialized readers for various optical satellite missions. All these readers implement the <a href="../read_module/">GeoData protocol</a>, which means they provide a consistent interface for spatial operations, data access, and manipulation.</p>
<p>These readers make it easy to work with official data formats from different Earth observation missions, and they can be used with all the functions available in the <code>georeader.read</code> module.</p>
<p>Readers available:</p>
<ul>
<li><a href="#sentinel-2-reader">Sentinel-2</a></li>
<li><a href="#proba-v-reader">Proba-V</a></li>
<li><a href="#spot-vgt-reader">SpotVGT</a></li>
<li><a href="#emit-reader">EMIT</a></li>
<li><a href="#prisma-reader">PRISMA</a></li>
<li><a href="#enmap-reader">EnMAP</a></li>
</ul>
<h2 id="sentinel-2-reader">Sentinel-2 Reader<a class="headerlink" href="#sentinel-2-reader" title="Permanent link">&para;</a></h2>
<p>The Sentinel-2 reader provides functionality for reading Sentinel-2 L1C and L2A products in SAFE format. It supports:</p>
<ul>
<li>Direct reading from local files or cloud storage (Google Cloud Storage)</li>
<li>Windowed reading for efficient memory usage</li>
<li>Conversion from digital numbers to radiance</li>
<li>Access to metadata, including viewing geometry and solar angles</li>
</ul>
<p><strong>Tutorial examples:</strong></p>
<ul>
<li><a href="../../read_S2_SAFE_from_bucket/">Reading from the public Google bucket</a></li>
<li><a href="../../Sentinel-2/explore_metadata_s2/">Exploring image metadata</a></li>
<li><a href="../../Sentinel-2/query_mosaic_s2_images/">Creating mosaics from multiple images</a></li>
<li><a href="../../Sentinel-2/convert_to_radiance/">Converting TOA reflectance to radiance</a></li>
</ul>
<h3 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="georeader.readers.S2_SAFE_reader"></a>
    <div class="doc doc-contents first">

        <p>Sentinel-2 reader inherited from https://github.com/IPL-UV/DL-L8S2-UV.</p>
<p>Authors: Gonzalo Mateo-García, Dan Lopez-Puigdollers</p>
<p>It has several enhancements:</p>
<ul>
<li>Support for S2L2A images</li>
<li>It can read directly images from a GCP bucket (for example data from  <a href="https://cloud.google.com/storage/docs/public-datasets/sentinel-2">here</a>)</li>
<li>Windowed read and read and reproject in the same function (see <code>load_bands_bbox</code>)</li>
<li>Creation of the image only involves reading one metadata file (<code>xxx.SAFE/MTD_{self.producttype}.xml</code>)</li>
<li>Compatible with <code>georeader.read</code> functions</li>
<li>It can read from the pyramid if available.</li>
</ul>
<p><a href="https://sentinel.esa.int/web/sentinel/user-guides/sentinel-2-msi/document-library">Sentinel-2 docs</a></p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="georeader.readers.S2_SAFE_reader.S2Image" class="doc doc-heading">
            <code>S2Image</code>


<a href="#georeader.readers.S2_SAFE_reader.S2Image" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Base Sentinel-2 image reader for handling Sentinel-2 satellite products.
Do Not use this class directly, use S2ImageL1C or S2ImageL2A instead.</p>
<p>This class provides functionality to read and manipulate Sentinel-2 satellite imagery.
It handles the specific format and metadata of Sentinel-2 products, supporting operations
like loading bands, masks, and converting digital numbers to radiance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s2folder</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Sentinel-2 SAFE product folder.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polygon</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="shapely.geometry.Polygon">Polygon</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polygon defining the area of interest in EPSG:4326.
Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>granules</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping band names to file paths.
Defaults to None (automatically discovered).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_res</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output resolution in meters. Must be one of 10, 20, or 60. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_focus</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Window to focus on a specific
region of the image. Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to read. If None, all available bands
will be loaded based on the product type.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata_msi</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to metadata file. If None, it is assumed to be
in the SAFE folder.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.mission">mission</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mission identifier (e.g., 'S2A', 'S2B').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.producttype">producttype</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Product type identifier (e.g., 'MSIL1C', 'MSIL2A').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.pdgs">pdgs</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PDGS Processing Baseline number.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.relorbitnum">relorbitnum</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relative Orbit number.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.tile_number_field">tile_number_field</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tile Number field.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.product_discriminator">product_discriminator</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Product Discriminator.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.name">name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base name of the product.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.folder">folder</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the product folder.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.datetime">datetime</span></code></td>
            <td>
                  <code><span title="georeader.readers.S2_SAFE_reader.S2Image.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Acquisition datetime.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.metadata_msi">metadata_msi</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the MSI metadata file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.out_res">out_res</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output resolution in meters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.bands">bands</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to read.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.dims">dims</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the dimensions ("band", "y", "x").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.fill_value_default">fill_value_default</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default fill value (typically 0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.band_check">band_check</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Band used as template for reading.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.granule_readers">granule_readers</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <a class="autorefs autorefs-internal" title="georeader.rasterio_reader.RasterioReader" href="../rasterio_reader/#georeader.rasterio_reader.RasterioReader">RasterioReader</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of readers for each band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.window_focus">window_focus</span></code></td>
            <td>
                  <code><span title="rasterio.windows.Window">Window</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current window focus.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.transform">transform</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Affine transform for the window.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.crs">crs</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinate reference system.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.shape">shape</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of the data (bands, height, width).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.bounds">bounds</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bounds of the window.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2Image.res">res</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolution of the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">S2Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base Sentinel-2 image reader for handling Sentinel-2 satellite products.</span>
<span class="sd">    Do Not use this class directly, use S2ImageL1C or S2ImageL2A instead.</span>

<span class="sd">    This class provides functionality to read and manipulate Sentinel-2 satellite imagery.</span>
<span class="sd">    It handles the specific format and metadata of Sentinel-2 products, supporting operations</span>
<span class="sd">    like loading bands, masks, and converting digital numbers to radiance.</span>

<span class="sd">    Args:</span>
<span class="sd">        s2folder (str): Path to the Sentinel-2 SAFE product folder.</span>
<span class="sd">        polygon (Optional[Polygon]): Polygon defining the area of interest in EPSG:4326.</span>
<span class="sd">            Defaults to None (entire image).</span>
<span class="sd">        granules (Optional[Dict[str, str]]): Dictionary mapping band names to file paths.</span>
<span class="sd">            Defaults to None (automatically discovered).</span>
<span class="sd">        out_res (int): Output resolution in meters. Must be one of 10, 20, or 60. Defaults to 10.</span>
<span class="sd">        window_focus (Optional[rasterio.windows.Window]): Window to focus on a specific</span>
<span class="sd">            region of the image. Defaults to None (entire image).</span>
<span class="sd">        bands (Optional[List[str]]): List of bands to read. If None, all available bands</span>
<span class="sd">            will be loaded based on the product type.</span>
<span class="sd">        metadata_msi (Optional[str]): Path to metadata file. If None, it is assumed to be</span>
<span class="sd">            in the SAFE folder.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        mission (str): Mission identifier (e.g., &#39;S2A&#39;, &#39;S2B&#39;).</span>
<span class="sd">        producttype (str): Product type identifier (e.g., &#39;MSIL1C&#39;, &#39;MSIL2A&#39;).</span>
<span class="sd">        pdgs (str): PDGS Processing Baseline number.</span>
<span class="sd">        relorbitnum (str): Relative Orbit number.</span>
<span class="sd">        tile_number_field (str): Tile Number field.</span>
<span class="sd">        product_discriminator (str): Product Discriminator.</span>
<span class="sd">        name (str): Base name of the product.</span>
<span class="sd">        folder (str): Path to the product folder.</span>
<span class="sd">        datetime (datetime): Acquisition datetime.</span>
<span class="sd">        metadata_msi (str): Path to the MSI metadata file.</span>
<span class="sd">        out_res (int): Output resolution in meters.</span>
<span class="sd">        bands (List[str]): List of bands to read.</span>
<span class="sd">        dims (Tuple[str]): Names of the dimensions (&quot;band&quot;, &quot;y&quot;, &quot;x&quot;).</span>
<span class="sd">        fill_value_default (int): Default fill value (typically 0).</span>
<span class="sd">        band_check (str): Band used as template for reading.</span>
<span class="sd">        granule_readers (Dict[str, RasterioReader]): Dictionary of readers for each band.</span>
<span class="sd">        window_focus (rasterio.windows.Window): Current window focus.</span>
<span class="sd">        transform: Affine transform for the window.</span>
<span class="sd">        crs: Coordinate reference system.</span>
<span class="sd">        shape: Shape of the data (bands, height, width).</span>
<span class="sd">        bounds: Bounds of the window.</span>
<span class="sd">        res: Resolution of the data.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">s2folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">polygon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">granules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">out_res</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">window_focus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_msi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sentinel-2 image reader class.</span>

<span class="sd">        Args:</span>
<span class="sd">            s2folder: name of the SAFE product expects name</span>
<span class="sd">            polygon: in CRS EPSG:4326</span>
<span class="sd">            granules: dictionary with granule name and path</span>
<span class="sd">            out_res: output resolution in meters one of 10, 20, 60 (default 10)</span>
<span class="sd">            window_focus: rasterio window to read. All reads will be based on this window</span>
<span class="sd">            bands: list of bands to read. If None all bands are read.</span>
<span class="sd">            metadata_msi: path to metadata file. If None it is assumed to be in the SAFE folder</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mission</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span><span class="p">,</span>
            <span class="n">sensing_date_str</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdgs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relorbitnum</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile_number_field</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">product_discriminator</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">s2_name_split</span><span class="p">(</span><span class="n">s2folder</span><span class="p">)</span>

        <span class="c1"># Remove last trailing slash</span>
        <span class="n">s2folder</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">s2folder</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s2folder</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s2folder</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="k">else</span> <span class="n">s2folder</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">s2folder</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">s2folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="n">sensing_date_str</span><span class="p">,</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="n">info_granules_metadata</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">metadata_msi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info_granules_metadata</span> <span class="o">=</span> <span class="n">_get_info_granules_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">info_granules_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span> <span class="o">=</span> <span class="n">info_granules_metadata</span><span class="p">[</span><span class="s2">&quot;metadata_msi&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;metadata_tl&quot;</span> <span class="ow">in</span> <span class="n">info_granules_metadata</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metadata_tl</span> <span class="o">=</span> <span class="n">info_granules_metadata</span><span class="p">[</span><span class="s2">&quot;metadata_tl&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;MTD_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">producttype</span><span class="si">}</span><span class="s2">.xml&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span> <span class="o">=</span> <span class="n">metadata_msi</span>

        <span class="n">out_res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out_res</span><span class="p">)</span>

        <span class="c1"># TODO increase possible out_res to powers of 2 of 10 meters and 60 meters</span>
        <span class="c1"># rst = rasterio.open(&#39;gs://gcp-public-data-sentinel-2/tiles/49/S/GV/S2B_MSIL1C_20220527T030539_N0400_R075_T49SGV_20220527T051042.SAFE/GRANULE/L1C_T49SGV_A027271_20220527T031740/IMG_DATA/T49SGV_20220527T030539_B02.jp2&#39;)</span>
        <span class="c1"># rst.overviews(1) -&gt; [2, 4, 8, 16]</span>
        <span class="k">assert</span> <span class="n">out_res</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">},</span> <span class="s2">&quot;Not valid output resolution.Choose 10, 20, 60&quot;</span>

        <span class="c1"># Default resolution to read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_res</span> <span class="o">=</span> <span class="n">out_res</span>

        <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span> <span class="o">==</span> <span class="s2">&quot;MSIL2A&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">BANDS_S2_L2A</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">BANDS_S2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bands</span> <span class="o">=</span> <span class="n">normalize_band_names</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Select the band that will be used as template when reading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span> <span class="o">=</span> <span class="n">band</span>
                <span class="k">break</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Not band found of resolution </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># This dict will be filled by the _get_reader function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granule_readers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RasterioReader</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">window_focus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radio_add_offsets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_solar_irradiance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor_U</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quantification_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># The code below could be only triggered if required</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">granules</span><span class="p">:</span>
            <span class="c1"># This is useful when copying with cache_product_to_local_dir func</span>
            <span class="k">if</span> <span class="n">info_granules_metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">info_granules_metadata</span> <span class="o">=</span> <span class="n">_get_info_granules_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">info_granules_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">granules</span> <span class="o">=</span> <span class="n">info_granules_metadata</span><span class="p">[</span><span class="s2">&quot;granules&quot;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
                <span class="n">bands_elms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//IMAGE_FILE&quot;</span><span class="p">)</span>
                <span class="n">all_granules</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;.jp2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_elms</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span> <span class="o">==</span> <span class="s2">&quot;MSIL2A&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">granules</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">all_granules</span><span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">granules</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.jp2&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">all_granules</span>
                    <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">granules</span> <span class="o">=</span> <span class="n">granules</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span> <span class="o">=</span> <span class="n">polygon</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pol_crs</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pol_crs</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">cache_product_to_local_dir</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path_dest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">print_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">format_bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the product to a local directory and return a new instance of the class with the new path</span>

<span class="sd">        Args:</span>
<span class="sd">            path_dest: path to the destination folder. If None, the current folder ()&quot;.&quot;) is used</span>
<span class="sd">            print_progress: print progress bar. Default True</span>
<span class="sd">            format_bands: format of the bands. Default None (keep original format). Options: &quot;COG&quot;, &quot;GeoTIFF&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new instance of the class pointing to the new path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path_dest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path_dest</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

        <span class="k">if</span> <span class="n">format_bands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">format_bands</span> <span class="ow">in</span> <span class="p">{</span>
                <span class="s2">&quot;COG&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GeoTIFF&quot;</span><span class="p">,</span>
            <span class="p">},</span> <span class="s2">&quot;Not valid format_bands. Choose &#39;COG&#39; or &#39;GeoTIFF&#39;&quot;</span>

        <span class="n">name_with_safe</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.SAFE&quot;</span>
        <span class="n">dest_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_dest</span><span class="p">,</span> <span class="n">name_with_safe</span><span class="p">)</span>

        <span class="c1"># Copy metadata</span>
        <span class="n">metadata_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span><span class="p">)</span>
        <span class="n">metadata_output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metadata_output_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">metadata_output_path</span><span class="p">)</span>
            <span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="n">read_xml</span><span class="p">(</span><span class="n">metadata_output_path</span><span class="p">)</span>

        <span class="n">bands_elms</span> <span class="o">=</span> <span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//IMAGE_FILE&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span> <span class="o">==</span> <span class="s2">&quot;MSIL2A&quot;</span><span class="p">:</span>
            <span class="n">granules_name_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span> <span class="n">b</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_elms</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">granules_name_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> <span class="n">b</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_elms</span><span class="p">}</span>

        <span class="n">new_granules</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">print_progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">:</span>
                <span class="n">granule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                <span class="n">ext_origin</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">granule</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">format_bands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ext_origin</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">):</span>
                        <span class="n">convert</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">convert</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">ext_dst</span> <span class="o">=</span> <span class="s2">&quot;.tif&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">convert</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">ext_dst</span> <span class="o">=</span> <span class="n">ext_origin</span>

                <span class="n">namefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">granules_name_metadata</span><span class="p">[</span><span class="n">b</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_granules</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">namefile</span> <span class="o">+</span> <span class="n">ext_dst</span>
                <span class="n">new_granules_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">new_granules</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_granules_path</span><span class="p">):</span>
                    <span class="n">new_granules_path_tmp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">dest_folder</span><span class="p">,</span> <span class="n">namefile</span> <span class="o">+</span> <span class="n">ext_origin</span>
                    <span class="p">)</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Donwloading band </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">granule</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_granules_path</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">dir_granules_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">new_granules_path</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_granules_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">get_file</span><span class="p">(</span><span class="n">granule</span><span class="p">,</span> <span class="n">new_granules_path_tmp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span><span class="n">new_granules_path_tmp</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">format_bands</span> <span class="o">==</span> <span class="s2">&quot;COG&quot;</span><span class="p">:</span>
                            <span class="n">save_cog</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">new_granules_path</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">format_bands</span> <span class="o">==</span> <span class="s2">&quot;GeoTIFF&quot;</span><span class="p">:</span>
                            <span class="n">save_tiled_geotiff</span><span class="p">(</span>
                                <span class="n">image</span><span class="p">,</span> <span class="n">new_granules_path</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not implemented </span><span class="si">{</span><span class="n">format_bands</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">new_granules_path_tmp</span><span class="p">)</span>

                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Save granules for fast reading</span>
        <span class="n">granules_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="s2">&quot;granules.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">granules_path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">granules_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;granules&quot;</span><span class="p">:</span> <span class="n">new_granules</span><span class="p">,</span> <span class="s2">&quot;metadata_msi&quot;</span><span class="p">:</span> <span class="n">metadata_filename</span><span class="p">},</span> <span class="n">fh</span>
                <span class="p">)</span>

        <span class="n">new_granules_full_path</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_granules</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">s2loader</span><span class="p">(</span>
            <span class="n">s2folder</span><span class="o">=</span><span class="n">dest_folder</span><span class="p">,</span>
            <span class="n">out_res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">,</span>
            <span class="n">window_focus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">granules</span><span class="o">=</span><span class="n">new_granules_full_path</span><span class="p">,</span>
            <span class="n">polygon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span>
            <span class="n">metadata_msi</span><span class="o">=</span><span class="n">metadata_output_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="n">root_metadata_msi</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">DN_to_radiance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dn_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GeoTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DN_to_radiance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dn_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_metadata_msi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="n">read_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span>

    <span class="k">def</span> <span class="nf">footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Polygon</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pol_crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
            <span class="n">footprint_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//EXT_POS_LIST&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
            <span class="n">coords_split</span> <span class="o">=</span> <span class="n">footprint_txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lngstr</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">latstr</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">latstr</span><span class="p">,</span> <span class="n">lngstr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coords_split</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">coords_split</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pol_crs</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
            <span class="p">)</span>

        <span class="n">pol_window</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">window_polygon</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
        <span class="p">)</span>

        <span class="n">pol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pol_crs</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">pol_window</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">compare_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span>

        <span class="k">return</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">radio_add_offsets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radio_add_offsets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
            <span class="n">radio_add_offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//RADIO_ADD_OFFSET&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">radio_add_offsets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_radio_add_offsets</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">BANDS_S2</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_radio_add_offsets</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">BANDS_S2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;band_id&quot;</span><span class="p">])]:</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">radio_add_offsets</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radio_add_offsets</span>

    <span class="k">def</span> <span class="nf">solar_irradiance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns solar irradiance per nanometer: W/m²/nm</span>

<span class="sd">        Reads solar irradiance from metadata_msi:</span>
<span class="sd">            &lt;SOLAR_IRRADIANCE bandId=&quot;0&quot; unit=&quot;W/m²/µm&quot;&gt;1874.3&lt;/SOLAR_IRRADIANCE&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solar_irradiance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
            <span class="n">sr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//SOLAR_IRRADIANCE&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solar_irradiance</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">BANDS_S2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;bandId&quot;</span><span class="p">])]:</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1_000</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sr</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solar_irradiance</span>

    <span class="k">def</span> <span class="nf">scale_factor_U</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor_U</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor_U</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//U&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor_U</span>

    <span class="k">def</span> <span class="nf">quantification_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the quantification value stored in the metadata msi file (this is always: 10_000)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantification_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_quantification_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//QUANTIFICATION_VALUE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantification_value</span>

    <span class="k">def</span> <span class="nf">get_reader</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">band_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">overview_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RasterioReader</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides a RasterioReader object to read all the bands at the same resolution</span>

<span class="sd">        Args:</span>
<span class="sd">            band_names: List of band names or band. raises assertion error if bands have different resolution.</span>
<span class="sd">            overview_level: level of the pyramid to read (same as in rasterio)</span>

<span class="sd">        Returns:</span>
<span class="sd">            RasterioReader</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">band_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_names</span><span class="p">]</span>

        <span class="n">band_names</span> <span class="o">=</span> <span class="n">normalize_band_names</span><span class="p">(</span><span class="n">band_names</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">band_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">band_names</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Bands: </span><span class="si">{</span><span class="n">band_names</span><span class="si">}</span><span class="s2"> have different resolution&quot;</span>

        <span class="n">reader</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">],</span>
            <span class="n">window_focus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">stack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
            <span class="n">overview_level</span><span class="o">=</span><span class="n">overview_level</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">window_in</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">window_from_bounds</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
        <span class="n">window_in_rounded</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">round_outer_window</span><span class="p">(</span><span class="n">window_in</span><span class="p">)</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window_in_rounded</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reader</span>

    <span class="k">def</span> <span class="nf">_get_reader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RasterioReader</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">band_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">band_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span>

        <span class="k">if</span> <span class="n">band_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">granule_readers</span><span class="p">:</span>
            <span class="c1"># TODO handle different out_res than 10, 20, 60?</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_res</span> <span class="o">==</span> <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">band_name</span><span class="p">]:</span>
                <span class="n">overview_level</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">has_out_res</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_res</span> <span class="o">==</span> <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># out_res == 20 and BANDS_RESOLUTION[band_name]==10 -&gt; read from first overview</span>
                <span class="n">overview_level</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">has_out_res</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_res</span> <span class="o">&gt;</span> <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">band_name</span><span class="p">]:</span>
                <span class="c1"># out_res 60 and BANDS_RESOLUTION[band_name] == 10 or BANDS_RESOLUTION[band_name] == 20</span>
                <span class="n">overview_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">has_out_res</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">overview_level</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">has_out_res</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># figure out which window_focus to set</span>

            <span class="k">if</span> <span class="n">band_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span><span class="p">:</span>
                <span class="n">window_focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span>
                <span class="n">set_window_after</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">has_out_res</span><span class="p">:</span>
                <span class="n">window_focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span>
                <span class="n">set_window_after</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">set_window_after</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">window_focus</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">granule_readers</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">[</span><span class="n">band_name</span><span class="p">],</span>
                <span class="n">window_focus</span><span class="o">=</span><span class="n">window_focus</span><span class="p">,</span>
                <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
                <span class="n">overview_level</span><span class="o">=</span><span class="n">overview_level</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">set_window_after</span><span class="p">:</span>
                <span class="n">window_in</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">window_from_bounds</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">granule_readers</span><span class="p">[</span><span class="n">band_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
                <span class="p">)</span>
                <span class="n">window_in_rounded</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">round_outer_window</span><span class="p">(</span><span class="n">window_in</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">granule_readers</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window_in_rounded</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">granule_readers</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is always np.uint16</span>
        <span class="n">reader_band_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">reader_band_check</span><span class="o">.</span><span class="n">dtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader_band_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">),)</span> <span class="o">+</span> <span class="n">reader_band_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader_band_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">reader_band_check</span><span class="o">.</span><span class="n">transform</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader_band_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">reader_band_check</span><span class="o">.</span><span class="n">crs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader_band_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">reader_band_check</span><span class="o">.</span><span class="n">bounds</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">reader_band_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">reader_band_check</span><span class="o">.</span><span class="n">res</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; </span>
<span class="s2">         </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span>
<span class="s2">         Transform: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="si">}</span>
<span class="s2">         Shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span>
<span class="s2">         Resolution: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="si">}</span>
<span class="s2">         Bounds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="si">}</span>
<span class="s2">         CRS: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="si">}</span>
<span class="s2">         bands: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="si">}</span>
<span class="s2">         fill_value_default: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">read_from_band_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read from band names</span>

<span class="sd">        Args:</span>
<span class="sd">            band_names: List of band names</span>

<span class="sd">        Returns:</span>
<span class="sd">            Copy of current object with band names set to band_names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s2obj</span> <span class="o">=</span> <span class="n">s2loader</span><span class="p">(</span>
            <span class="n">s2folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
            <span class="n">out_res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">,</span>
            <span class="n">window_focus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">band_names</span><span class="p">,</span>
            <span class="n">granules</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">,</span>
            <span class="n">polygon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span>
            <span class="n">metadata_msi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">s2obj</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span>
        <span class="k">return</span> <span class="n">s2obj</span>

    <span class="k">def</span> <span class="nf">read_from_window</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
        <span class="c1"># return GeoTensor(values=self.values, transform=self.transform, crs=self.crs)</span>

        <span class="n">reader_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="n">rasterio_reader_ref</span> <span class="o">=</span> <span class="n">reader_ref</span><span class="o">.</span><span class="n">read_from_window</span><span class="p">(</span>
            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span>
        <span class="p">)</span>
        <span class="n">s2obj</span> <span class="o">=</span> <span class="n">s2loader</span><span class="p">(</span>
            <span class="n">s2folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
            <span class="n">out_res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">,</span>
            <span class="n">window_focus</span><span class="o">=</span><span class="n">rasterio_reader_ref</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">granules</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">,</span>
            <span class="n">polygon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span>
            <span class="n">metadata_msi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Set band check to avoid re-reading</span>
        <span class="n">s2obj</span><span class="o">.</span><span class="n">granule_readers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">band_check</span><span class="p">]</span> <span class="o">=</span> <span class="n">rasterio_reader_ref</span>
        <span class="n">s2obj</span><span class="o">.</span><span class="n">band_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span>

        <span class="n">s2obj</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span>

        <span class="k">return</span> <span class="n">s2obj</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">reader_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="n">geotensor_ref</span> <span class="o">=</span> <span class="n">reader_ref</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>

        <span class="n">array_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">),)</span> <span class="o">+</span> <span class="n">geotensor_ref</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="n">geotensor_ref</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Deal with NODATA values</span>
        <span class="n">invalids</span> <span class="o">=</span> <span class="p">(</span><span class="n">geotensor_ref</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">geotensor_ref</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">radio_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_add_offsets</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span><span class="p">:</span>

                <span class="c1"># Avoid bug of band names without zero before</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;B0</span><span class="si">{</span><span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="n">geotensor_iter</span> <span class="o">=</span> <span class="n">geotensor_ref</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reader_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reader_iter</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">geotensor_ref</span><span class="o">.</span><span class="n">res</span><span class="p">))</span>
                    <span class="p">)</span>
                    <span class="o">&lt;</span> <span class="mf">1e-6</span>
                <span class="p">):</span>
                    <span class="n">geotensor_iter</span> <span class="o">=</span> <span class="n">reader_iter</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">geotensor_iter</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">read_reproject_like</span><span class="p">(</span>
                        <span class="n">reader_iter</span><span class="p">,</span> <span class="n">geotensor_ref</span>
                    <span class="p">)</span>

            <span class="c1"># Important: Adds radio correction! otherwise images after 2022-01-25 shifted (PROCESSING_BASELINE &#39;04.00&#39; or above)</span>
            <span class="n">array_out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">geotensor_iter</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">+</span> <span class="n">radio_add</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

        <span class="n">array_out</span><span class="p">[:,</span> <span class="n">invalids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">array_out</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative values found in the image&quot;</span><span class="p">)</span>

        <span class="n">array_out</span> <span class="o">=</span> <span class="n">array_out</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">GeoTensor</span><span class="p">(</span>
            <span class="n">values</span><span class="o">=</span><span class="n">array_out</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">geotensor_ref</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">geotensor_ref</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">load_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">reader_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
        <span class="n">geotensor_ref</span> <span class="o">=</span> <span class="n">reader_ref</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">geotensor_ref</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">geotensor_ref</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
            <span class="n">geotensor_ref</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">geotensor_ref</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="georeader.readers.S2_SAFE_reader.S2Image.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">s2folder</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">granules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_res</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">window_focus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata_msi</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.S2_SAFE_reader.S2Image.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Sentinel-2 image reader class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s2folder</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the SAFE product expects name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polygon</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="shapely.geometry.Polygon">Polygon</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>in CRS EPSG:4326</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>granules</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary with granule name and path</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_res</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>output resolution in meters one of 10, 20, 60 (default 10)</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_focus</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>rasterio window to read. All reads will be based on this window</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of bands to read. If None all bands are read.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata_msi</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to metadata file. If None it is assumed to be in the SAFE folder</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">s2folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">polygon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">granules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">out_res</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">window_focus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata_msi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sentinel-2 image reader class.</span>

<span class="sd">    Args:</span>
<span class="sd">        s2folder: name of the SAFE product expects name</span>
<span class="sd">        polygon: in CRS EPSG:4326</span>
<span class="sd">        granules: dictionary with granule name and path</span>
<span class="sd">        out_res: output resolution in meters one of 10, 20, 60 (default 10)</span>
<span class="sd">        window_focus: rasterio window to read. All reads will be based on this window</span>
<span class="sd">        bands: list of bands to read. If None all bands are read.</span>
<span class="sd">        metadata_msi: path to metadata file. If None it is assumed to be in the SAFE folder</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mission</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span><span class="p">,</span>
        <span class="n">sensing_date_str</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdgs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relorbitnum</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_number_field</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">product_discriminator</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">s2_name_split</span><span class="p">(</span><span class="n">s2folder</span><span class="p">)</span>

    <span class="c1"># Remove last trailing slash</span>
    <span class="n">s2folder</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">s2folder</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">s2folder</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s2folder</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="k">else</span> <span class="n">s2folder</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">s2folder</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">s2folder</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
        <span class="n">sensing_date_str</span><span class="p">,</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

    <span class="n">info_granules_metadata</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">metadata_msi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">info_granules_metadata</span> <span class="o">=</span> <span class="n">_get_info_granules_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info_granules_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span> <span class="o">=</span> <span class="n">info_granules_metadata</span><span class="p">[</span><span class="s2">&quot;metadata_msi&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;metadata_tl&quot;</span> <span class="ow">in</span> <span class="n">info_granules_metadata</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata_tl</span> <span class="o">=</span> <span class="n">info_granules_metadata</span><span class="p">[</span><span class="s2">&quot;metadata_tl&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;MTD_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">producttype</span><span class="si">}</span><span class="s2">.xml&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span> <span class="o">=</span> <span class="n">metadata_msi</span>

    <span class="n">out_res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out_res</span><span class="p">)</span>

    <span class="c1"># TODO increase possible out_res to powers of 2 of 10 meters and 60 meters</span>
    <span class="c1"># rst = rasterio.open(&#39;gs://gcp-public-data-sentinel-2/tiles/49/S/GV/S2B_MSIL1C_20220527T030539_N0400_R075_T49SGV_20220527T051042.SAFE/GRANULE/L1C_T49SGV_A027271_20220527T031740/IMG_DATA/T49SGV_20220527T030539_B02.jp2&#39;)</span>
    <span class="c1"># rst.overviews(1) -&gt; [2, 4, 8, 16]</span>
    <span class="k">assert</span> <span class="n">out_res</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">},</span> <span class="s2">&quot;Not valid output resolution.Choose 10, 20, 60&quot;</span>

    <span class="c1"># Default resolution to read</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">out_res</span> <span class="o">=</span> <span class="n">out_res</span>

    <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span> <span class="o">==</span> <span class="s2">&quot;MSIL2A&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">BANDS_S2_L2A</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">BANDS_S2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bands</span> <span class="o">=</span> <span class="n">normalize_band_names</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Select the band that will be used as template when reading</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span> <span class="o">=</span> <span class="n">band</span>
            <span class="k">break</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band_check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Not band found of resolution </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># This dict will be filled by the _get_reader function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">granule_readers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RasterioReader</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">window_focus</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_radio_add_offsets</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_solar_irradiance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor_U</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_quantification_value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># The code below could be only triggered if required</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">granules</span><span class="p">:</span>
        <span class="c1"># This is useful when copying with cache_product_to_local_dir func</span>
        <span class="k">if</span> <span class="n">info_granules_metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info_granules_metadata</span> <span class="o">=</span> <span class="n">_get_info_granules_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">info_granules_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">granules</span> <span class="o">=</span> <span class="n">info_granules_metadata</span><span class="p">[</span><span class="s2">&quot;granules&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
            <span class="n">bands_elms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//IMAGE_FILE&quot;</span><span class="p">)</span>
            <span class="n">all_granules</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;.jp2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_elms</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span> <span class="o">==</span> <span class="s2">&quot;MSIL2A&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">granules</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">all_granules</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">granules</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.jp2&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">all_granules</span>
                <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granules</span> <span class="o">=</span> <span class="n">granules</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span> <span class="o">=</span> <span class="n">polygon</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pol_crs</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pol_crs</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.S2_SAFE_reader.S2Image.cache_product_to_local_dir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cache_product_to_local_dir</span><span class="p">(</span><span class="n">path_dest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">print_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">format_bands</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.S2_SAFE_reader.S2Image.cache_product_to_local_dir" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Copy the product to a local directory and return a new instance of the class with the new path</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_dest</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the destination folder. If None, the current folder ()".") is used</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_progress</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>print progress bar. Default True</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format_bands</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>format of the bands. Default None (keep original format). Options: "COG", "GeoTIFF"</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>__class__</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new instance of the class pointing to the new path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cache_product_to_local_dir</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path_dest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">print_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">format_bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy the product to a local directory and return a new instance of the class with the new path</span>

<span class="sd">    Args:</span>
<span class="sd">        path_dest: path to the destination folder. If None, the current folder ()&quot;.&quot;) is used</span>
<span class="sd">        print_progress: print progress bar. Default True</span>
<span class="sd">        format_bands: format of the bands. Default None (keep original format). Options: &quot;COG&quot;, &quot;GeoTIFF&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new instance of the class pointing to the new path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path_dest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path_dest</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

    <span class="k">if</span> <span class="n">format_bands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">format_bands</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s2">&quot;COG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GeoTIFF&quot;</span><span class="p">,</span>
        <span class="p">},</span> <span class="s2">&quot;Not valid format_bands. Choose &#39;COG&#39; or &#39;GeoTIFF&#39;&quot;</span>

    <span class="n">name_with_safe</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.SAFE&quot;</span>
    <span class="n">dest_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_dest</span><span class="p">,</span> <span class="n">name_with_safe</span><span class="p">)</span>

    <span class="c1"># Copy metadata</span>
    <span class="n">metadata_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span><span class="p">)</span>
    <span class="n">metadata_output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metadata_output_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">metadata_output_path</span><span class="p">)</span>
        <span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="n">read_xml</span><span class="p">(</span><span class="n">metadata_output_path</span><span class="p">)</span>

    <span class="n">bands_elms</span> <span class="o">=</span> <span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//IMAGE_FILE&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span> <span class="o">==</span> <span class="s2">&quot;MSIL2A&quot;</span><span class="p">:</span>
        <span class="n">granules_name_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span> <span class="n">b</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_elms</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">granules_name_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> <span class="n">b</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_elms</span><span class="p">}</span>

    <span class="n">new_granules</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">print_progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">:</span>
            <span class="n">granule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">ext_origin</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">granule</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">format_bands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ext_origin</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">):</span>
                    <span class="n">convert</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">convert</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">ext_dst</span> <span class="o">=</span> <span class="s2">&quot;.tif&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">convert</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">ext_dst</span> <span class="o">=</span> <span class="n">ext_origin</span>

            <span class="n">namefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">granules_name_metadata</span><span class="p">[</span><span class="n">b</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_granules</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">namefile</span> <span class="o">+</span> <span class="n">ext_dst</span>
            <span class="n">new_granules_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">new_granules</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_granules_path</span><span class="p">):</span>
                <span class="n">new_granules_path_tmp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">dest_folder</span><span class="p">,</span> <span class="n">namefile</span> <span class="o">+</span> <span class="n">ext_origin</span>
                <span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Donwloading band </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">granule</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_granules_path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">dir_granules_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">new_granules_path</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_granules_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">get_file</span><span class="p">(</span><span class="n">granule</span><span class="p">,</span> <span class="n">new_granules_path_tmp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span><span class="n">new_granules_path_tmp</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">format_bands</span> <span class="o">==</span> <span class="s2">&quot;COG&quot;</span><span class="p">:</span>
                        <span class="n">save_cog</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">new_granules_path</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">format_bands</span> <span class="o">==</span> <span class="s2">&quot;GeoTIFF&quot;</span><span class="p">:</span>
                        <span class="n">save_tiled_geotiff</span><span class="p">(</span>
                            <span class="n">image</span><span class="p">,</span> <span class="n">new_granules_path</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not implemented </span><span class="si">{</span><span class="n">format_bands</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">new_granules_path_tmp</span><span class="p">)</span>

            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Save granules for fast reading</span>
    <span class="n">granules_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="s2">&quot;granules.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">granules_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">granules_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;granules&quot;</span><span class="p">:</span> <span class="n">new_granules</span><span class="p">,</span> <span class="s2">&quot;metadata_msi&quot;</span><span class="p">:</span> <span class="n">metadata_filename</span><span class="p">},</span> <span class="n">fh</span>
            <span class="p">)</span>

    <span class="n">new_granules_full_path</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_folder</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_granules</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">s2loader</span><span class="p">(</span>
        <span class="n">s2folder</span><span class="o">=</span><span class="n">dest_folder</span><span class="p">,</span>
        <span class="n">out_res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">,</span>
        <span class="n">window_focus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span>
        <span class="n">bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="p">,</span>
        <span class="n">granules</span><span class="o">=</span><span class="n">new_granules_full_path</span><span class="p">,</span>
        <span class="n">polygon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span>
        <span class="n">metadata_msi</span><span class="o">=</span><span class="n">metadata_output_path</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="n">root_metadata_msi</span>
    <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.S2_SAFE_reader.S2Image.get_reader" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_reader</span><span class="p">(</span><span class="n">band_names</span><span class="p">,</span> <span class="n">overview_level</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.S2_SAFE_reader.S2Image.get_reader" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Provides a RasterioReader object to read all the bands at the same resolution</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>band_names</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of band names or band. raises assertion error if bands have different resolution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overview_level</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>level of the pyramid to read (same as in rasterio)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.rasterio_reader.RasterioReader" href="../rasterio_reader/#georeader.rasterio_reader.RasterioReader">RasterioReader</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RasterioReader</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_reader</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">band_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">overview_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RasterioReader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides a RasterioReader object to read all the bands at the same resolution</span>

<span class="sd">    Args:</span>
<span class="sd">        band_names: List of band names or band. raises assertion error if bands have different resolution.</span>
<span class="sd">        overview_level: level of the pyramid to read (same as in rasterio)</span>

<span class="sd">    Returns:</span>
<span class="sd">        RasterioReader</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">band_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_names</span><span class="p">]</span>

    <span class="n">band_names</span> <span class="o">=</span> <span class="n">normalize_band_names</span><span class="p">(</span><span class="n">band_names</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">band_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">BANDS_RESOLUTION</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">band_names</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Bands: </span><span class="si">{</span><span class="n">band_names</span><span class="si">}</span><span class="s2"> have different resolution&quot;</span>

    <span class="n">reader</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">],</span>
        <span class="n">window_focus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
        <span class="n">overview_level</span><span class="o">=</span><span class="n">overview_level</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">window_in</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">window_from_bounds</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
    <span class="n">window_in_rounded</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">round_outer_window</span><span class="p">(</span><span class="n">window_in</span><span class="p">)</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window_in_rounded</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reader</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.S2_SAFE_reader.S2Image.quantification_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">quantification_value</span><span class="p">()</span></code>

<a href="#georeader.readers.S2_SAFE_reader.S2Image.quantification_value" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the quantification value stored in the metadata msi file (this is always: 10_000)</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">quantification_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the quantification value stored in the metadata msi file (this is always: 10_000)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantification_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quantification_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//QUANTIFICATION_VALUE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantification_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.S2_SAFE_reader.S2Image.read_from_band_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_from_band_names</span><span class="p">(</span><span class="n">band_names</span><span class="p">)</span></code>

<a href="#georeader.readers.S2_SAFE_reader.S2Image.read_from_band_names" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Read from band names</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>band_names</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of band names</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>__class__</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Copy of current object with band names set to band_names</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_from_band_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read from band names</span>

<span class="sd">    Args:</span>
<span class="sd">        band_names: List of band names</span>

<span class="sd">    Returns:</span>
<span class="sd">        Copy of current object with band names set to band_names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s2obj</span> <span class="o">=</span> <span class="n">s2loader</span><span class="p">(</span>
        <span class="n">s2folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
        <span class="n">out_res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">,</span>
        <span class="n">window_focus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span>
        <span class="n">bands</span><span class="o">=</span><span class="n">band_names</span><span class="p">,</span>
        <span class="n">granules</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">,</span>
        <span class="n">polygon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span>
        <span class="n">metadata_msi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_msi</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">s2obj</span><span class="o">.</span><span class="n">root_metadata_msi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span>
    <span class="k">return</span> <span class="n">s2obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.S2_SAFE_reader.S2Image.solar_irradiance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">solar_irradiance</span><span class="p">()</span></code>

<a href="#georeader.readers.S2_SAFE_reader.S2Image.solar_irradiance" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns solar irradiance per nanometer: W/m²/nm</p>


<details class="reads-solar-irradiance-from-metadata_msi" open>
  <summary>Reads solar irradiance from metadata_msi</summary>
  <p><SOLAR_IRRADIANCE bandId="0" unit="W/m²/µm">1874.3</SOLAR_IRRADIANCE></p>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">solar_irradiance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns solar irradiance per nanometer: W/m²/nm</span>

<span class="sd">    Reads solar irradiance from metadata_msi:</span>
<span class="sd">        &lt;SOLAR_IRRADIANCE bandId=&quot;0&quot; unit=&quot;W/m²/µm&quot;&gt;1874.3&lt;/SOLAR_IRRADIANCE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solar_irradiance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_msi</span><span class="p">()</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_msi</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//SOLAR_IRRADIANCE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_solar_irradiance</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">BANDS_S2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;bandId&quot;</span><span class="p">])]:</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1_000</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sr</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solar_irradiance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="georeader.readers.S2_SAFE_reader.S2ImageL1C" class="doc doc-heading">
            <code>S2ImageL1C</code>


<a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="georeader.readers.S2_SAFE_reader.S2Image" href="#georeader.readers.S2_SAFE_reader.S2Image">S2Image</a></code></p>


        <p>Sentinel-2 Level 1C (top of atmosphere reflectance) image reader.</p>
<p>This class extends the base S2Image class to handle Sentinel-2 Level 1C products,
which provide calibrated and orthorectified top of atmosphere reflectance data.
It also provides methods to access viewing and solar angle information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s2folder</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Sentinel-2 SAFE product folder.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>granules</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping band names to file paths.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polygon</code>
            </td>
            <td>
                  <code><span title="shapely.geometry.Polygon">Polygon</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polygon defining the area of interest in EPSG:4326.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_res</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output resolution in meters. Must be one of 10, 20, or 60. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_focus</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Window to focus on a specific
region of the image. Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to read. If None, all available bands will be loaded.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata_msi</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to metadata file. If None, it is assumed to be
in the SAFE folder.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.Additional">Additional</span></code></td>
            <td>
                  <code>to S2Image attributes</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.granule_folder">granule_folder</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the granule folder.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.msk_clouds_file">msk_clouds_file</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the cloud mask file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.metadata_tl">metadata_tl</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the TL metadata file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.root_metadata_tl">root_metadata_tl</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Root element of the TL metadata XML.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.tileId">tileId</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tile identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.satId">satId</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Satellite identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.procLevel">procLevel</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing level.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.dimsByRes">dimsByRes</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimensions by resolution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.ulxyByRes">ulxyByRes</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Upper-left coordinates by resolution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.tileAnglesNode">tileAnglesNode</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tile angles node from metadata.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.mean_sza">mean_sza</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean solar zenith angle.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.mean_saa">mean_saa</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean solar azimuth angle.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.mean_vza">mean_vza</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean viewing zenith angle per band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.mean_vaa">mean_vaa</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean viewing azimuth angle per band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.vaa">vaa</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Viewing azimuth angle as GeoTensor per band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.vza">vza</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Viewing zenith angle as GeoTensor per band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.saa">saa</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Solar azimuth angle as GeoTensor.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.sza">sza</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Solar zenith angle as GeoTensor.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL1C.anglesULXY">anglesULXY</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Upper-left coordinates of the angle grids.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize the S2ImageL1C reader with a data path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2_l1c</span> <span class="o">=</span> <span class="n">S2ImageL1C</span><span class="p">(</span><span class="s1">&#39;/path/to/S2A_MSIL1C_20170717T235959_N0205_R072_T01WCP_20170718T000256.SAFE&#39;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">granules</span><span class="o">=</span><span class="n">granules_dict</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="n">aoi_polygon</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load all bands</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l1c_data</span> <span class="o">=</span> <span class="n">s2_l1c</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Read angle information</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2_l1c</span><span class="o">.</span><span class="n">read_metadata_tl</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">solar_zenith</span> <span class="o">=</span> <span class="n">s2_l1c</span><span class="o">.</span><span class="n">sza</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Convert to radiance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radiance_data</span> <span class="o">=</span> <span class="n">s2_l1c</span><span class="o">.</span><span class="n">DN_to_radiance</span><span class="p">()</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">S2ImageL1C</span><span class="p">(</span><span class="n">S2Image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sentinel-2 Level 1C (top of atmosphere reflectance) image reader.</span>

<span class="sd">    This class extends the base S2Image class to handle Sentinel-2 Level 1C products,</span>
<span class="sd">    which provide calibrated and orthorectified top of atmosphere reflectance data.</span>
<span class="sd">    It also provides methods to access viewing and solar angle information.</span>

<span class="sd">    Args:</span>
<span class="sd">        s2folder (str): Path to the Sentinel-2 SAFE product folder.</span>
<span class="sd">        granules (Dict[str, str]): Dictionary mapping band names to file paths.</span>
<span class="sd">        polygon (Polygon): Polygon defining the area of interest in EPSG:4326.</span>
<span class="sd">        out_res (int): Output resolution in meters. Must be one of 10, 20, or 60. Defaults to 10.</span>
<span class="sd">        window_focus (Optional[rasterio.windows.Window]): Window to focus on a specific</span>
<span class="sd">            region of the image. Defaults to None (entire image).</span>
<span class="sd">        bands (Optional[List[str]]): List of bands to read. If None, all available bands will be loaded.</span>
<span class="sd">        metadata_msi (Optional[str]): Path to metadata file. If None, it is assumed to be</span>
<span class="sd">            in the SAFE folder.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        Additional to S2Image attributes:</span>
<span class="sd">        granule_folder (str): Path to the granule folder.</span>
<span class="sd">        msk_clouds_file (str): Path to the cloud mask file.</span>
<span class="sd">        metadata_tl (str): Path to the TL metadata file.</span>
<span class="sd">        root_metadata_tl: Root element of the TL metadata XML.</span>
<span class="sd">        tileId (str): Tile identifier.</span>
<span class="sd">        satId (str): Satellite identifier.</span>
<span class="sd">        procLevel (str): Processing level.</span>
<span class="sd">        dimsByRes (Dict): Dimensions by resolution.</span>
<span class="sd">        ulxyByRes (Dict): Upper-left coordinates by resolution.</span>
<span class="sd">        tileAnglesNode: Tile angles node from metadata.</span>
<span class="sd">        mean_sza (float): Mean solar zenith angle.</span>
<span class="sd">        mean_saa (float): Mean solar azimuth angle.</span>
<span class="sd">        mean_vza (Dict[str, float]): Mean viewing zenith angle per band.</span>
<span class="sd">        mean_vaa (Dict[str, float]): Mean viewing azimuth angle per band.</span>
<span class="sd">        vaa (Dict[str, GeoTensor]): Viewing azimuth angle as GeoTensor per band.</span>
<span class="sd">        vza (Dict[str, GeoTensor]): Viewing zenith angle as GeoTensor per band.</span>
<span class="sd">        saa (GeoTensor): Solar azimuth angle as GeoTensor.</span>
<span class="sd">        sza (GeoTensor): Solar zenith angle as GeoTensor.</span>
<span class="sd">        anglesULXY (Tuple[float, float]): Upper-left coordinates of the angle grids.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Initialize the S2ImageL1C reader with a data path</span>
<span class="sd">        &gt;&gt;&gt; s2_l1c = S2ImageL1C(&#39;/path/to/S2A_MSIL1C_20170717T235959_N0205_R072_T01WCP_20170718T000256.SAFE&#39;,</span>
<span class="sd">        ...                     granules=granules_dict, polygon=aoi_polygon)</span>
<span class="sd">        &gt;&gt;&gt; # Load all bands</span>
<span class="sd">        &gt;&gt;&gt; l1c_data = s2_l1c.load()</span>
<span class="sd">        &gt;&gt;&gt; # Read angle information</span>
<span class="sd">        &gt;&gt;&gt; s2_l1c.read_metadata_tl()</span>
<span class="sd">        &gt;&gt;&gt; solar_zenith = s2_l1c.sza</span>
<span class="sd">        &gt;&gt;&gt; # Convert to radiance</span>
<span class="sd">        &gt;&gt;&gt; radiance_data = s2_l1c.DN_to_radiance()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">s2folder</span><span class="p">,</span>
        <span class="n">granules</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">polygon</span><span class="p">:</span> <span class="n">Polygon</span><span class="p">,</span>
        <span class="n">out_res</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">window_focus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_msi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">S2ImageL1C</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">s2folder</span><span class="o">=</span><span class="n">s2folder</span><span class="p">,</span>
            <span class="n">granules</span><span class="o">=</span><span class="n">granules</span><span class="p">,</span>
            <span class="n">polygon</span><span class="o">=</span><span class="n">polygon</span><span class="p">,</span>
            <span class="n">out_res</span><span class="o">=</span><span class="n">out_res</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">window_focus</span><span class="o">=</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="n">metadata_msi</span><span class="o">=</span><span class="n">metadata_msi</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span> <span class="o">==</span> <span class="s2">&quot;MSIL1C&quot;</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Unexpected product type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">producttype</span><span class="si">}</span><span class="s2"> in image </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">first_granule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">granules</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granule_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">first_granule</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msk_clouds_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">granule_folder</span><span class="p">,</span> <span class="s2">&quot;MSK_CLOUDS_B00.gml&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;metadata_tl&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata_tl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">granule_folder</span><span class="p">,</span> <span class="s2">&quot;MTD_TL.xml&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Granule in L1C does not include TCI</span>
        <span class="c1"># Assert bands in self.granule are ordered as in BANDS_S2</span>
        <span class="c1"># assert all(granule[-7:-4] == bname for bname, granule in zip(BANDS_S2, self.granule)), f&quot;some granules are not in the expected order {self.granule}&quot;</span>

    <span class="k">def</span> <span class="nf">read_from_window</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read_from_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="c1"># copy all metadata from the original image</span>
        <span class="k">for</span> <span class="n">atribute</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;tileId&quot;</span><span class="p">,</span>
            <span class="s2">&quot;root_metadata_tl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;satId&quot;</span><span class="p">,</span>
            <span class="s2">&quot;procLevel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dimsByRes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ulxyByRes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tileAnglesNode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_sza&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_saa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_vza&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_vaa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vaa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vza&quot;</span><span class="p">,</span>
            <span class="s2">&quot;saa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sza&quot;</span><span class="p">,</span>
            <span class="s2">&quot;anglesULXY&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">atribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atribute</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">cache_product_to_local_dir</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path_dest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">print_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">format_bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overrides the parent method to copy the MTD_TL.xml file</span>

<span class="sd">        Args:</span>
<span class="sd">            path_dest (Optional[str], optional): path to the destination folder. Defaults to None.</span>
<span class="sd">            print_progress (bool, optional): whether to print progress. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            __class__: the cached object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cache_product_to_local_dir</span><span class="p">(</span>
            <span class="n">path_dest</span><span class="o">=</span><span class="n">path_dest</span><span class="p">,</span>
            <span class="n">print_progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">,</span>
            <span class="n">format_bands</span><span class="o">=</span><span class="n">format_bands</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">):</span>
            <span class="c1"># the cached product already exists. returns</span>
            <span class="k">return</span> <span class="n">new_obj</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">)</span>
            <span class="c1"># copy all metadata from the original image</span>
            <span class="k">for</span> <span class="n">atribute</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;tileId&quot;</span><span class="p">,</span>
                <span class="s2">&quot;root_metadata_tl&quot;</span><span class="p">,</span>
                <span class="s2">&quot;satId&quot;</span><span class="p">,</span>
                <span class="s2">&quot;procLevel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dimsByRes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ulxyByRes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tileAnglesNode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mean_sza&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mean_saa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mean_vza&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mean_vaa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;vaa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;vza&quot;</span><span class="p">,</span>
                <span class="s2">&quot;saa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sza&quot;</span><span class="p">,</span>
                <span class="s2">&quot;anglesULXY&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atribute</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">new_obj</span><span class="p">,</span> <span class="n">atribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atribute</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">,</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">)</span>

        <span class="n">granule_folder_rel</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">granule_folder</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Add metadata_tl to granules.json</span>
        <span class="n">granules_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;granules.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">granules_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">info_granules_metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">info_granules_metadata</span><span class="p">[</span><span class="s2">&quot;metadata_tl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">granule_folder_rel</span><span class="p">,</span> <span class="s2">&quot;MTD_TL.xml&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">granules_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">info_granules_metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_obj</span>

    <span class="k">def</span> <span class="nf">read_metadata_tl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read metadata TILE to parse information about the acquisition and properties of GRANULE bands.</span>

<span class="sd">        It populates the following attributes:</span>
<span class="sd">            - mean_sza</span>
<span class="sd">            - mean_saa</span>
<span class="sd">            - mean_vza</span>
<span class="sd">            - mean_vaa</span>
<span class="sd">            - vaa</span>
<span class="sd">            - vza</span>
<span class="sd">            - saa</span>
<span class="sd">            - sza</span>
<span class="sd">            - anglesULXY</span>
<span class="sd">            - tileId</span>
<span class="sd">            - satId</span>
<span class="sd">            - procLevel</span>
<span class="sd">            - epsg_code</span>
<span class="sd">            - dimsByRes</span>
<span class="sd">            - ulxyByRes</span>
<span class="sd">            - tileAnglesNode</span>
<span class="sd">            - root_metadata_tl</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="o">=</span> <span class="n">read_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">)</span>

        <span class="c1"># Stoopid XML namespace prefix</span>
        <span class="n">nsPrefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">tag</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">nsDict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n1&quot;</span><span class="p">:</span> <span class="n">nsPrefix</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_sza</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//Mean_Sun_Angle/ZENITH_ANGLE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_saa</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//Mean_Sun_Angle/AZIMUTH_ANGLE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="p">)</span>

        <span class="n">generalInfoNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;n1:General_Info&quot;</span><span class="p">,</span> <span class="n">nsDict</span><span class="p">)</span>
        <span class="c1"># N.B. I am still not entirely convinced that this SENSING_TIME is really</span>
        <span class="c1"># the acquisition time, but the documentation is rubbish.</span>
        <span class="n">sensingTimeNode</span> <span class="o">=</span> <span class="n">generalInfoNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;SENSING_TIME&quot;</span><span class="p">)</span>
        <span class="n">sensingTimeStr</span> <span class="o">=</span> <span class="n">sensingTimeNode</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># self.datetime = datetime.datetime.strptime(sensingTimeStr, &quot;%Y-%m-%dT%H:%M:%S.%fZ&quot;)</span>
        <span class="n">tileIdNode</span> <span class="o">=</span> <span class="n">generalInfoNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;TILE_ID&quot;</span><span class="p">)</span>
        <span class="n">tileIdFullStr</span> <span class="o">=</span> <span class="n">tileIdNode</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tileId</span> <span class="o">=</span> <span class="n">tileIdFullStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">satId</span> <span class="o">=</span> <span class="n">tileIdFullStr</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">procLevel</span> <span class="o">=</span> <span class="n">tileIdFullStr</span><span class="p">[</span>
            <span class="mi">13</span><span class="p">:</span><span class="mi">16</span>
        <span class="p">]</span>  <span class="c1"># Not sure whether to use absolute pos or split by &#39;_&#39;....</span>

        <span class="n">geomInfoNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;n1:Geometric_Info&quot;</span><span class="p">,</span> <span class="n">nsDict</span><span class="p">)</span>
        <span class="n">geocodingNode</span> <span class="o">=</span> <span class="n">geomInfoNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Tile_Geocoding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span> <span class="o">=</span> <span class="n">geocodingNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;HORIZONTAL_CS_CODE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Dimensions of images at different resolutions.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimsByRes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sizeNodeList</span> <span class="o">=</span> <span class="n">geocodingNode</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;Size&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sizeNode</span> <span class="ow">in</span> <span class="n">sizeNodeList</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">sizeNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
            <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sizeNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;NROWS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sizeNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;NCOLS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dimsByRes</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">)</span>

        <span class="c1"># Upper-left corners of images at different resolutions. As far as I can</span>
        <span class="c1"># work out, these coords appear to be the upper left corner of the upper left</span>
        <span class="c1"># pixel, i.e. equivalent to GDAL&#39;s convention. This also means that they</span>
        <span class="c1"># are the same for the different resolutions, which is nice.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">posNodeList</span> <span class="o">=</span> <span class="n">geocodingNode</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;Geoposition&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">posNode</span> <span class="ow">in</span> <span class="n">posNodeList</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">posNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
            <span class="n">ulx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">posNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ULX&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">uly</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">posNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ULY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ulx</span><span class="p">,</span> <span class="n">uly</span><span class="p">)</span>

        <span class="c1"># Sun and satellite angles.</span>
        <span class="c1"># Zenith</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span> <span class="o">=</span> <span class="n">geomInfoNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Tile_Angles&quot;</span><span class="p">)</span>
        <span class="n">sunZenithNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Sun_Angles_Grid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Zenith&quot;</span><span class="p">)</span>
        <span class="c1"># &lt;Zenith&gt;</span>
        <span class="c1">#  &lt;COL_STEP unit=&quot;m&quot;&gt;5000&lt;/COL_STEP&gt;</span>
        <span class="c1">#  &lt;ROW_STEP unit=&quot;m&quot;&gt;5000&lt;/ROW_STEP&gt;</span>
        <span class="n">angleGridXres</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sunZenithNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;COL_STEP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">angleGridYres</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sunZenithNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ROW_STEP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">sza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeValueArray</span><span class="p">(</span><span class="n">sunZenithNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Values_List&quot;</span><span class="p">))</span>
        <span class="n">mask_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sza</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_nans</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">skimage.restoration</span> <span class="kn">import</span> <span class="n">inpaint_biharmonic</span>

            <span class="n">sza</span> <span class="o">=</span> <span class="n">inpaint_biharmonic</span><span class="p">(</span><span class="n">sza</span><span class="p">,</span> <span class="n">mask_nans</span><span class="p">)</span>
        <span class="n">transform_zenith</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">from_origin</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">)][</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">)][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">angleGridXres</span><span class="p">,</span>
            <span class="n">angleGridYres</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sza</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">sza</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform_zenith</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span><span class="p">)</span>

        <span class="c1"># Azimuth</span>
        <span class="n">sunAzimuthNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Sun_Angles_Grid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Azimuth&quot;</span><span class="p">)</span>
        <span class="n">angleGridXres</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sunAzimuthNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;COL_STEP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">angleGridYres</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sunAzimuthNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ROW_STEP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">saa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeValueArray</span><span class="p">(</span><span class="n">sunAzimuthNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Values_List&quot;</span><span class="p">))</span>
        <span class="n">mask_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">saa</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_nans</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">skimage.restoration</span> <span class="kn">import</span> <span class="n">inpaint_biharmonic</span>

            <span class="n">saa</span> <span class="o">=</span> <span class="n">inpaint_biharmonic</span><span class="p">(</span><span class="n">saa</span><span class="p">,</span> <span class="n">mask_nans</span><span class="p">)</span>
        <span class="n">transform_azimuth</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">from_origin</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">)][</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">)][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">angleGridXres</span><span class="p">,</span>
            <span class="n">angleGridYres</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saa</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">saa</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform_azimuth</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span><span class="p">)</span>

        <span class="c1"># Now build up the viewing angle per grid cell, from the separate layers</span>
        <span class="c1"># given for each detector for each band. Initially I am going to keep</span>
        <span class="c1"># the bands separate, just to see how that looks.</span>
        <span class="c1"># The names of things in the XML suggest that these are view angles,</span>
        <span class="c1"># but the numbers suggest that they are angles as seen from the pixel&#39;s</span>
        <span class="c1"># frame of reference on the ground, i.e. they are in fact what we ultimately want.</span>
        <span class="n">viewingAngleNodeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
            <span class="s2">&quot;Viewing_Incidence_Angles_Grids&quot;</span>
        <span class="p">)</span>
        <span class="n">vza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buildViewAngleArr</span><span class="p">(</span><span class="n">viewingAngleNodeList</span><span class="p">,</span> <span class="s2">&quot;Zenith&quot;</span><span class="p">)</span>
        <span class="n">vaa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buildViewAngleArr</span><span class="p">(</span><span class="n">viewingAngleNodeList</span><span class="p">,</span> <span class="s2">&quot;Azimuth&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vaa</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">varr</span> <span class="ow">in</span> <span class="n">vaa</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">mask_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">varr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_nans</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">skimage.restoration</span> <span class="kn">import</span> <span class="n">inpaint_biharmonic</span>

                <span class="n">varr</span> <span class="o">=</span> <span class="n">inpaint_biharmonic</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">mask_nans</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">vaa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span>
                <span class="n">varr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform_azimuth</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vza</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">varr</span> <span class="ow">in</span> <span class="n">vza</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">mask_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">varr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_nans</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">skimage.restoration</span> <span class="kn">import</span> <span class="n">inpaint_biharmonic</span>

                <span class="n">varr</span> <span class="o">=</span> <span class="n">inpaint_biharmonic</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">mask_nans</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vza</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span>
                <span class="n">varr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform_zenith</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span>
            <span class="p">)</span>

        <span class="c1"># Make a guess at the coordinates of the angle grids. These are not given</span>
        <span class="c1"># explicitly in the XML, and don&#39;t line up exactly with the other grids, so I am</span>
        <span class="c1"># making a rough estimate. Because the angles don&#39;t change rapidly across these</span>
        <span class="c1"># distances, it is not important if I am a bit wrong (although it would be nice</span>
        <span class="c1"># to be exactly correct!).</span>
        <span class="p">(</span><span class="n">ulx</span><span class="p">,</span> <span class="n">uly</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="s2">&quot;10&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anglesULXY</span> <span class="o">=</span> <span class="p">(</span><span class="n">ulx</span> <span class="o">-</span> <span class="n">angleGridXres</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">uly</span> <span class="o">+</span> <span class="n">angleGridYres</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

        <span class="c1"># Read mean viewing angles for each band.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_vaa</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_vza</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Mean_Viewing_Incidence_Angle_List&quot;</span><span class="p">):</span>
            <span class="n">band_name</span> <span class="o">=</span> <span class="n">BANDS_S2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;bandId&quot;</span><span class="p">])]</span>
            <span class="n">viewing_zenith_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ZENITH_ANGLE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">viewing_azimuth_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;AZIMUTH_ANGLE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_vza</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewing_zenith_angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_vaa</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewing_azimuth_angle</span>

    <span class="k">def</span> <span class="nf">_buildViewAngleArr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewingAngleNodeList</span><span class="p">,</span> <span class="n">angleName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build up the named viewing angle array from the various detector strips given as</span>
<span class="sd">        separate arrays. I don&#39;t really understand this, and may need to re-write it once</span>
<span class="sd">        I have worked it out......</span>

<span class="sd">        The angleName is one of &#39;Zenith&#39; or &#39;Azimuth&#39;.</span>
<span class="sd">        Returns a dictionary of 2-d arrays, keyed by the bandId string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">angleArrDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">viewingAngleNode</span> <span class="ow">in</span> <span class="n">viewingAngleNodeList</span><span class="p">:</span>
            <span class="n">band_name</span> <span class="o">=</span> <span class="n">BANDS_S2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">viewingAngleNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;bandId&quot;</span><span class="p">])]</span>
            <span class="n">detectorId</span> <span class="o">=</span> <span class="n">viewingAngleNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;detectorId&quot;</span><span class="p">]</span>

            <span class="n">angleNode</span> <span class="o">=</span> <span class="n">viewingAngleNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">angleName</span><span class="p">)</span>
            <span class="n">angleArr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeValueArray</span><span class="p">(</span><span class="n">angleNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Values_List&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">band_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">angleArrDict</span><span class="p">:</span>
                <span class="n">angleArrDict</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">angleArr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">angleArr</span><span class="p">)</span>
                <span class="n">angleArrDict</span><span class="p">[</span><span class="n">band_name</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">angleArr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">angleArrDict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_makeValueArray</span><span class="p">(</span><span class="n">valuesListNode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take a &lt;Values_List&gt; node from the XML, and return an array of the values contained</span>
<span class="sd">        within it. This will be a 2-d numpy array of float32 values (should I pass the dtype in??)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valuesList</span> <span class="o">=</span> <span class="n">valuesListNode</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;VALUES&quot;</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">valNode</span> <span class="ow">in</span> <span class="n">valuesList</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">valNode</span><span class="o">.</span><span class="n">text</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="georeader.readers.S2_SAFE_reader.S2ImageL1C.cache_product_to_local_dir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cache_product_to_local_dir</span><span class="p">(</span><span class="n">path_dest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">print_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">format_bands</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C.cache_product_to_local_dir" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Overrides the parent method to copy the MTD_TL.xml file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_dest</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the destination folder. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_progress</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to print progress. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>__class__</code></td>            <td>
                  <code>__class__</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the cached object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cache_product_to_local_dir</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path_dest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">print_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">format_bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overrides the parent method to copy the MTD_TL.xml file</span>

<span class="sd">    Args:</span>
<span class="sd">        path_dest (Optional[str], optional): path to the destination folder. Defaults to None.</span>
<span class="sd">        print_progress (bool, optional): whether to print progress. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        __class__: the cached object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cache_product_to_local_dir</span><span class="p">(</span>
        <span class="n">path_dest</span><span class="o">=</span><span class="n">path_dest</span><span class="p">,</span>
        <span class="n">print_progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">,</span>
        <span class="n">format_bands</span><span class="o">=</span><span class="n">format_bands</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">):</span>
        <span class="c1"># the cached product already exists. returns</span>
        <span class="k">return</span> <span class="n">new_obj</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">)</span>
        <span class="c1"># copy all metadata from the original image</span>
        <span class="k">for</span> <span class="n">atribute</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;tileId&quot;</span><span class="p">,</span>
            <span class="s2">&quot;root_metadata_tl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;satId&quot;</span><span class="p">,</span>
            <span class="s2">&quot;procLevel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dimsByRes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ulxyByRes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tileAnglesNode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_sza&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_saa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_vza&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_vaa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vaa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vza&quot;</span><span class="p">,</span>
            <span class="s2">&quot;saa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sza&quot;</span><span class="p">,</span>
            <span class="s2">&quot;anglesULXY&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atribute</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">new_obj</span><span class="p">,</span> <span class="n">atribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atribute</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">get_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">,</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">)</span>

    <span class="n">granule_folder_rel</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">granule_folder</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="p">)</span>
    <span class="c1"># Add metadata_tl to granules.json</span>
    <span class="n">granules_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;granules.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">granules_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="n">info_granules_metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
    <span class="n">info_granules_metadata</span><span class="p">[</span><span class="s2">&quot;metadata_tl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">granule_folder_rel</span><span class="p">,</span> <span class="s2">&quot;MTD_TL.xml&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">granules_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">info_granules_metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.S2_SAFE_reader.S2ImageL1C.read_metadata_tl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_metadata_tl</span><span class="p">()</span></code>

<a href="#georeader.readers.S2_SAFE_reader.S2ImageL1C.read_metadata_tl" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Read metadata TILE to parse information about the acquisition and properties of GRANULE bands.</p>


<details class="it-populates-the-following-attributes" open>
  <summary>It populates the following attributes</summary>
  <ul>
<li>mean_sza</li>
<li>mean_saa</li>
<li>mean_vza</li>
<li>mean_vaa</li>
<li>vaa</li>
<li>vza</li>
<li>saa</li>
<li>sza</li>
<li>anglesULXY</li>
<li>tileId</li>
<li>satId</li>
<li>procLevel</li>
<li>epsg_code</li>
<li>dimsByRes</li>
<li>ulxyByRes</li>
<li>tileAnglesNode</li>
<li>root_metadata_tl</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_metadata_tl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read metadata TILE to parse information about the acquisition and properties of GRANULE bands.</span>

<span class="sd">    It populates the following attributes:</span>
<span class="sd">        - mean_sza</span>
<span class="sd">        - mean_saa</span>
<span class="sd">        - mean_vza</span>
<span class="sd">        - mean_vaa</span>
<span class="sd">        - vaa</span>
<span class="sd">        - vza</span>
<span class="sd">        - saa</span>
<span class="sd">        - sza</span>
<span class="sd">        - anglesULXY</span>
<span class="sd">        - tileId</span>
<span class="sd">        - satId</span>
<span class="sd">        - procLevel</span>
<span class="sd">        - epsg_code</span>
<span class="sd">        - dimsByRes</span>
<span class="sd">        - ulxyByRes</span>
<span class="sd">        - tileAnglesNode</span>
<span class="sd">        - root_metadata_tl</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span> <span class="o">=</span> <span class="n">read_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_tl</span><span class="p">)</span>

    <span class="c1"># Stoopid XML namespace prefix</span>
    <span class="n">nsPrefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">tag</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">nsDict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n1&quot;</span><span class="p">:</span> <span class="n">nsPrefix</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">mean_sza</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//Mean_Sun_Angle/ZENITH_ANGLE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mean_saa</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//Mean_Sun_Angle/AZIMUTH_ANGLE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="p">)</span>

    <span class="n">generalInfoNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;n1:General_Info&quot;</span><span class="p">,</span> <span class="n">nsDict</span><span class="p">)</span>
    <span class="c1"># N.B. I am still not entirely convinced that this SENSING_TIME is really</span>
    <span class="c1"># the acquisition time, but the documentation is rubbish.</span>
    <span class="n">sensingTimeNode</span> <span class="o">=</span> <span class="n">generalInfoNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;SENSING_TIME&quot;</span><span class="p">)</span>
    <span class="n">sensingTimeStr</span> <span class="o">=</span> <span class="n">sensingTimeNode</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="c1"># self.datetime = datetime.datetime.strptime(sensingTimeStr, &quot;%Y-%m-%dT%H:%M:%S.%fZ&quot;)</span>
    <span class="n">tileIdNode</span> <span class="o">=</span> <span class="n">generalInfoNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;TILE_ID&quot;</span><span class="p">)</span>
    <span class="n">tileIdFullStr</span> <span class="o">=</span> <span class="n">tileIdNode</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tileId</span> <span class="o">=</span> <span class="n">tileIdFullStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">satId</span> <span class="o">=</span> <span class="n">tileIdFullStr</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">procLevel</span> <span class="o">=</span> <span class="n">tileIdFullStr</span><span class="p">[</span>
        <span class="mi">13</span><span class="p">:</span><span class="mi">16</span>
    <span class="p">]</span>  <span class="c1"># Not sure whether to use absolute pos or split by &#39;_&#39;....</span>

    <span class="n">geomInfoNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_metadata_tl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;n1:Geometric_Info&quot;</span><span class="p">,</span> <span class="n">nsDict</span><span class="p">)</span>
    <span class="n">geocodingNode</span> <span class="o">=</span> <span class="n">geomInfoNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Tile_Geocoding&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span> <span class="o">=</span> <span class="n">geocodingNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;HORIZONTAL_CS_CODE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

    <span class="c1"># Dimensions of images at different resolutions.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dimsByRes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sizeNodeList</span> <span class="o">=</span> <span class="n">geocodingNode</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;Size&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sizeNode</span> <span class="ow">in</span> <span class="n">sizeNodeList</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">sizeNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sizeNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;NROWS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sizeNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;NCOLS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimsByRes</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">)</span>

    <span class="c1"># Upper-left corners of images at different resolutions. As far as I can</span>
    <span class="c1"># work out, these coords appear to be the upper left corner of the upper left</span>
    <span class="c1"># pixel, i.e. equivalent to GDAL&#39;s convention. This also means that they</span>
    <span class="c1"># are the same for the different resolutions, which is nice.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">posNodeList</span> <span class="o">=</span> <span class="n">geocodingNode</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;Geoposition&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">posNode</span> <span class="ow">in</span> <span class="n">posNodeList</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">posNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">ulx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">posNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ULX&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">uly</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">posNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ULY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ulx</span><span class="p">,</span> <span class="n">uly</span><span class="p">)</span>

    <span class="c1"># Sun and satellite angles.</span>
    <span class="c1"># Zenith</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span> <span class="o">=</span> <span class="n">geomInfoNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Tile_Angles&quot;</span><span class="p">)</span>
    <span class="n">sunZenithNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Sun_Angles_Grid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Zenith&quot;</span><span class="p">)</span>
    <span class="c1"># &lt;Zenith&gt;</span>
    <span class="c1">#  &lt;COL_STEP unit=&quot;m&quot;&gt;5000&lt;/COL_STEP&gt;</span>
    <span class="c1">#  &lt;ROW_STEP unit=&quot;m&quot;&gt;5000&lt;/ROW_STEP&gt;</span>
    <span class="n">angleGridXres</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sunZenithNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;COL_STEP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">angleGridYres</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sunZenithNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ROW_STEP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">sza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeValueArray</span><span class="p">(</span><span class="n">sunZenithNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Values_List&quot;</span><span class="p">))</span>
    <span class="n">mask_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sza</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_nans</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">skimage.restoration</span> <span class="kn">import</span> <span class="n">inpaint_biharmonic</span>

        <span class="n">sza</span> <span class="o">=</span> <span class="n">inpaint_biharmonic</span><span class="p">(</span><span class="n">sza</span><span class="p">,</span> <span class="n">mask_nans</span><span class="p">)</span>
    <span class="n">transform_zenith</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">from_origin</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">)][</span><span class="mi">0</span><span class="p">],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">)][</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">angleGridXres</span><span class="p">,</span>
        <span class="n">angleGridYres</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sza</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">sza</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform_zenith</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span><span class="p">)</span>

    <span class="c1"># Azimuth</span>
    <span class="n">sunAzimuthNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Sun_Angles_Grid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Azimuth&quot;</span><span class="p">)</span>
    <span class="n">angleGridXres</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sunAzimuthNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;COL_STEP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">angleGridYres</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sunAzimuthNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ROW_STEP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeValueArray</span><span class="p">(</span><span class="n">sunAzimuthNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Values_List&quot;</span><span class="p">))</span>
    <span class="n">mask_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">saa</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_nans</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">skimage.restoration</span> <span class="kn">import</span> <span class="n">inpaint_biharmonic</span>

        <span class="n">saa</span> <span class="o">=</span> <span class="n">inpaint_biharmonic</span><span class="p">(</span><span class="n">saa</span><span class="p">,</span> <span class="n">mask_nans</span><span class="p">)</span>
    <span class="n">transform_azimuth</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">from_origin</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">)][</span><span class="mi">0</span><span class="p">],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_res</span><span class="p">)][</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">angleGridXres</span><span class="p">,</span>
        <span class="n">angleGridYres</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">saa</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">saa</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform_azimuth</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span><span class="p">)</span>

    <span class="c1"># Now build up the viewing angle per grid cell, from the separate layers</span>
    <span class="c1"># given for each detector for each band. Initially I am going to keep</span>
    <span class="c1"># the bands separate, just to see how that looks.</span>
    <span class="c1"># The names of things in the XML suggest that these are view angles,</span>
    <span class="c1"># but the numbers suggest that they are angles as seen from the pixel&#39;s</span>
    <span class="c1"># frame of reference on the ground, i.e. they are in fact what we ultimately want.</span>
    <span class="n">viewingAngleNodeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
        <span class="s2">&quot;Viewing_Incidence_Angles_Grids&quot;</span>
    <span class="p">)</span>
    <span class="n">vza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buildViewAngleArr</span><span class="p">(</span><span class="n">viewingAngleNodeList</span><span class="p">,</span> <span class="s2">&quot;Zenith&quot;</span><span class="p">)</span>
    <span class="n">vaa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buildViewAngleArr</span><span class="p">(</span><span class="n">viewingAngleNodeList</span><span class="p">,</span> <span class="s2">&quot;Azimuth&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">vaa</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">varr</span> <span class="ow">in</span> <span class="n">vaa</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mask_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">varr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_nans</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">skimage.restoration</span> <span class="kn">import</span> <span class="n">inpaint_biharmonic</span>

            <span class="n">varr</span> <span class="o">=</span> <span class="n">inpaint_biharmonic</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">mask_nans</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vaa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span>
            <span class="n">varr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform_azimuth</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">vza</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">varr</span> <span class="ow">in</span> <span class="n">vza</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mask_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">varr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_nans</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">skimage.restoration</span> <span class="kn">import</span> <span class="n">inpaint_biharmonic</span>

            <span class="n">varr</span> <span class="o">=</span> <span class="n">inpaint_biharmonic</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">mask_nans</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vza</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span>
            <span class="n">varr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform_zenith</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg_code</span>
        <span class="p">)</span>

    <span class="c1"># Make a guess at the coordinates of the angle grids. These are not given</span>
    <span class="c1"># explicitly in the XML, and don&#39;t line up exactly with the other grids, so I am</span>
    <span class="c1"># making a rough estimate. Because the angles don&#39;t change rapidly across these</span>
    <span class="c1"># distances, it is not important if I am a bit wrong (although it would be nice</span>
    <span class="c1"># to be exactly correct!).</span>
    <span class="p">(</span><span class="n">ulx</span><span class="p">,</span> <span class="n">uly</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ulxyByRes</span><span class="p">[</span><span class="s2">&quot;10&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">anglesULXY</span> <span class="o">=</span> <span class="p">(</span><span class="n">ulx</span> <span class="o">-</span> <span class="n">angleGridXres</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">uly</span> <span class="o">+</span> <span class="n">angleGridYres</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="c1"># Read mean viewing angles for each band.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mean_vaa</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mean_vza</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAnglesNode</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Mean_Viewing_Incidence_Angle_List&quot;</span><span class="p">):</span>
        <span class="n">band_name</span> <span class="o">=</span> <span class="n">BANDS_S2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;bandId&quot;</span><span class="p">])]</span>
        <span class="n">viewing_zenith_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ZENITH_ANGLE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">viewing_azimuth_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;AZIMUTH_ANGLE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_vza</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewing_zenith_angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_vaa</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">viewing_azimuth_angle</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="georeader.readers.S2_SAFE_reader.S2ImageL2A" class="doc doc-heading">
            <code>S2ImageL2A</code>


<a href="#georeader.readers.S2_SAFE_reader.S2ImageL2A" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="georeader.readers.S2_SAFE_reader.S2Image" href="#georeader.readers.S2_SAFE_reader.S2Image">S2Image</a></code></p>


        <p>Sentinel-2 Level 2A (surface reflectance) image reader.</p>
<p>This class extends the base S2Image class to handle Sentinel-2 Level 2A products,
which provide surface reflectance data with atmospheric corrections applied.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s2folder</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Sentinel-2 SAFE product folder.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>granules</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping band names to file paths.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polygon</code>
            </td>
            <td>
                  <code><span title="shapely.geometry.Polygon">Polygon</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polygon defining the area of interest in EPSG:4326.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_res</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output resolution in meters. Must be one of 10, 20, or 60. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_focus</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Window to focus on a specific
region of the image. Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to read. If None, the default L2A bands
(excluding B10) will be loaded.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata_msi</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to metadata file. If None, it is assumed to be
in the SAFE folder.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.mission">mission</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mission identifier (e.g., 'S2A', 'S2B').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.producttype">producttype</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Product type identifier (e.g., 'MSIL2A').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.pdgs">pdgs</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PDGS Processing Baseline number.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.relorbitnum">relorbitnum</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relative Orbit number.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.tile_number_field">tile_number_field</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tile Number field.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.product_discriminator">product_discriminator</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Product Discriminator.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.name">name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base name of the product.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.folder">folder</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the product folder.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.datetime">datetime</span></code></td>
            <td>
                  <code>datetime</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Acquisition datetime.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.metadata_msi">metadata_msi</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the MSI metadata file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.out_res">out_res</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output resolution in meters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.bands">bands</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to read.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.dims">dims</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the dimensions ("band", "y", "x").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.fill_value_default">fill_value_default</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default fill value (typically 0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.band_check">band_check</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Band used as template for reading.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.granule_readers">granule_readers</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <a class="autorefs autorefs-internal" title="georeader.rasterio_reader.RasterioReader" href="../rasterio_reader/#georeader.rasterio_reader.RasterioReader">RasterioReader</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of readers for each band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.S2_SAFE_reader.S2ImageL2A.window_focus">window_focus</span></code></td>
            <td>
                  <code><span title="rasterio.windows.Window">Window</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current window focus.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize the S2ImageL2A reader with a data path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2_l2a</span> <span class="o">=</span> <span class="n">S2ImageL2A</span><span class="p">(</span><span class="s1">&#39;/path/to/S2A_MSIL2A_20170717T235959_N0205_R072_T01WCP_20170718T000256.SAFE&#39;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">granules</span><span class="o">=</span><span class="n">granules_dict</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="n">aoi_polygon</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load all bands</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l2a_data</span> <span class="o">=</span> <span class="n">s2_l2a</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">S2ImageL2A</span><span class="p">(</span><span class="n">S2Image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sentinel-2 Level 2A (surface reflectance) image reader.</span>

<span class="sd">    This class extends the base S2Image class to handle Sentinel-2 Level 2A products,</span>
<span class="sd">    which provide surface reflectance data with atmospheric corrections applied.</span>

<span class="sd">    Args:</span>
<span class="sd">        s2folder (str): Path to the Sentinel-2 SAFE product folder.</span>
<span class="sd">        granules (Dict[str, str]): Dictionary mapping band names to file paths.</span>
<span class="sd">        polygon (Polygon): Polygon defining the area of interest in EPSG:4326.</span>
<span class="sd">        out_res (int): Output resolution in meters. Must be one of 10, 20, or 60. Defaults to 10.</span>
<span class="sd">        window_focus (Optional[rasterio.windows.Window]): Window to focus on a specific</span>
<span class="sd">            region of the image. Defaults to None (entire image).</span>
<span class="sd">        bands (Optional[List[str]]): List of bands to read. If None, the default L2A bands</span>
<span class="sd">            (excluding B10) will be loaded.</span>
<span class="sd">        metadata_msi (Optional[str]): Path to metadata file. If None, it is assumed to be</span>
<span class="sd">            in the SAFE folder.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        mission (str): Mission identifier (e.g., &#39;S2A&#39;, &#39;S2B&#39;).</span>
<span class="sd">        producttype (str): Product type identifier (e.g., &#39;MSIL2A&#39;).</span>
<span class="sd">        pdgs (str): PDGS Processing Baseline number.</span>
<span class="sd">        relorbitnum (str): Relative Orbit number.</span>
<span class="sd">        tile_number_field (str): Tile Number field.</span>
<span class="sd">        product_discriminator (str): Product Discriminator.</span>
<span class="sd">        name (str): Base name of the product.</span>
<span class="sd">        folder (str): Path to the product folder.</span>
<span class="sd">        datetime (datetime): Acquisition datetime.</span>
<span class="sd">        metadata_msi (str): Path to the MSI metadata file.</span>
<span class="sd">        out_res (int): Output resolution in meters.</span>
<span class="sd">        bands (List[str]): List of bands to read.</span>
<span class="sd">        dims (Tuple[str]): Names of the dimensions (&quot;band&quot;, &quot;y&quot;, &quot;x&quot;).</span>
<span class="sd">        fill_value_default (int): Default fill value (typically 0).</span>
<span class="sd">        band_check (str): Band used as template for reading.</span>
<span class="sd">        granule_readers (Dict[str, RasterioReader]): Dictionary of readers for each band.</span>
<span class="sd">        window_focus (rasterio.windows.Window): Current window focus.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Initialize the S2ImageL2A reader with a data path</span>
<span class="sd">        &gt;&gt;&gt; s2_l2a = S2ImageL2A(&#39;/path/to/S2A_MSIL2A_20170717T235959_N0205_R072_T01WCP_20170718T000256.SAFE&#39;,</span>
<span class="sd">        ...                     granules=granules_dict, polygon=aoi_polygon)</span>
<span class="sd">        &gt;&gt;&gt; # Load all bands</span>
<span class="sd">        &gt;&gt;&gt; l2a_data = s2_l2a.load()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">s2folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">granules</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">polygon</span><span class="p">:</span> <span class="n">Polygon</span><span class="p">,</span>
        <span class="n">out_res</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">window_focus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_msi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bands</span> <span class="o">=</span> <span class="n">BANDS_S2_L2A</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">S2ImageL2A</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">s2folder</span><span class="o">=</span><span class="n">s2folder</span><span class="p">,</span>
            <span class="n">granules</span><span class="o">=</span><span class="n">granules</span><span class="p">,</span>
            <span class="n">polygon</span><span class="o">=</span><span class="n">polygon</span><span class="p">,</span>
            <span class="n">out_res</span><span class="o">=</span><span class="n">out_res</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">window_focus</span><span class="o">=</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="n">metadata_msi</span><span class="o">=</span><span class="n">metadata_msi</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">producttype</span> <span class="o">==</span> <span class="s2">&quot;MSIL2A&quot;</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Unexpected product type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">producttype</span><span class="si">}</span><span class="s2"> in image </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="georeader.readers.S2_SAFE_reader.s2loader" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">s2loader</span><span class="p">(</span><span class="n">s2folder</span><span class="p">,</span> <span class="n">out_res</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window_focus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">granules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata_msi</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.S2_SAFE_reader.s2loader" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Loads a S2ImageL2A or S2ImageL1C depending on the product type</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s2folder</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>.SAFE folder. Expected standard ESA naming convention (see s2_name_split fun)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_res</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default output resolution {10, 20, 60}</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bands to read. Default to BANDS_S2 or BANDS_S2_L2A depending on the product type</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_focus</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>window to read when creating the object</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>granules</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict where keys are the band names and values are paths to the band location</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polygon</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="shapely.geometry.Polygon">Polygon</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>polygon with the footprint of the object</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata_msi</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to metadata file</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="georeader.readers.S2_SAFE_reader.S2ImageL2A" href="#georeader.readers.S2_SAFE_reader.S2ImageL2A">S2ImageL2A</a>, <a class="autorefs autorefs-internal" title="georeader.readers.S2_SAFE_reader.S2ImageL1C" href="#georeader.readers.S2_SAFE_reader.S2ImageL1C">S2ImageL1C</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>S2Image reader</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">s2loader</span><span class="p">(</span>
    <span class="n">s2folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">out_res</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">window_focus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">granules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">polygon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata_msi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">S2ImageL2A</span><span class="p">,</span> <span class="n">S2ImageL1C</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a S2ImageL2A or S2ImageL1C depending on the product type</span>

<span class="sd">    Args:</span>
<span class="sd">        s2folder: .SAFE folder. Expected standard ESA naming convention (see s2_name_split fun)</span>
<span class="sd">        out_res: default output resolution {10, 20, 60}</span>
<span class="sd">        bands: Bands to read. Default to BANDS_S2 or BANDS_S2_L2A depending on the product type</span>
<span class="sd">        window_focus: window to read when creating the object</span>
<span class="sd">        granules: Dict where keys are the band names and values are paths to the band location</span>
<span class="sd">        polygon: polygon with the footprint of the object</span>
<span class="sd">        metadata_msi: path to metadata file</span>

<span class="sd">    Returns:</span>
<span class="sd">        S2Image reader</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">producttype_nos2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">s2_name_split</span><span class="p">(</span><span class="n">s2folder</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">producttype_nos2</span> <span class="o">==</span> <span class="s2">&quot;MSIL2A&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">S2ImageL2A</span><span class="p">(</span>
            <span class="n">s2folder</span><span class="p">,</span>
            <span class="n">granules</span><span class="o">=</span><span class="n">granules</span><span class="p">,</span>
            <span class="n">polygon</span><span class="o">=</span><span class="n">polygon</span><span class="p">,</span>
            <span class="n">out_res</span><span class="o">=</span><span class="n">out_res</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">window_focus</span><span class="o">=</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="n">metadata_msi</span><span class="o">=</span><span class="n">metadata_msi</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">producttype_nos2</span> <span class="o">==</span> <span class="s2">&quot;MSIL1C&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">S2ImageL1C</span><span class="p">(</span>
            <span class="n">s2folder</span><span class="p">,</span>
            <span class="n">granules</span><span class="o">=</span><span class="n">granules</span><span class="p">,</span>
            <span class="n">polygon</span><span class="o">=</span><span class="n">polygon</span><span class="p">,</span>
            <span class="n">out_res</span><span class="o">=</span><span class="n">out_res</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">window_focus</span><span class="o">=</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="n">metadata_msi</span><span class="o">=</span><span class="n">metadata_msi</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t know how to load </span><span class="si">{</span><span class="n">producttype_nos2</span><span class="si">}</span><span class="s2"> products&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="georeader.readers.S2_SAFE_reader.s2_public_bucket_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">s2_public_bucket_path</span><span class="p">(</span><span class="n">s2file</span><span class="p">,</span> <span class="n">check_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;gcp&#39;</span><span class="p">)</span></code>

<a href="#georeader.readers.S2_SAFE_reader.s2_public_bucket_path" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Returns the expected patch in the public bucket of the S2 file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s2file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>safe file (e.g.  S2B_MSIL1C_20220527T030539_N0400_R075_T49SGV_20220527T051042.SAFE)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>check_exists</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>check if the file exists in the bucket, This will not work if GOOGLE_APPLICATION_CREDENTIALS and/or GS_USER_PROJECT
env variables are not set. Default to False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mode</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"gcp" or "rest"</p>
              </div>
            </td>
            <td>
                  <code>&#39;gcp&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>full path to the file (e.g. gs://gcp-public-data-sentinel-2/tiles/49/S/GV/S2B_MSIL1C_20220527T030539_N0400_R075_T49SGV_20220527T051042.SAFE)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">s2_public_bucket_path</span><span class="p">(</span>
    <span class="n">s2file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">check_exists</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gcp&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the expected patch in the public bucket of the S2 file</span>

<span class="sd">    Args:</span>
<span class="sd">        s2file: safe file (e.g.  S2B_MSIL1C_20220527T030539_N0400_R075_T49SGV_20220527T051042.SAFE)</span>
<span class="sd">        check_exists: check if the file exists in the bucket, This will not work if GOOGLE_APPLICATION_CREDENTIALS and/or GS_USER_PROJECT</span>
<span class="sd">            env variables are not set. Default to False</span>
<span class="sd">        mode: &quot;gcp&quot; or &quot;rest&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        full path to the file (e.g. gs://gcp-public-data-sentinel-2/tiles/49/S/GV/S2B_MSIL1C_20220527T030539_N0400_R075_T49SGV_20220527T051042.SAFE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span>
        <span class="n">mission</span><span class="p">,</span>
        <span class="n">producttype</span><span class="p">,</span>
        <span class="n">sensing_date_str</span><span class="p">,</span>
        <span class="n">pdgs</span><span class="p">,</span>
        <span class="n">relorbitnum</span><span class="p">,</span>
        <span class="n">tile_number_field</span><span class="p">,</span>
        <span class="n">product_discriminator</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">s2_name_split</span><span class="p">(</span><span class="n">s2file</span><span class="p">)</span>
    <span class="n">s2file</span> <span class="o">=</span> <span class="n">s2file</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">s2file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">s2file</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">s2file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.SAFE&quot;</span><span class="p">):</span>
        <span class="n">s2file</span> <span class="o">+=</span> <span class="s2">&quot;.SAFE&quot;</span>

    <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">s2file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;gcp&quot;</span><span class="p">:</span>
        <span class="n">s2folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FULL_PATH_PUBLIC_BUCKET_SENTINEL_2</span><span class="si">}</span><span class="s2">tiles/</span><span class="si">{</span><span class="n">tile_number_field</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">tile_number_field</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">tile_number_field</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;rest&quot;</span><span class="p">:</span>
        <span class="n">s2folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://storage.googleapis.com/gcp-public-data-sentinel-2/tiles/</span><span class="si">{</span><span class="n">tile_number_field</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">tile_number_field</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">tile_number_field</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2"> unknown&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_exists</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;gcp&quot;</span><span class="p">):</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">get_filesystem</span><span class="p">(</span><span class="n">s2folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">s2folder</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sentinel-2 file not found in </span><span class="si">{</span><span class="n">s2folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">s2folder</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="georeader.readers.S2_SAFE_reader.read_srf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_srf</span><span class="p">(</span><span class="n">satellite</span><span class="p">,</span> <span class="n">srf_file</span><span class="o">=</span><span class="n">SRF_FILE_DEFAULT</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.S2_SAFE_reader.read_srf" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Process the spectral response function file. If the file is not provided
it downloads it from https://sentinel.esa.int/web/sentinel/user-guides/sentinel-2-msi/document-library/-/asset_publisher/Wk0TKajiISaR/content/sentinel-2a-spectral-responses</p>
<p>This function requires the fsspec package and pandas and openpyxl for reading excel files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>satellite</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>satellite name (S2A, S2B or S2C)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>srf_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the srf file</p>
              </div>
            </td>
            <td>
                  <code><span title="georeader.readers.S2_SAFE_reader.SRF_FILE_DEFAULT">SRF_FILE_DEFAULT</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cache</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, the srf is cached for future calls. Default True</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: spectral response function for each of the bands of S2</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/S2_SAFE_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_srf</span><span class="p">(</span>
    <span class="n">satellite</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">srf_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SRF_FILE_DEFAULT</span><span class="p">,</span> <span class="n">cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process the spectral response function file. If the file is not provided</span>
<span class="sd">    it downloads it from https://sentinel.esa.int/web/sentinel/user-guides/sentinel-2-msi/document-library/-/asset_publisher/Wk0TKajiISaR/content/sentinel-2a-spectral-responses</span>

<span class="sd">    This function requires the fsspec package and pandas and openpyxl for reading excel files.</span>

<span class="sd">    Args:</span>
<span class="sd">        satellite (str): satellite name (S2A, S2B or S2C)</span>
<span class="sd">        srf_file (str): path to the srf file</span>
<span class="sd">        cache (bool): if True, the srf is cached for future calls. Default True</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: spectral response function for each of the bands of S2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">satellite</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;S2A&quot;</span><span class="p">,</span> <span class="s2">&quot;S2B&quot;</span><span class="p">,</span> <span class="s2">&quot;S2C&quot;</span><span class="p">],</span> <span class="s2">&quot;satellite must be S2A or S2B&quot;</span>

    <span class="k">if</span> <span class="n">cache</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">SRF_S2</span>
        <span class="k">if</span> <span class="n">satellite</span> <span class="ow">in</span> <span class="n">SRF_S2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SRF_S2</span><span class="p">[</span><span class="n">satellite</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">srf_file</span> <span class="o">==</span> <span class="n">SRF_FILE_DEFAULT</span><span class="p">:</span>
        <span class="c1"># home_dir = os.path.join(os.path.expanduser(&#39;~&#39;),&quot;.georeader&quot;)</span>
        <span class="n">home_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="s2">&quot;.georeader&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">home_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">srf_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">srf_file</span><span class="p">)</span>

        <span class="c1"># Decode the url to get the filename. Also, replace spaces with underscores</span>
        <span class="kn">import</span> <span class="nn">urllib.parse</span>

        <span class="n">srf_filename</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">srf_filename</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

        <span class="n">srf_file_local</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_dir</span><span class="p">,</span> <span class="n">srf_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">srf_file_local</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">fsspec</span>

            <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">srf_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">srf_file_local</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
                    <span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">srf_file</span> <span class="o">=</span> <span class="n">srf_file_local</span>

    <span class="n">srf_s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">srf_file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Spectral Responses (</span><span class="si">{</span><span class="n">satellite</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="n">srf_s2</span> <span class="o">=</span> <span class="n">srf_s2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;SR_WL&quot;</span><span class="p">)</span>

    <span class="c1"># remove rows with all values zero</span>
    <span class="n">any_not_cero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">srf_s2</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">srf_s2</span> <span class="o">=</span> <span class="n">srf_s2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">any_not_cero</span><span class="p">]</span>

    <span class="c1"># remove the satellite name from the columns</span>
    <span class="n">srf_s2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">satellite</span><span class="si">}</span><span class="s2">_SR_AV_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">srf_s2</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">srf_s2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">normalize_band_names</span><span class="p">(</span><span class="n">srf_s2</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cache</span><span class="p">:</span>
        <span class="n">SRF_S2</span><span class="p">[</span><span class="n">satellite</span><span class="p">]</span> <span class="o">=</span> <span class="n">srf_s2</span>

    <span class="k">return</span> <span class="n">srf_s2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="proba-v-reader">Proba-V Reader<a class="headerlink" href="#proba-v-reader" title="Permanent link">&para;</a></h2>
<p>The Proba-V reader enables access to Proba-V Level 2A and Level 3 products. It handles:</p>
<ul>
<li>Reading TOA reflectance from HDF5 files</li>
<li>Mask handling for clouds, shadows, and invalid pixels</li>
<li>Extraction of metadata and acquisition parameters</li>
</ul>
<p><strong>Tutorial example:</strong></p>
<ul>
<li><a href="../../read_overlapping_probav_and_sentinel2/">Reading overlapping Proba-V and Sentinel-2 images</a></li>
</ul>
<h3 id="api-reference_1">API Reference<a class="headerlink" href="#api-reference_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="georeader.readers.probav_image_operational"></a>
    <div class="doc doc-contents first">

        <p>Proba-V reader</p>
<p>Unnoficial Proba-V reader. This reader is based in the Proba-V user manual:
https://publications.vito.be/2017-1333-probav-products-user-manual.pdf</p>
<p>Author:  Gonzalo Mateo-García</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="georeader.readers.probav_image_operational.ProbaV" class="doc doc-heading">
            <code>ProbaV</code>


<a href="#georeader.readers.probav_image_operational.ProbaV" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Proba-V reader for handling Proba-V satellite products.</p>
<p>This class provides functionality to read and manipulate Proba-V satellite imagery products.
It handles the specific format and metadata of Proba-V HDF5 files, supporting operations
like loading radiometry data, masks, and cloud information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hdf5_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF5 file containing the Proba-V product.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional window to focus on a specific
region of the image. Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>level_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing level of the product, either "LEVEL2A" or "LEVEL3".
Defaults to "LEVEL3".</p>
              </div>
            </td>
            <td>
                  <code>&#39;LEVEL3&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.hdf5_file">hdf5_file</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF5 file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.name">name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Basename of the HDF5 file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.camera">camera</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera ID (for LEVEL2A products).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.res_name">res_name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolution name identifier (e.g., '100M', '300M', '1KM').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.version">version</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Product version.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.toatoc">toatoc</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicator of whether data is TOA (top of atmosphere) or TOC (top of canopy).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.real_transform">real_transform</span></code></td>
            <td>
                  <code><span title="rasterio.Affine">Affine</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Affine transform for the full image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.real_shape">real_shape</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of the full image (height, width).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.dtype_radiometry">dtype_radiometry</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type for radiometry data (typically np.float32).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.dtype_sm">dtype_sm</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type for SM (status map) data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.metadata">metadata</span></code></td>
            <td>
                  <code>Dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with product metadata.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.window_focus">window_focus</span></code></td>
            <td>
                  <code><span title="rasterio.windows.Window">Window</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current window focus.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.window_data">window_data</span></code></td>
            <td>
                  <code><span title="rasterio.windows.Window">Window</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Window representing the full data extent.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.start_date">start_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start acquisition date and time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.end_date">end_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End acquisition date and time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.map_projection_wkt">map_projection_wkt</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>WKT representation of the map projection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.crs">crs</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinate reference system.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaV.level_name">level_name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing level identifier.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">rasterio.windows</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize the ProbaV reader with a data path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">probav_reader</span> <span class="o">=</span> <span class="n">ProbaV</span><span class="p">(</span><span class="s1">&#39;/path/to/probav_product.HDF5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load radiometry data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bands</span> <span class="o">=</span> <span class="n">probav_reader</span><span class="o">.</span><span class="n">load_radiometry</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get cloud mask</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">probav_reader</span><span class="o">.</span><span class="n">load_sm_cloud_mask</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Focus on a specific window</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">window</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">col_off</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">row_off</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">probav_reader</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/probav_image_operational.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProbaV</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Proba-V reader for handling Proba-V satellite products.</span>

<span class="sd">    This class provides functionality to read and manipulate Proba-V satellite imagery products.</span>
<span class="sd">    It handles the specific format and metadata of Proba-V HDF5 files, supporting operations</span>
<span class="sd">    like loading radiometry data, masks, and cloud information.</span>

<span class="sd">    Args:</span>
<span class="sd">        hdf5_file (str): Path to the HDF5 file containing the Proba-V product.</span>
<span class="sd">        window (Optional[rasterio.windows.Window]): Optional window to focus on a specific</span>
<span class="sd">            region of the image. Defaults to None (entire image).</span>
<span class="sd">        level_name (str): Processing level of the product, either &quot;LEVEL2A&quot; or &quot;LEVEL3&quot;.</span>
<span class="sd">            Defaults to &quot;LEVEL3&quot;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        hdf5_file (str): Path to the HDF5 file.</span>
<span class="sd">        name (str): Basename of the HDF5 file.</span>
<span class="sd">        camera (str): Camera ID (for LEVEL2A products).</span>
<span class="sd">        res_name (str): Resolution name identifier (e.g., &#39;100M&#39;, &#39;300M&#39;, &#39;1KM&#39;).</span>
<span class="sd">        version (str): Product version.</span>
<span class="sd">        toatoc (str): Indicator of whether data is TOA (top of atmosphere) or TOC (top of canopy).</span>
<span class="sd">        real_transform (rasterio.Affine): Affine transform for the full image.</span>
<span class="sd">        real_shape (Tuple[int, int]): Shape of the full image (height, width).</span>
<span class="sd">        dtype_radiometry: Data type for radiometry data (typically np.float32).</span>
<span class="sd">        dtype_sm: Data type for SM (status map) data.</span>
<span class="sd">        metadata (Dict[str, Any]): Dictionary with product metadata.</span>
<span class="sd">        window_focus (rasterio.windows.Window): Current window focus.</span>
<span class="sd">        window_data (rasterio.windows.Window): Window representing the full data extent.</span>
<span class="sd">        start_date (datetime): Start acquisition date and time.</span>
<span class="sd">        end_date (datetime): End acquisition date and time.</span>
<span class="sd">        map_projection_wkt (str): WKT representation of the map projection.</span>
<span class="sd">        crs: Coordinate reference system.</span>
<span class="sd">        level_name (str): Processing level identifier.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import rasterio.windows</span>
<span class="sd">        &gt;&gt;&gt; # Initialize the ProbaV reader with a data path</span>
<span class="sd">        &gt;&gt;&gt; probav_reader = ProbaV(&#39;/path/to/probav_product.HDF5&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # Load radiometry data</span>
<span class="sd">        &gt;&gt;&gt; bands = probav_reader.load_radiometry()</span>
<span class="sd">        &gt;&gt;&gt; # Get cloud mask</span>
<span class="sd">        &gt;&gt;&gt; cloud_mask = probav_reader.load_sm_cloud_mask()</span>
<span class="sd">        &gt;&gt;&gt; # Focus on a specific window</span>
<span class="sd">        &gt;&gt;&gt; window = rasterio.windows.Window(col_off=100, row_off=100, width=200, height=200)</span>
<span class="sd">        &gt;&gt;&gt; probav_reader.set_window(window)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hdf5_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LEVEL3&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span> <span class="o">=</span> <span class="n">hdf5_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">level_name</span> <span class="o">==</span> <span class="s2">&quot;LEVEL2A&quot;</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;PROBAV_L2A_\d</span><span class="si">{8}</span><span class="s2">_\d</span><span class="si">{6}</span><span class="s2">_(\d)_(\d..?M)_(V\d0\d)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span> <span class="o">=</span> <span class="s2">&quot;TOA&quot;</span>
        <span class="k">elif</span> <span class="n">level_name</span> <span class="o">==</span> <span class="s2">&quot;LEVEL3&quot;</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;PROBAV_S1_(TO.)_.</span><span class="si">{6}</span><span class="s2">_\d</span><span class="si">{8}</span><span class="s2">_(\d..?M)_(V\d0\d)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown level name </span><span class="si">{</span><span class="n">level_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_f</span><span class="p">:</span>
                <span class="c1"># reference metadata: http://www.vito-eodata.be/PDF/image/PROBAV-Products_User_Manual.pdf</span>
                <span class="n">valores_blue</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">input_f</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/RADIOMETRY/BLUE/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;MAPPING&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span> <span class="o">=</span> <span class="n">Affine</span><span class="p">(</span>
                    <span class="n">a</span><span class="o">=</span><span class="n">valores_blue</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="n">valores_blue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">e</span><span class="o">=-</span><span class="n">valores_blue</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">valores_blue</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span> <span class="o">=</span> <span class="n">input_f</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/RADIOMETRY/BLUE/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">shape</span>
                <span class="c1"># self.dtype_radiometry = input_f[f&quot;{level_name}/RADIOMETRY/RED/{self.toatoc}&quot;].dtype</span>

                <span class="c1"># Set to float because we&#39;re converting the image to TOA when reading (see read_radiometry function)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dtype_radiometry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dtype_sm</span> <span class="o">=</span> <span class="n">input_f</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/QUALITY/SM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">input_f</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Error opening file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span>
                <span class="n">row_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">col_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span>
                <span class="n">row_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">col_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window_data</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span>
            <span class="n">row_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">col_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;OBSERVATION_END_DATE&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;OBSERVATION_END_DATE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;OBSERVATION_END_TIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;OBSERVATION_START_DATE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;OBSERVATION_START_TIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_projection_wkt</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;MAP_PROJECTION_WKT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="c1"># Proba-V images are lat/long</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="p">({</span><span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="s2">&quot;epsg:4326&quot;</span><span class="p">})</span>

        <span class="c1"># Proba-V images have four bands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_name</span> <span class="o">=</span> <span class="n">level_name</span>

    <span class="k">def</span> <span class="nf">_get_window_pad</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]]:</span>
        <span class="n">window_read</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">boundless</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">pad_width</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">get_slice_pad</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span>
            <span class="p">)</span>
            <span class="n">need_pad</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pad_width</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pad_width</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">need_pad</span><span class="p">:</span>
                <span class="n">pad_list_np</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pad_width</span><span class="p">:</span>
                        <span class="n">pad_list_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pad_width</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pad_list_np</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pad_list_np</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pad_list_np</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">window_read</span><span class="p">,</span> <span class="n">pad_list_np</span>

    <span class="k">def</span> <span class="nf">footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Polygon</span><span class="p">:</span>
        <span class="c1"># TODO load footprint from metadata?</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">window_polygon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">compare_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span>

        <span class="k">return</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">valid_footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Polygon</span><span class="p">:</span>
        <span class="n">valids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_mask</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">valids</span><span class="o">.</span><span class="n">valid_footprint</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_bands</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">fill_value_default</span><span class="p">:</span> <span class="n">Number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">window_read</span><span class="p">,</span> <span class="n">pad_list_np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_window_pad</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
        <span class="n">slice_</span> <span class="o">=</span> <span class="n">window_read</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bands_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">bands_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">bands_names</span><span class="p">]</span>
            <span class="n">flatten</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flatten</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_f</span><span class="p">:</span>
            <span class="n">bands_arrs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands_names</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">read_band_toa</span><span class="p">(</span><span class="n">input_f</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">slice_</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pad_list_np</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">,</span>
                        <span class="nb">tuple</span><span class="p">(</span><span class="n">pad_list_np</span><span class="p">),</span>
                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                        <span class="n">constant_values</span><span class="o">=</span><span class="n">fill_value_default</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">bands_arrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">boundless</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">window_read</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flatten</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">bands_arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">bands_arrs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">fill_value_default</span><span class="o">=</span><span class="n">fill_value_default</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            img: (4, self.real_height, self.real_width, 4) tensor</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="p">),</span> <span class="s2">&quot;Unexpected number of channels expected 4 found </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Unexpected shape expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="si">}</span><span class="s2"> found </span><span class="si">{</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># TODO save only window_focus?</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">BAND_NAMES</span><span class="p">):</span>
                <span class="n">band_to_save</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">mask_band_2_save</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmaskarray</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">band_to_save</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">band_to_save</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">band_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/RADIOMETRY/</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="n">input_f</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
                <span class="n">band_to_save</span> <span class="o">*=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;SCALE&quot;</span><span class="p">]</span>
                <span class="n">band_to_save</span> <span class="o">+=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;OFFSET&quot;</span><span class="p">]</span>
                <span class="n">band_to_save</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">band_to_save</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
                <span class="n">band_to_save</span><span class="p">[</span><span class="n">mask_band_2_save</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">input_f</span><span class="p">[</span><span class="n">band_name</span><span class="p">][</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">band_to_save</span>

    <span class="k">def</span> <span class="nf">load_radiometry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">indexes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">bands_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/RADIOMETRY/</span><span class="si">{</span><span class="n">BAND_NAMES</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexes</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bands</span><span class="p">(</span>
            <span class="n">bands_names</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=-</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">2000.0</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reference of values in `SM` flags.</span>

<span class="sd">        From [user manual](http://www.vito-eodata.be/PDF/image/PROBAV-Products_User_Manual.pdf) pag 67</span>
<span class="sd">        * Clear  -&gt;    000</span>
<span class="sd">        * Shadow -&gt;    001</span>
<span class="sd">        * Undefined -&gt; 010</span>
<span class="sd">        * Cloud  -&gt;    011</span>
<span class="sd">        * Ice    -&gt;    100</span>
<span class="sd">        * `2**3` sea/land</span>
<span class="sd">        * `2**4` quality swir (0 bad 1 good)</span>
<span class="sd">        * `2**5` quality nir</span>
<span class="sd">        * `2**6` quality red</span>
<span class="sd">        * `2**7` quality blue</span>
<span class="sd">        * `2**8` coverage swir (0 no 1 yes)</span>
<span class="sd">        * `2**9` coverage nir</span>
<span class="sd">        * `2**10` coverage red</span>
<span class="sd">        * `2**11` coverage blue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bands</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/QUALITY/SM&quot;</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the valid mask (False if the pixel is out of swath or is invalid). This function loads the SM band</span>

<span class="sd">        Args:</span>
<span class="sd">            boundless (bool, optional): boundless option to load the SM band. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            geotensor.GeoTensor: mask with the same shape as the image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
        <span class="n">valids</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask_only_sm</span><span class="p">(</span><span class="n">valids</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">valids</span><span class="o">.</span><span class="n">fill_value_default</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">valids</span>

    <span class="k">def</span> <span class="nf">load_sm_cloud_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mask_undefined</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
        <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">sm_cloud_mask</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mask_undefined</span><span class="o">=</span><span class="n">mask_undefined</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">(</span>
            <span class="n">cloud_mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_recompressed_and_chunked</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">original_bands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/RADIOMETRY/</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">BAND_NAMES</span>
        <span class="p">]</span>
        <span class="n">original_bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/QUALITY/SM&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">original_bands</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">input_</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">compression</span> <span class="o">==</span> <span class="s2">&quot;szip&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">input_</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">chunks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">input_</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">assert_can_be_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_bands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/RADIOMETRY/</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">BAND_NAMES</span>
        <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/QUALITY/SM&quot;</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">original_bands</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">is_compression_available</span><span class="p">(</span>
                    <span class="n">input_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Band </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> cannot be read. Compression: </span><span class="si">{</span><span class="n">input_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">compression</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">recompress_bands</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chunks</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
        <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">compression_dest</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">original_bands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/RADIOMETRY/</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">BAND_NAMES</span>
        <span class="p">}</span>
        <span class="n">original_bands</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;SM&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/QUALITY/SM&quot;</span><span class="p">})</span>
        <span class="n">copy_bands</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;_NEW&quot;</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">original_bands</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">original_bands</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">assert_compression_available</span><span class="p">(</span><span class="n">input_</span><span class="p">[</span><span class="n">original_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]])</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">input_</span><span class="p">[</span><span class="n">original_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]][:]</span>
                <span class="k">if</span> <span class="n">copy_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="ow">in</span> <span class="n">input_</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">input_</span><span class="p">[</span><span class="n">copy_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span>

                <span class="n">ds</span> <span class="o">=</span> <span class="n">input_</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
                    <span class="n">copy_bands</span><span class="p">[</span><span class="n">b</span><span class="p">],</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                    <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
                    <span class="n">compression</span><span class="o">=</span><span class="n">compression_dest</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">attrs_copy</span> <span class="o">=</span> <span class="n">input_</span><span class="p">[</span><span class="n">original_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span><span class="o">.</span><span class="n">attrs</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs_copy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

                <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">input_</span><span class="p">[</span><span class="n">original_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span>
                    <span class="n">input_</span><span class="p">[</span><span class="n">original_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span> <span class="o">=</span> <span class="n">input_</span><span class="p">[</span><span class="n">copy_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span>
                    <span class="k">del</span> <span class="n">input_</span><span class="p">[</span><span class="n">copy_bands</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Affine</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">res</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">window_bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_window</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">window</span><span class="p">:</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span>
        <span class="n">relative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span>
                <span class="n">col_off</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">col_off</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">col_off</span><span class="p">,</span>
                <span class="n">row_off</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">row_off</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">row_off</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">window</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">boundless</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ProbaV</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="n">level_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_from_window</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">copy</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; </span>
<span class="s2">         File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="si">}</span>
<span class="s2">         Transform: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="si">}</span>
<span class="s2">         Shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="si">}</span>
<span class="s2">         Resolution: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="si">}</span>
<span class="s2">         Bounds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="si">}</span>
<span class="s2">         CRS: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="si">}</span>
<span class="s2">         Level: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span>
<span class="s2">         TOA/TOC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span>
<span class="s2">         Resolution name : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">res_name</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="georeader.readers.probav_image_operational.ProbaV.load_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_mask</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.probav_image_operational.ProbaV.load_mask" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the valid mask (False if the pixel is out of swath or is invalid). This function loads the SM band</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>boundless</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>boundless option to load the SM band. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>geotensor.GeoTensor: mask with the same shape as the image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/probav_image_operational.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the valid mask (False if the pixel is out of swath or is invalid). This function loads the SM band</span>

<span class="sd">    Args:</span>
<span class="sd">        boundless (bool, optional): boundless option to load the SM band. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        geotensor.GeoTensor: mask with the same shape as the image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
    <span class="n">valids</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask_only_sm</span><span class="p">(</span><span class="n">valids</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">valids</span><span class="o">.</span><span class="n">fill_value_default</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">valids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.probav_image_operational.ProbaV.load_sm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.probav_image_operational.ProbaV.load_sm" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reference of values in <code>SM</code> flags.</p>
<p>From <a href="http://www.vito-eodata.be/PDF/image/PROBAV-Products_User_Manual.pdf">user manual</a> pag 67
* Clear  -&gt;    000
* Shadow -&gt;    001
* Undefined -&gt; 010
* Cloud  -&gt;    011
* Ice    -&gt;    100
* <code>2**3</code> sea/land
* <code>2**4</code> quality swir (0 bad 1 good)
* <code>2**5</code> quality nir
* <code>2**6</code> quality red
* <code>2**7</code> quality blue
* <code>2**8</code> coverage swir (0 no 1 yes)
* <code>2**9</code> coverage nir
* <code>2**10</code> coverage red
* <code>2**11</code> coverage blue</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/probav_image_operational.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reference of values in `SM` flags.</span>

<span class="sd">    From [user manual](http://www.vito-eodata.be/PDF/image/PROBAV-Products_User_Manual.pdf) pag 67</span>
<span class="sd">    * Clear  -&gt;    000</span>
<span class="sd">    * Shadow -&gt;    001</span>
<span class="sd">    * Undefined -&gt; 010</span>
<span class="sd">    * Cloud  -&gt;    011</span>
<span class="sd">    * Ice    -&gt;    100</span>
<span class="sd">    * `2**3` sea/land</span>
<span class="sd">    * `2**4` quality swir (0 bad 1 good)</span>
<span class="sd">    * `2**5` quality nir</span>
<span class="sd">    * `2**6` quality red</span>
<span class="sd">    * `2**7` quality blue</span>
<span class="sd">    * `2**8` coverage swir (0 no 1 yes)</span>
<span class="sd">    * `2**9` coverage nir</span>
<span class="sd">    * `2**10` coverage red</span>
<span class="sd">    * `2**11` coverage blue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bands</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/QUALITY/SM&quot;</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.probav_image_operational.ProbaV.save_bands" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_bands</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></code>

<a href="#georeader.readers.probav_image_operational.ProbaV.save_bands" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>img</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(4, self.real_height, self.real_width, 4) tensor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/probav_image_operational.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        img: (4, self.real_height, self.real_width, 4) tensor</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
    <span class="p">),</span> <span class="s2">&quot;Unexpected number of channels expected 4 found </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Unexpected shape expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="si">}</span><span class="s2"> found </span><span class="si">{</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># TODO save only window_focus?</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">BAND_NAMES</span><span class="p">):</span>
            <span class="n">band_to_save</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">mask_band_2_save</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmaskarray</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">band_to_save</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">band_to_save</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">band_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span><span class="s2">/RADIOMETRY/</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">input_f</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
            <span class="n">band_to_save</span> <span class="o">*=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;SCALE&quot;</span><span class="p">]</span>
            <span class="n">band_to_save</span> <span class="o">+=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;OFFSET&quot;</span><span class="p">]</span>
            <span class="n">band_to_save</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">band_to_save</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
            <span class="n">band_to_save</span><span class="p">[</span><span class="n">mask_band_2_save</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">input_f</span><span class="p">[</span><span class="n">band_name</span><span class="p">][</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">band_to_save</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="georeader.readers.probav_image_operational.ProbaVRadiometry" class="doc doc-heading">
            <code>ProbaVRadiometry</code>


<a href="#georeader.readers.probav_image_operational.ProbaVRadiometry" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="georeader.readers.probav_image_operational.ProbaV" href="#georeader.readers.probav_image_operational.ProbaV">ProbaV</a></code></p>


        <p>A specialized ProbaV reader class focused on radiometry data.</p>
<p>This class extends the base ProbaV class to provide a simplified interface
for working with radiometry bands from Proba-V products.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hdf5_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF5 file containing the Proba-V product.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional window to focus on a specific
region of the image. Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>level_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing level of the product. Defaults to "LEVEL2A".</p>
              </div>
            </td>
            <td>
                  <code>&#39;LEVEL2A&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indexes</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of band indices to load. If None,
all four bands (0=BLUE, 1=RED, 2=NIR, 3=SWIR) will be loaded. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVRadiometry.dims">dims</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the dimensions ("band", "y", "x").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVRadiometry.indexes">indexes</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of band indices to load.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVRadiometry.dtype">dtype</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the radiometry data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVRadiometry.count">count</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bands to be loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVRadiometry.shape">shape</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of the data (bands, height, width).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVRadiometry.values">values</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radiometry data values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize the ProbaVRadiometry reader with a data path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">probav_rad</span> <span class="o">=</span> <span class="n">ProbaVRadiometry</span><span class="p">(</span><span class="s1">&#39;/path/to/probav_product.HDF5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load only RED and NIR bands</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">probav_rad_rn</span> <span class="o">=</span> <span class="n">ProbaVRadiometry</span><span class="p">(</span><span class="s1">&#39;/path/to/probav_product.HDF5&#39;</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get the data as a GeoTensor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geotensor_data</span> <span class="o">=</span> <span class="n">probav_rad</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/probav_image_operational.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProbaVRadiometry</span><span class="p">(</span><span class="n">ProbaV</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A specialized ProbaV reader class focused on radiometry data.</span>

<span class="sd">    This class extends the base ProbaV class to provide a simplified interface</span>
<span class="sd">    for working with radiometry bands from Proba-V products.</span>

<span class="sd">    Args:</span>
<span class="sd">        hdf5_file (str): Path to the HDF5 file containing the Proba-V product.</span>
<span class="sd">        window (Optional[rasterio.windows.Window]): Optional window to focus on a specific</span>
<span class="sd">            region of the image. Defaults to None (entire image).</span>
<span class="sd">        level_name (str): Processing level of the product. Defaults to &quot;LEVEL2A&quot;.</span>
<span class="sd">        indexes (Optional[List[int]]): Optional list of band indices to load. If None,</span>
<span class="sd">            all four bands (0=BLUE, 1=RED, 2=NIR, 3=SWIR) will be loaded. Defaults to None.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dims (Tuple[str]): Names of the dimensions (&quot;band&quot;, &quot;y&quot;, &quot;x&quot;).</span>
<span class="sd">        indexes (List[int]): List of band indices to load.</span>
<span class="sd">        dtype: Data type of the radiometry data.</span>
<span class="sd">        count (int): Number of bands to be loaded.</span>
<span class="sd">        shape (Tuple[int, int, int]): Shape of the data (bands, height, width).</span>
<span class="sd">        values (np.ndarray): The radiometry data values.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Initialize the ProbaVRadiometry reader with a data path</span>
<span class="sd">        &gt;&gt;&gt; probav_rad = ProbaVRadiometry(&#39;/path/to/probav_product.HDF5&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # Load only RED and NIR bands</span>
<span class="sd">        &gt;&gt;&gt; probav_rad_rn = ProbaVRadiometry(&#39;/path/to/probav_product.HDF5&#39;, indexes=[1, 2])</span>
<span class="sd">        &gt;&gt;&gt; # Get the data as a GeoTensor</span>
<span class="sd">        &gt;&gt;&gt; geotensor_data = probav_rad.load()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hdf5_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LEVEL2A&quot;</span><span class="p">,</span>
        <span class="n">indexes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">hdf5_file</span><span class="o">=</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">level_name</span><span class="o">=</span><span class="n">level_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>

        <span class="c1"># let read only some bands?</span>
        <span class="k">if</span> <span class="n">indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="n">indexes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_radiometry</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_radiometry</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_radiometry</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ProbaVRadiometry</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span>
            <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="n">level_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="p">,</span>
            <span class="n">indexes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="georeader.readers.probav_image_operational.ProbaVSM" class="doc doc-heading">
            <code>ProbaVSM</code>


<a href="#georeader.readers.probav_image_operational.ProbaVSM" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="georeader.readers.probav_image_operational.ProbaV" href="#georeader.readers.probav_image_operational.ProbaV">ProbaV</a></code></p>


        <p>A specialized ProbaV reader class focused on Status Map (SM) data.</p>
<p>This class extends the base ProbaV class to provide a simplified interface
for working with the status map band from Proba-V products. The SM band
contains information about the pixel quality, cloud status, etc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hdf5_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF5 file containing the Proba-V product.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional window to focus on a specific
region of the image. Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>level_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing level of the product. Defaults to "LEVEL2A".</p>
              </div>
            </td>
            <td>
                  <code>&#39;LEVEL2A&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVSM.dims">dims</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the dimensions ("y", "x").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVSM.dtype">dtype</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the SM data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVSM.shape">shape</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of the SM data (height, width).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.probav_image_operational.ProbaVSM.values">values</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The SM data values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize the ProbaVSM reader with a data path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">probav_sm</span> <span class="o">=</span> <span class="n">ProbaVSM</span><span class="p">(</span><span class="s1">&#39;/path/to/probav_product.HDF5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get the SM data as a GeoTensor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sm_data</span> <span class="o">=</span> <span class="n">probav_sm</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Extract cloud information</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">sm_cloud_mask</span><span class="p">(</span><span class="n">sm_data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/probav_image_operational.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProbaVSM</span><span class="p">(</span><span class="n">ProbaV</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A specialized ProbaV reader class focused on Status Map (SM) data.</span>

<span class="sd">    This class extends the base ProbaV class to provide a simplified interface</span>
<span class="sd">    for working with the status map band from Proba-V products. The SM band</span>
<span class="sd">    contains information about the pixel quality, cloud status, etc.</span>

<span class="sd">    Args:</span>
<span class="sd">        hdf5_file (str): Path to the HDF5 file containing the Proba-V product.</span>
<span class="sd">        window (Optional[rasterio.windows.Window]): Optional window to focus on a specific</span>
<span class="sd">            region of the image. Defaults to None (entire image).</span>
<span class="sd">        level_name (str): Processing level of the product. Defaults to &quot;LEVEL2A&quot;.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dims (Tuple[str]): Names of the dimensions (&quot;y&quot;, &quot;x&quot;).</span>
<span class="sd">        dtype: Data type of the SM data.</span>
<span class="sd">        shape (Tuple[int, int]): Shape of the SM data (height, width).</span>
<span class="sd">        values (np.ndarray): The SM data values.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Initialize the ProbaVSM reader with a data path</span>
<span class="sd">        &gt;&gt;&gt; probav_sm = ProbaVSM(&#39;/path/to/probav_product.HDF5&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # Get the SM data as a GeoTensor</span>
<span class="sd">        &gt;&gt;&gt; sm_data = probav_sm.load()</span>
<span class="sd">        &gt;&gt;&gt; # Extract cloud information</span>
<span class="sd">        &gt;&gt;&gt; cloud_mask = sm_cloud_mask(sm_data.values)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hdf5_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LEVEL2A&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">hdf5_file</span><span class="o">=</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">level_name</span><span class="o">=</span><span class="n">level_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_sm</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;__class__&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ProbaVSM</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdf5_file</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="n">level_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="spot-vgt-reader">SPOT-VGT Reader<a class="headerlink" href="#spot-vgt-reader" title="Permanent link">&para;</a></h2>
<p>The SPOT-VGT reader provides functionality for reading SPOT-VGT products. Features include:</p>
<ul>
<li>HDF4 file format support</li>
<li>Handling of radiometry and quality layers</li>
<li>Cloud and shadow mask extraction</li>
</ul>
<p><strong>Note:</strong> See the Proba-V tutorial for similar processing workflows as both sensors share similar data structures.</p>
<h3 id="api-reference_2">API Reference<a class="headerlink" href="#api-reference_2" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="georeader.readers.spotvgt_image_operational"></a>
    <div class="doc doc-contents first">

        <p>SPOT VGT reader</p>
<p>Unofficial reader for SPOT VGT products. The reader is based on the user manual:
https://docs.terrascope.be/DataProducts/SPOT-VGT/references/SPOT_VGT_PUM_v1.3.pdf</p>
<p>Authors: Dan Lopez-Puigdollers, Gonzalo Mateo-García</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="georeader.readers.spotvgt_image_operational.SpotVGT" class="doc doc-heading">
            <code>SpotVGT</code>


<a href="#georeader.readers.spotvgt_image_operational.SpotVGT" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>SPOT-VGT reader for handling SPOT Vegetation satellite products.</p>
<p>This class provides functionality to read and manipulate SPOT-VGT satellite imagery products.
It handles the specific format and metadata of SPOT-VGT HDF4 files, supporting operations
like loading radiometry data, masks, and cloud information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hdf4_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF4 file or directory containing the SPOT-VGT product.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional window to focus on a specific 
region of the image. Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.hdf4_file">hdf4_file</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF4 file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.name">name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Basename of the HDF4 file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.satelliteID">satelliteID</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Satellite ID extracted from the filename.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.station">station</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Station code extracted from the filename.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.productID">productID</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Product ID extracted from the filename.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.year,">year,</span></code></td>
            <td>
                  <code>month, day (str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date components extracted from the filename.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.segment">segment</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Segment identifier extracted from the filename.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.version">version</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Product version extracted from the filename.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.files">files</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of files in the SPOT-VGT product.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.files_dict">files_dict</span></code></td>
            <td>
                  <code>Dict[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping band names to file paths.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.metadata">metadata</span></code></td>
            <td>
                  <code>Dict[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metadata extracted from the LOG file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.real_shape">real_shape</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of the full image (height, width).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.real_transform">real_transform</span></code></td>
            <td>
                  <code><span title="rasterio.Affine">Affine</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Affine transform for the full image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.dtype_radiometry">dtype_radiometry</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type for radiometry data (typically np.float32).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.window_focus">window_focus</span></code></td>
            <td>
                  <code><span title="rasterio.windows.Window">Window</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current window focus.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.window_data">window_data</span></code></td>
            <td>
                  <code><span title="rasterio.windows.Window">Window</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Window representing the full data extent.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.start_date">start_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start acquisition date and time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.end_date">end_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End acquisition date and time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.crs">crs</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinate reference system.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.toatoc">toatoc</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicator of whether data is TOA (top of atmosphere).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.res_name">res_name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolution name identifier (e.g., '1KM').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.spotvgt_image_operational.SpotVGT.level_name">level_name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing level identifier.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">rasterio.windows</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize the SpotVGT reader with a data path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spot_reader</span> <span class="o">=</span> <span class="n">SpotVGT</span><span class="p">(</span><span class="s1">&#39;/path/to/V2KRNP____20140321F146_V003&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load radiometry data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bands</span> <span class="o">=</span> <span class="n">spot_reader</span><span class="o">.</span><span class="n">load_radiometry</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get cloud mask</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">spot_reader</span><span class="o">.</span><span class="n">load_sm_cloud_mask</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Focus on a specific window</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">window</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">col_off</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">row_off</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spot_reader</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/spotvgt_image_operational.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SpotVGT</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SPOT-VGT reader for handling SPOT Vegetation satellite products.</span>

<span class="sd">    This class provides functionality to read and manipulate SPOT-VGT satellite imagery products.</span>
<span class="sd">    It handles the specific format and metadata of SPOT-VGT HDF4 files, supporting operations</span>
<span class="sd">    like loading radiometry data, masks, and cloud information.</span>

<span class="sd">    Args:</span>
<span class="sd">        hdf4_file (str): Path to the HDF4 file or directory containing the SPOT-VGT product.</span>
<span class="sd">        window (Optional[rasterio.windows.Window]): Optional window to focus on a specific </span>
<span class="sd">            region of the image. Defaults to None (entire image).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        hdf4_file (str): Path to the HDF4 file.</span>
<span class="sd">        name (str): Basename of the HDF4 file.</span>
<span class="sd">        satelliteID (str): Satellite ID extracted from the filename.</span>
<span class="sd">        station (str): Station code extracted from the filename.</span>
<span class="sd">        productID (str): Product ID extracted from the filename.</span>
<span class="sd">        year, month, day (str): Date components extracted from the filename.</span>
<span class="sd">        segment (str): Segment identifier extracted from the filename.</span>
<span class="sd">        version (str): Product version extracted from the filename.</span>
<span class="sd">        files (List[str]): List of files in the SPOT-VGT product.</span>
<span class="sd">        files_dict (Dict[str, str]): Dictionary mapping band names to file paths.</span>
<span class="sd">        metadata (Dict[str, str]): Metadata extracted from the LOG file.</span>
<span class="sd">        real_shape (Tuple[int, int]): Shape of the full image (height, width).</span>
<span class="sd">        real_transform (rasterio.Affine): Affine transform for the full image.</span>
<span class="sd">        dtype_radiometry: Data type for radiometry data (typically np.float32).</span>
<span class="sd">        window_focus (rasterio.windows.Window): Current window focus.</span>
<span class="sd">        window_data (rasterio.windows.Window): Window representing the full data extent.</span>
<span class="sd">        start_date (dt.datetime): Start acquisition date and time.</span>
<span class="sd">        end_date (dt.datetime): End acquisition date and time.</span>
<span class="sd">        crs: Coordinate reference system.</span>
<span class="sd">        toatoc (str): Indicator of whether data is TOA (top of atmosphere).</span>
<span class="sd">        res_name (str): Resolution name identifier (e.g., &#39;1KM&#39;).</span>
<span class="sd">        level_name (str): Processing level identifier.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import rasterio.windows</span>
<span class="sd">        &gt;&gt;&gt; # Initialize the SpotVGT reader with a data path</span>
<span class="sd">        &gt;&gt;&gt; spot_reader = SpotVGT(&#39;/path/to/V2KRNP____20140321F146_V003&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # Load radiometry data</span>
<span class="sd">        &gt;&gt;&gt; bands = spot_reader.load_radiometry()</span>
<span class="sd">        &gt;&gt;&gt; # Get cloud mask</span>
<span class="sd">        &gt;&gt;&gt; cloud_mask = spot_reader.load_sm_cloud_mask()</span>
<span class="sd">        &gt;&gt;&gt; # Focus on a specific window</span>
<span class="sd">        &gt;&gt;&gt; window = rasterio.windows.Window(col_off=100, row_off=100, width=200, height=200)</span>
<span class="sd">        &gt;&gt;&gt; spot_reader.set_window(window)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf4_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdf4_file</span> <span class="o">=</span> <span class="n">hdf4_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf4_file</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;V(\d</span><span class="si">{1}</span><span class="s1">)(\w</span><span class="si">{3}</span><span class="s1">)(\w</span><span class="si">{1}</span><span class="s1">)____(\d</span><span class="si">{4}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)F(\w</span><span class="si">{3}</span><span class="s1">)_V(\d</span><span class="si">{3}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">satelliteID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">productID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;SPOT-VGT product not recognized </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdf4_file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf4_file</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;V\d</span><span class="si">{12}</span><span class="s1">_(\w+)&#39;</span><span class="p">,</span>
                                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">))}</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files_dict</span><span class="p">[</span><span class="s1">&#39;LOG&#39;</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;IMAGE_LOWER_RIGHT_ROW&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;IMAGE_UPPER_LEFT_ROW&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;IMAGE_LOWER_RIGHT_COL&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;IMAGE_UPPER_LEFT_COL&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;CARTO_LOWER_LEFT_X&#39;</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;CARTO_LOWER_LEFT_Y&#39;</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;CARTO_UPPER_RIGHT_X&#39;</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;CARTO_UPPER_RIGHT_Y&#39;</span><span class="p">])</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span><span class="o">*</span><span class="n">bbox</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                 <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dtype_radiometry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>

        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Error reading product </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdf4_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">row_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">col_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                        <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">row_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">col_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                        <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window_data</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">row_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">col_off</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                   <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d</span><span class="si">{4}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;SEGM_FIRST_DATE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;SEGM_FIRST_TIME&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">),</span> <span class="n">month</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="n">year</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
                                      <span class="n">hour</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hh</span><span class="p">),</span> <span class="n">minute</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mm</span><span class="p">),</span> <span class="n">second</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ss</span><span class="p">),</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d</span><span class="si">{4}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;SEGM_LAST_DATE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;SEGM_LAST_TIME&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">),</span> <span class="n">month</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="n">year</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
                                    <span class="n">hour</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hh</span><span class="p">),</span> <span class="n">minute</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mm</span><span class="p">),</span> <span class="n">second</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ss</span><span class="p">),</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="c1"># self.map_projection_wkt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span> <span class="o">=</span> <span class="s2">&quot;TOA&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res_name</span> <span class="o">=</span> <span class="s1">&#39;1KM&#39;</span>

        <span class="c1"># SPOT-VGT images are lat/long</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="p">({</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:4326&#39;</span><span class="p">})</span>

        <span class="c1"># SPOT-VGT images have four bands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_name</span> <span class="o">=</span> <span class="s2">&quot;LEVEL2A&quot;</span>

    <span class="k">def</span> <span class="nf">_get_window_pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]]:</span>
        <span class="n">window_read</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">boundless</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">pad_width</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">get_slice_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">)</span>
            <span class="n">need_pad</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pad_width</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pad_width</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">need_pad</span><span class="p">:</span>
                <span class="n">pad_list_np</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pad_width</span><span class="p">:</span>
                        <span class="n">pad_list_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pad_width</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pad_list_np</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pad_list_np</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pad_list_np</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">window_read</span><span class="p">,</span> <span class="n">pad_list_np</span>

    <span class="k">def</span> <span class="nf">footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Polygon</span><span class="p">:</span>
        <span class="c1"># TODO load footprint from metadata?</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">window_polygon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">compare_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span>

        <span class="k">return</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">valid_footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Polygon</span><span class="p">:</span>
        <span class="n">valids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_mask</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">valids</span><span class="o">.</span><span class="n">valid_footprint</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>        

    <span class="k">def</span> <span class="nf">_load_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bands_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">fill_value_default</span><span class="p">:</span> <span class="n">Number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">window_read</span><span class="p">,</span> <span class="n">pad_list_np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_window_pad</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
        <span class="n">slice_</span> <span class="o">=</span> <span class="n">window_read</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bands_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">bands_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">bands_names</span><span class="p">]</span>
            <span class="n">flatten</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flatten</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">hdf_objs</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="p">:</span> <span class="n">SD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files_dict</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">SDC</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_names</span><span class="p">}</span>
        <span class="c1"># Read dataset</span>
        <span class="c1"># shapes = [hdf_objs[b].datasets()[&quot;PIXEL_DATA&quot;][1] for b in bands_names]</span>
        <span class="c1"># data = [hdf_objs[b].select(&quot;PIXEL_DATA&quot;)[slice_] for b in bands_names]</span>

        <span class="n">bands_arrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Original slice int32 gives an error. Cast to int</span>
        <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands_names</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">read_band_toa</span><span class="p">(</span><span class="n">hdf_objs</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">slice_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">slice_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">),</span> <span class="kc">None</span><span class="p">),</span>
                                                  <span class="nb">slice</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">slice_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">slice_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">),</span> <span class="kc">None</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">pad_list_np</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pad_list_np</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">fill_value_default</span><span class="p">)</span>

            <span class="n">bands_arrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">boundless</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">window_read</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flatten</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">bands_arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">bands_arrs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                                   <span class="n">fill_value_default</span><span class="o">=</span><span class="n">fill_value_default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_radiometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># bands_names = [f&quot;{self.level_name}/RADIOMETRY/{BAND_NAMES[i]}/{self.toatoc}&quot; for i in indexes]</span>
        <span class="n">bands_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">BANDS_DICT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bands</span><span class="p">(</span><span class="n">bands_names</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reference of values in `SM` flags.</span>

<span class="sd">        From [user manual](https://docs.terrascope.be/DataProducts/SPOT-VGT/references/SPOT_VGT_PUM_v1.3.pdf) pag 46</span>
<span class="sd">        * Clear  -&gt;    000</span>
<span class="sd">        * Shadow -&gt;    001</span>
<span class="sd">        * Undefined -&gt; 010</span>
<span class="sd">        * Cloud  -&gt;    011</span>
<span class="sd">        * Ice    -&gt;    100</span>
<span class="sd">        * `2**3` sea/land</span>
<span class="sd">        * `2**4` quality swir (0 bad 1 good)</span>
<span class="sd">        * `2**5` quality nir</span>
<span class="sd">        * `2**6` quality red</span>
<span class="sd">        * `2**7` quality blue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bands</span><span class="p">(</span><span class="s1">&#39;SM&#39;</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the valid mask (False if the pixel is out of swath or is invalid). This function loads the SM band</span>

<span class="sd">        Args:</span>
<span class="sd">            boundless (bool, optional): boundless option to load the SM band. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            geotensor.GeoTensor: mask with the same shape as the image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
        <span class="n">valids</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">invalids</span> <span class="o">=</span> <span class="n">mask_only_sm</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">valids</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="o">~</span><span class="n">invalids</span>
        <span class="n">valids</span><span class="o">.</span><span class="n">fill_value_default</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">valids</span>

    <span class="k">def</span> <span class="nf">load_sm_cloud_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask_undefined</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
        <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">sm_cloud_mask</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mask_undefined</span><span class="o">=</span><span class="n">mask_undefined</span><span class="p">)</span>
        <span class="n">cloud_mask</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">invalids</span> <span class="o">=</span> <span class="n">mask_only_sm</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="n">cloud_mask</span><span class="p">[</span><span class="n">invalids</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">(</span><span class="n">cloud_mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Affine</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">res</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">window_bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">relative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">col_off</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">col_off</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">col_off</span><span class="p">,</span>
                                                        <span class="n">row_off</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">row_off</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">row_off</span><span class="p">,</span>
                                                        <span class="n">height</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">window</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">boundless</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;__class__&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SpotVGT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf4_file</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_from_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;__class__&#39;</span><span class="p">:</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">set_window</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">copy</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; </span>
<span class="s2">         File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf4_file</span><span class="si">}</span>
<span class="s2">         Transform: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="si">}</span>
<span class="s2">         Shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="si">}</span>
<span class="s2">         Resolution: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="si">}</span>
<span class="s2">         Bounds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="si">}</span>
<span class="s2">         CRS: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="si">}</span>
<span class="s2">         Level: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level_name</span><span class="si">}</span>
<span class="s2">         TOA/TOC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toatoc</span><span class="si">}</span>
<span class="s2">         Resolution name : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">res_name</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="georeader.readers.spotvgt_image_operational.SpotVGT.load_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_mask</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.spotvgt_image_operational.SpotVGT.load_mask" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the valid mask (False if the pixel is out of swath or is invalid). This function loads the SM band</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>boundless</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>boundless option to load the SM band. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>geotensor.GeoTensor: mask with the same shape as the image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/spotvgt_image_operational.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the valid mask (False if the pixel is out of swath or is invalid). This function loads the SM band</span>

<span class="sd">    Args:</span>
<span class="sd">        boundless (bool, optional): boundless option to load the SM band. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        geotensor.GeoTensor: mask with the same shape as the image</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
    <span class="n">valids</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">invalids</span> <span class="o">=</span> <span class="n">mask_only_sm</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">valids</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="o">~</span><span class="n">invalids</span>
    <span class="n">valids</span><span class="o">.</span><span class="n">fill_value_default</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">valids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.spotvgt_image_operational.SpotVGT.load_sm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_sm</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.spotvgt_image_operational.SpotVGT.load_sm" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reference of values in <code>SM</code> flags.</p>
<p>From <a href="https://docs.terrascope.be/DataProducts/SPOT-VGT/references/SPOT_VGT_PUM_v1.3.pdf">user manual</a> pag 46
* Clear  -&gt;    000
* Shadow -&gt;    001
* Undefined -&gt; 010
* Cloud  -&gt;    011
* Ice    -&gt;    100
* <code>2**3</code> sea/land
* <code>2**4</code> quality swir (0 bad 1 good)
* <code>2**5</code> quality nir
* <code>2**6</code> quality red
* <code>2**7</code> quality blue</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/spotvgt_image_operational.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_sm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geotensor</span><span class="o">.</span><span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reference of values in `SM` flags.</span>

<span class="sd">    From [user manual](https://docs.terrascope.be/DataProducts/SPOT-VGT/references/SPOT_VGT_PUM_v1.3.pdf) pag 46</span>
<span class="sd">    * Clear  -&gt;    000</span>
<span class="sd">    * Shadow -&gt;    001</span>
<span class="sd">    * Undefined -&gt; 010</span>
<span class="sd">    * Cloud  -&gt;    011</span>
<span class="sd">    * Ice    -&gt;    100</span>
<span class="sd">    * `2**3` sea/land</span>
<span class="sd">    * `2**4` quality swir (0 bad 1 good)</span>
<span class="sd">    * `2**5` quality nir</span>
<span class="sd">    * `2**6` quality red</span>
<span class="sd">    * `2**7` quality blue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bands</span><span class="p">(</span><span class="s1">&#39;SM&#39;</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="prisma-reader">PRISMA Reader<a class="headerlink" href="#prisma-reader" title="Permanent link">&para;</a></h2>
<p>The PRISMA reader handles data from the Italian Space Agency's hyperspectral mission, specifically working with Level 1B radiance data (not atmospherically corrected). PRISMA provides hyperspectral imaging in the 400-2500 nm spectral range, with a spectral resolution of ~12 nm.</p>
<p>Key features:</p>
<ul>
<li>Reading L1B hyperspectral radiance data from HDF5 format files</li>
<li>Handling separate VNIR (400-1000 nm) and SWIR (1000-2500 nm) spectral ranges</li>
<li>Georeferencing functionality for non-orthorectified data using provided latitude/longitude coordinates</li>
<li>On-demand conversion from radiance (mW/m²/sr/nm) to top-of-atmosphere reflectance</li>
<li>Spectral response function integration for accurate band simulation</li>
<li>Extraction of RGB previews from specific wavelengths</li>
<li>Access to satellite and solar geometry information for radiometric calculations</li>
</ul>
<p><strong>Tutorial examples:</strong></p>
<ul>
<li><a href="../../simultaneous_prisma_emit/">Reading overlapping PRISMA and EMIT images</a></li>
<li><a href="../../prisma_with_cloudsen12/">Cloud detection in PRISMA images</a></li>
</ul>
<h3 id="api-reference_3">API Reference<a class="headerlink" href="#api-reference_3" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="georeader.readers.prisma"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="georeader.readers.prisma.PRISMA" class="doc doc-heading">
            <code>PRISMA</code>


<a href="#georeader.readers.prisma.PRISMA" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>PRISMA (PRecursore IperSpettrale della Missione Applicativa) image reader.</p>
<p>This class provides functionality to read and manipulate PRISMA satellite imagery products.
It handles the specific format and metadata of PRISMA HDF5 files, supporting operations
like loading specific wavelengths, RGB composites, and converting to reflectance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the PRISMA HDF5 file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.filename">filename</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the PRISMA file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.swir_cube_dat">swir_cube_dat</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to SWIR cube data in HDF5 file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.vni_cube_dat">vni_cube_dat</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to VNIR cube data in HDF5 file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.lats">lats</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for each pixel.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.lons">lons</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for each pixel.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.attributes_prisma">attributes_prisma</span></code></td>
            <td>
                  <code>Dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of PRISMA metadata attributes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.nbands_vnir">nbands_vnir</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of VNIR bands.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.vnir_range">vnir_range</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wavelength range of VNIR bands (min, max).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.nbands_swir">nbands_swir</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of SWIR bands.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.swir_range">swir_range</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wavelength range of SWIR bands (min, max).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.ltoa_swir">ltoa_swir</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SWIR radiance data, lazily loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.ltoa_vnir">ltoa_vnir</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>VNIR radiance data, lazily loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.wavelength_swir">wavelength_swir</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SWIR wavelengths, lazily loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.fwhm_swir">fwhm_swir</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SWIR FWHM (Full Width at Half Maximum), lazily loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.wavelength_vnir">wavelength_vnir</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>VNIR wavelengths, lazily loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.fwhm_vnir">fwhm_vnir</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>VNIR FWHM, lazily loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.vza_swir">vza_swir</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Viewing zenith angle for SWIR.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.vza_vnir">vza_vnir</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Viewing zenith angle for VNIR.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.sza_swir">sza_swir</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Solar zenith angle for SWIR.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.sza_vnir">sza_vnir</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Solar zenith angle for VNIR.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.time_coverage_start">time_coverage_start</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time of acquisition.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.time_coverage_end">time_coverage_end</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time of acquisition.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.prisma.PRISMA.units">units</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Units of radiance data (mW/m2/sr/nm).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize the PRISMA reader with a data path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prisma</span> <span class="o">=</span> <span class="n">PRISMA</span><span class="p">(</span><span class="s1">&#39;/path/to/prisma_file.he5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load RGB bands</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rgb</span> <span class="o">=</span> <span class="n">prisma</span><span class="o">.</span><span class="n">load_rgb</span><span class="p">(</span><span class="n">as_reflectance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load specific wavelengths</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bands</span> <span class="o">=</span> <span class="n">prisma</span><span class="o">.</span><span class="n">load_wavelengths</span><span class="p">([</span><span class="mi">850</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">2200</span><span class="p">],</span> <span class="n">as_reflectance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get image metadata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">prisma</span><span class="p">)</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/prisma.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PRISMA</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PRISMA (PRecursore IperSpettrale della Missione Applicativa) image reader.</span>

<span class="sd">    This class provides functionality to read and manipulate PRISMA satellite imagery products.</span>
<span class="sd">    It handles the specific format and metadata of PRISMA HDF5 files, supporting operations</span>
<span class="sd">    like loading specific wavelengths, RGB composites, and converting to reflectance.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): Path to the PRISMA HDF5 file.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        filename (str): Path to the PRISMA file.</span>
<span class="sd">        swir_cube_dat (str): Path to SWIR cube data in HDF5 file.</span>
<span class="sd">        vni_cube_dat (str): Path to VNIR cube data in HDF5 file.</span>
<span class="sd">        lats (numpy.ndarray): Latitude values for each pixel.</span>
<span class="sd">        lons (numpy.ndarray): Longitude values for each pixel.</span>
<span class="sd">        attributes_prisma (Dict): Dictionary of PRISMA metadata attributes.</span>
<span class="sd">        nbands_vnir (int): Number of VNIR bands.</span>
<span class="sd">        vnir_range (Tuple[float, float]): Wavelength range of VNIR bands (min, max).</span>
<span class="sd">        nbands_swir (int): Number of SWIR bands.</span>
<span class="sd">        swir_range (Tuple[float, float]): Wavelength range of SWIR bands (min, max).</span>
<span class="sd">        ltoa_swir (Optional[NDArray]): SWIR radiance data, lazily loaded.</span>
<span class="sd">        ltoa_vnir (Optional[NDArray]): VNIR radiance data, lazily loaded.</span>
<span class="sd">        wavelength_swir (Optional[NDArray]): SWIR wavelengths, lazily loaded.</span>
<span class="sd">        fwhm_swir (Optional[NDArray]): SWIR FWHM (Full Width at Half Maximum), lazily loaded.</span>
<span class="sd">        wavelength_vnir (Optional[NDArray]): VNIR wavelengths, lazily loaded.</span>
<span class="sd">        fwhm_vnir (Optional[NDArray]): VNIR FWHM, lazily loaded.</span>
<span class="sd">        vza_swir (float): Viewing zenith angle for SWIR.</span>
<span class="sd">        vza_vnir (float): Viewing zenith angle for VNIR.</span>
<span class="sd">        sza_swir (float): Solar zenith angle for SWIR.</span>
<span class="sd">        sza_vnir (float): Solar zenith angle for VNIR.</span>
<span class="sd">        time_coverage_start (datetime): Start time of acquisition.</span>
<span class="sd">        time_coverage_end (datetime): End time of acquisition.</span>
<span class="sd">        units (str): Units of radiance data (mW/m2/sr/nm).</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Initialize the PRISMA reader with a data path</span>
<span class="sd">        &gt;&gt;&gt; prisma = PRISMA(&#39;/path/to/prisma_file.he5&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # Load RGB bands</span>
<span class="sd">        &gt;&gt;&gt; rgb = prisma.load_rgb(as_reflectance=True)</span>
<span class="sd">        &gt;&gt;&gt; # Load specific wavelengths</span>
<span class="sd">        &gt;&gt;&gt; bands = prisma.load_wavelengths([850, 1600, 2200], as_reflectance=True)</span>
<span class="sd">        &gt;&gt;&gt; # Get image metadata</span>
<span class="sd">        &gt;&gt;&gt; print(prisma)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swir_cube_dat</span> <span class="o">=</span> <span class="n">SWIR_FLAG</span><span class="p">[</span><span class="s2">&quot;swir_cube_dat&quot;</span><span class="p">][</span><span class="kc">True</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vni_cube_dat</span> <span class="o">=</span> <span class="n">SWIR_FLAG</span><span class="p">[</span><span class="s2">&quot;swir_cube_dat&quot;</span><span class="p">][</span><span class="kc">False</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">HE5_COORDS</span><span class="p">[</span><span class="s2">&quot;swir_lat&quot;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dset</span><span class="p">[:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">HE5_COORDS</span><span class="p">[</span><span class="s2">&quot;swir_lon&quot;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dset</span><span class="p">[:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes_prisma</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
            <span class="n">sza</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Sun_zenith_angle&quot;</span><span class="p">]</span>

        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes_prisma</span><span class="p">[</span><span class="s2">&quot;List_Cw_Vnir&quot;</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes_prisma</span><span class="p">[</span><span class="s2">&quot;List_Cw_Vnir&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbands_vnir</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes_prisma</span><span class="p">[</span><span class="s2">&quot;List_Cw_Swir&quot;</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes_prisma</span><span class="p">[</span><span class="s2">&quot;List_Cw_Swir&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbands_swir</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_swir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_swir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_vnir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_vnir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vza_swir</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vza_vnir</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sza_swir</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">sza</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sza_vnir</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">sza</span>

        <span class="c1"># self.time_coverage_start = self.attributes_prisma[&#39;Product_StartTime&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes_prisma</span><span class="p">[</span><span class="s2">&quot;Product_StartTime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes_prisma</span><span class="p">[</span><span class="s2">&quot;Product_StopTime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;mW/m2/sr/nm&quot;</span>  <span class="c1"># same as W/m^2/SR/um</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_footprint</span> <span class="o">=</span> <span class="n">griddata</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">compare_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">crs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_footprint</span>

        <span class="k">return</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_footprint</span><span class="p">,</span> <span class="n">crs_polygon</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">crs_dst</span><span class="o">=</span><span class="n">crs</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observation_date_correction_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">reflectance</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">(</span>
                    <span class="n">date_of_acquisition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_start</span><span class="p">,</span>
                    <span class="n">center_coords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_footprint</span><span class="o">.</span><span class="n">bounds</span>

    <span class="k">def</span> <span class="nf">load_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">swir_flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the all the data from all the wavelengths for the VNIR or SWIR range.</span>
<span class="sd">        This function caches the data, wavelegths and FWHM in the attributes of the class:</span>
<span class="sd">            * `ltoa_swir`, `wavelength_swir`, `fwhm_swir`, `vza_swir`, `sza_swir` if `swir_flag` is True</span>
<span class="sd">            * `ltoa_vnir`, `wavelength_vnir`, `fwhm_vnir`, `vza_vnir`, `sza_vnir` if `swir_flag` is False</span>

<span class="sd">        Args:</span>
<span class="sd">            swir_flag (bool): if True it will load the SWIR range, otherwise it will load the VNIR range</span>

<span class="sd">        Returns:</span>
<span class="sd">            NDArray: 3D array with the reflectance values (H, W, B)</span>
<span class="sd">                where N and M are the dimensions of the image and B is the number of bands.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">swir_flag</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_swir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_swir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vza_swir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sza_swir</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_vnir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_vnir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vza_vnir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sza_vnir</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span>

        <span class="n">swir_cube_dat</span> <span class="o">=</span> <span class="n">SWIR_FLAG</span><span class="p">[</span><span class="s2">&quot;swir_cube_dat&quot;</span><span class="p">][</span><span class="n">swir_flag</span><span class="p">]</span>
        <span class="n">swir_lab</span> <span class="o">=</span> <span class="n">SWIR_FLAG</span><span class="p">[</span><span class="s2">&quot;swir_lab&quot;</span><span class="p">][</span><span class="n">swir_flag</span><span class="p">]</span>  <span class="c1"># True: &quot;Swir&quot;, False: &quot;Vnir&quot;</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">swir_cube_dat</span><span class="p">]</span>

            <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dset</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/KDP_AUX/Cw_&quot;</span> <span class="o">+</span> <span class="n">swir_lab</span> <span class="o">+</span> <span class="s2">&quot;_Matrix&quot;</span><span class="p">]</span>
            <span class="n">wvl_mat_ini</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[:,</span> <span class="p">:]</span>

            <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/KDP_AUX/Fwhm_&quot;</span> <span class="o">+</span> <span class="n">swir_lab</span> <span class="o">+</span> <span class="s2">&quot;_Matrix&quot;</span><span class="p">]</span>
            <span class="n">fwhm_mat_ini</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[:,</span> <span class="p">:]</span>

            <span class="n">sc_fac</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;ScaleFactor_&quot;</span> <span class="o">+</span> <span class="n">swir_lab</span><span class="p">]</span>

            <span class="n">of_fac</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Offset_&quot;</span> <span class="o">+</span> <span class="n">swir_lab</span><span class="p">]</span>

            <span class="n">vza</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">sza</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Sun_zenith_angle&quot;</span><span class="p">]</span>

            <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">ltoa_img</span> <span class="o">/</span> <span class="n">sc_fac</span> <span class="o">-</span> <span class="n">of_fac</span>

        <span class="c1"># Lambda</span>
        <span class="n">wvl_mat_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">wvl_mat_ini</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">li_no0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wvl_mat_ini</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">wvl_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">wvl_mat_ini</span><span class="p">[:,</span> <span class="n">li_no0</span><span class="p">])</span>
        <span class="n">wl_center_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wvl_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># FWHM</span>
        <span class="n">fwhm_mat_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">fwhm_mat_ini</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fwhm_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">fwhm_mat_ini</span><span class="p">[:,</span> <span class="n">li_no0</span><span class="p">])</span>

        <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">B_tot</span> <span class="o">=</span> <span class="n">ltoa_img</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="n">swir_flag</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">B_tot</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wl_center_ini</span><span class="p">):</span>
                <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">B_tot</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wl_center_ini</span><span class="p">):</span>
                <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Revisar esto(not sure)</span>

        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">swir_flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span> <span class="o">=</span> <span class="n">ltoa_img</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_swir</span> <span class="o">=</span> <span class="n">wvl_mat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_swir</span> <span class="o">=</span> <span class="n">fwhm_mat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vza_swir</span> <span class="o">=</span> <span class="n">vza</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sza_swir</span> <span class="o">=</span> <span class="n">sza</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span> <span class="o">=</span> <span class="n">ltoa_img</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_vnir</span> <span class="o">=</span> <span class="n">wvl_mat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_vnir</span> <span class="o">=</span> <span class="n">fwhm_mat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vza_vnir</span> <span class="o">=</span> <span class="n">vza</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sza_vnir</span> <span class="o">=</span> <span class="n">sza</span>

        <span class="k">return</span> <span class="n">ltoa_img</span>

    <span class="c1"># def target_spectrum(self, swir_flag:bool) -&gt; NDArray:</span>

    <span class="c1">#     if swir_flag:</span>
    <span class="c1">#         vza = self.vza_swir</span>
    <span class="c1">#         sza = self.sza_swir</span>
    <span class="c1">#         band_array = self.wavelength_swir</span>
    <span class="c1">#         fwhm_array = self.fwhm_swir</span>
    <span class="c1">#         N, M, B = self.ltoa_swir.shape</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         vza = self.vza_vnir</span>
    <span class="c1">#         sza = self.sza_vnir</span>
    <span class="c1">#         band_array = self.wavelength_vnir</span>
    <span class="c1">#         fwhm_array = self.fwhm_vnir</span>
    <span class="c1">#         N, M, B = self.ltoa_vnir.shape</span>

    <span class="c1">#     amf = 1.0 / np.cos(vza * np.pi / 180) + 1.0 / np.cos(sza * np.pi / 180)</span>
    <span class="c1">#     parent_dir = os.path.dirname(os.path.dirname(__file__))</span>
    <span class="c1">#     file_lut_gas = os.path.join(parent_dir, LUT_FILE[&quot;name&quot;])</span>

    <span class="c1">#     wvl_mod, t_gas_arr, gas_sc_arr, mr_gas_arr = read_luts(</span>
    <span class="c1">#         file_lut=file_lut_gas,</span>
    <span class="c1">#         t_arr_str=LUT_FILE[&quot;t_arr_variable&quot;],</span>
    <span class="c1">#         sc_arr_str=LUT_FILE[&quot;sc_arr_variable&quot;],</span>
    <span class="c1">#         mr_arr_str=LUT_FILE[&quot;mr_arr_variable&quot;],</span>
    <span class="c1">#         amf=amf,</span>
    <span class="c1">#     )</span>

    <span class="c1">#     n_wvl = len(wvl_mod)</span>
    <span class="c1">#     mr_gas_arr = mr_gas_arr / 1000.0</span>
    <span class="c1">#     delta_mr_ref = 1.0</span>

    <span class="c1">#     k_spectre = calc_jac_rad(mr_gas_arr, n_wvl, t_gas_arr, delta_mr_ref)</span>
    <span class="c1">#     k_array = np.zeros((M, B))</span>
    <span class="c1">#     for i in range(0, M):</span>
    <span class="c1">#         s = generate_filter(wvl_mod, band_array[i], fwhm_array[i])</span>
    <span class="c1">#         k = np.dot(k_spectre, s)</span>
    <span class="c1">#         k_array[i] = k</span>

    <span class="c1">#     return k_array</span>

    <span class="k">def</span> <span class="nf">load_wavelengths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wavelengths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">],</span>
        <span class="n">as_reflectance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">resolution_dst</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">dst_crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_value_default</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoTensor</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the reflectance of the given wavelengths</span>

<span class="sd">        Args:</span>
<span class="sd">            wavelengths (Union[float, List[float], NDArray]): List of wavelengths to load</span>
<span class="sd">            as_reflectance (bool, optional): return the values as reflectance rather than radiance. Defaults to True.</span>
<span class="sd">                If False values will have units of W/m^2/SR/um (`self.units`)</span>
<span class="sd">            raw (bool, optional): if True it will return the raw values,</span>
<span class="sd">                if False it will return the values reprojected to the specified CRS and resolution. Defaults to True.</span>
<span class="sd">            resolution_dst (int, optional): if raw is False, it will reproject the values to this resolution. Defaults to 30.</span>
<span class="sd">            dst_crs (Optional[Any], optional): if None it will use the corresponding UTM zone.</span>
<span class="sd">            fill_value_default (float, optional): fill value. Defaults to -1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[GeoTensor, NDArray]: if raw is True it will return a NDArray with the values, otherwise it will return a GeoTensor</span>
<span class="sd">                with the reprojected values in its `.values` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wavelengths</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>

        <span class="n">load_swir</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">wvl</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wvl</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">wvl</span> <span class="ow">in</span> <span class="n">wavelengths</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">load_vnir</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">wvl</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wvl</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">wvl</span> <span class="ow">in</span> <span class="n">wavelengths</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">load_swir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_raw</span><span class="p">(</span><span class="n">swir_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">wavelength_swir_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength_swir</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">fwhm_swir_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_swir</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">load_vnir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_raw</span><span class="p">(</span><span class="n">swir_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">wavelength_vnir_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength_vnir</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">fwhm_vnir_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_vnir</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fwhm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">index_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength_swir_mean</span><span class="p">))</span>
                <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fwhm_swir_mean</span><span class="p">[</span><span class="n">index_band</span><span class="p">])</span>
                <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">index_band</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength_vnir_mean</span><span class="p">))</span>
                <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fwhm_vnir_mean</span><span class="p">[</span><span class="n">index_band</span><span class="p">])</span>
                <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">index_band</span><span class="p">]</span>

            <span class="n">ltoa_img</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># Transpose to row major</span>
        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">as_reflectance</span><span class="p">:</span>
            <span class="n">thuiller</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">load_thuillier_irradiance</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">srf</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Nanometer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="n">solar_irradiance_norm</span> <span class="o">=</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Radiance(mW/m2/nm)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
                <span class="n">response</span>
            <span class="p">)</span>  <span class="c1"># mW/m$^2$/nm</span>
            <span class="n">solar_irradiance_norm</span> <span class="o">/=</span> <span class="mi">1_000</span>  <span class="c1"># W/m$^2$/nm</span>

            <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">radiance_to_reflectance</span><span class="p">(</span>
                <span class="n">ltoa_img</span><span class="p">,</span>
                <span class="n">solar_irradiance_norm</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                <span class="n">observation_date_corr_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ltoa_img</span>

        <span class="k">return</span> <span class="n">griddata</span><span class="o">.</span><span class="n">read_to_crs</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="n">lons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lons</span><span class="p">,</span>
            <span class="n">lats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lats</span><span class="p">,</span>
            <span class="n">resolution_dst</span><span class="o">=</span><span class="n">resolution_dst</span><span class="p">,</span>
            <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span>
            <span class="n">fill_value_default</span><span class="o">=</span><span class="n">fill_value_default</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_rgb</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoTensor</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wavelengths</span><span class="p">(</span>
            <span class="n">wavelengths</span><span class="o">=</span><span class="n">WAVELENGTHS_RGB</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="o">=</span><span class="n">as_reflectance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span>
<span class="s2">        Bounds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="si">}</span>
<span class="s2">        Time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_start</span><span class="si">}</span>
<span class="s2">        VNIR Range: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbands_vnir</span><span class="si">}</span><span class="s2"> bands</span>
<span class="s2">        SWIR Range: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbands_swir</span><span class="si">}</span><span class="s2"> bands</span>
<span class="s2">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="georeader.readers.prisma.PRISMA.load_raw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_raw</span><span class="p">(</span><span class="n">swir_flag</span><span class="p">)</span></code>

<a href="#georeader.readers.prisma.PRISMA.load_raw" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load the all the data from all the wavelengths for the VNIR or SWIR range.
This function caches the data, wavelegths and FWHM in the attributes of the class:
    * <code>ltoa_swir</code>, <code>wavelength_swir</code>, <code>fwhm_swir</code>, <code>vza_swir</code>, <code>sza_swir</code> if <code>swir_flag</code> is True
    * <code>ltoa_vnir</code>, <code>wavelength_vnir</code>, <code>fwhm_vnir</code>, <code>vza_vnir</code>, <code>sza_vnir</code> if <code>swir_flag</code> is False</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>swir_flag</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True it will load the SWIR range, otherwise it will load the VNIR range</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>NDArray</code></td>            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D array with the reflectance values (H, W, B)
where N and M are the dimensions of the image and B is the number of bands.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/prisma.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">swir_flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the all the data from all the wavelengths for the VNIR or SWIR range.</span>
<span class="sd">    This function caches the data, wavelegths and FWHM in the attributes of the class:</span>
<span class="sd">        * `ltoa_swir`, `wavelength_swir`, `fwhm_swir`, `vza_swir`, `sza_swir` if `swir_flag` is True</span>
<span class="sd">        * `ltoa_vnir`, `wavelength_vnir`, `fwhm_vnir`, `vza_vnir`, `sza_vnir` if `swir_flag` is False</span>

<span class="sd">    Args:</span>
<span class="sd">        swir_flag (bool): if True it will load the SWIR range, otherwise it will load the VNIR range</span>

<span class="sd">    Returns:</span>
<span class="sd">        NDArray: 3D array with the reflectance values (H, W, B)</span>
<span class="sd">            where N and M are the dimensions of the image and B is the number of bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">swir_flag</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_swir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_swir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vza_swir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sza_swir</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_vnir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_vnir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vza_vnir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sza_vnir</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span>

    <span class="n">swir_cube_dat</span> <span class="o">=</span> <span class="n">SWIR_FLAG</span><span class="p">[</span><span class="s2">&quot;swir_cube_dat&quot;</span><span class="p">][</span><span class="n">swir_flag</span><span class="p">]</span>
    <span class="n">swir_lab</span> <span class="o">=</span> <span class="n">SWIR_FLAG</span><span class="p">[</span><span class="s2">&quot;swir_lab&quot;</span><span class="p">][</span><span class="n">swir_flag</span><span class="p">]</span>  <span class="c1"># True: &quot;Swir&quot;, False: &quot;Vnir&quot;</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">swir_cube_dat</span><span class="p">]</span>

        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dset</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/KDP_AUX/Cw_&quot;</span> <span class="o">+</span> <span class="n">swir_lab</span> <span class="o">+</span> <span class="s2">&quot;_Matrix&quot;</span><span class="p">]</span>
        <span class="n">wvl_mat_ini</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[:,</span> <span class="p">:]</span>

        <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;/KDP_AUX/Fwhm_&quot;</span> <span class="o">+</span> <span class="n">swir_lab</span> <span class="o">+</span> <span class="s2">&quot;_Matrix&quot;</span><span class="p">]</span>
        <span class="n">fwhm_mat_ini</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[:,</span> <span class="p">:]</span>

        <span class="n">sc_fac</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;ScaleFactor_&quot;</span> <span class="o">+</span> <span class="n">swir_lab</span><span class="p">]</span>

        <span class="n">of_fac</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Offset_&quot;</span> <span class="o">+</span> <span class="n">swir_lab</span><span class="p">]</span>

        <span class="n">vza</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">sza</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Sun_zenith_angle&quot;</span><span class="p">]</span>

        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">ltoa_img</span> <span class="o">/</span> <span class="n">sc_fac</span> <span class="o">-</span> <span class="n">of_fac</span>

    <span class="c1"># Lambda</span>
    <span class="n">wvl_mat_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">wvl_mat_ini</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">li_no0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wvl_mat_ini</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">wvl_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">wvl_mat_ini</span><span class="p">[:,</span> <span class="n">li_no0</span><span class="p">])</span>
    <span class="n">wl_center_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wvl_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># FWHM</span>
    <span class="n">fwhm_mat_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">fwhm_mat_ini</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fwhm_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">fwhm_mat_ini</span><span class="p">[:,</span> <span class="n">li_no0</span><span class="p">])</span>

    <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">B_tot</span> <span class="o">=</span> <span class="n">ltoa_img</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">if</span> <span class="n">swir_flag</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">B_tot</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wl_center_ini</span><span class="p">):</span>
            <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">B_tot</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wl_center_ini</span><span class="p">):</span>
            <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Revisar esto(not sure)</span>

    <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">swir_flag</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span> <span class="o">=</span> <span class="n">ltoa_img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_swir</span> <span class="o">=</span> <span class="n">wvl_mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_swir</span> <span class="o">=</span> <span class="n">fwhm_mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vza_swir</span> <span class="o">=</span> <span class="n">vza</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sza_swir</span> <span class="o">=</span> <span class="n">sza</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span> <span class="o">=</span> <span class="n">ltoa_img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_vnir</span> <span class="o">=</span> <span class="n">wvl_mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_vnir</span> <span class="o">=</span> <span class="n">fwhm_mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vza_vnir</span> <span class="o">=</span> <span class="n">vza</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sza_vnir</span> <span class="o">=</span> <span class="n">sza</span>

    <span class="k">return</span> <span class="n">ltoa_img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.prisma.PRISMA.load_wavelengths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_wavelengths</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resolution_dst</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#georeader.readers.prisma.PRISMA.load_wavelengths" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load the reflectance of the given wavelengths</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>wavelengths</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[float, <span title="typing.List">List</span>[float], <span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of wavelengths to load</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_reflectance</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>return the values as reflectance rather than radiance. Defaults to True.
If False values will have units of W/m^2/SR/um (<code>self.units</code>)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True it will return the raw values,
if False it will return the values reprojected to the specified CRS and resolution. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution_dst</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if raw is False, it will reproject the values to this resolution. Defaults to 30.</p>
              </div>
            </td>
            <td>
                  <code>30</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dst_crs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if None it will use the corresponding UTM zone.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_value_default</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fill value. Defaults to -1.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a>, <span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[GeoTensor, NDArray]: if raw is True it will return a NDArray with the values, otherwise it will return a GeoTensor
with the reprojected values in its <code>.values</code> attribute.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/prisma.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_wavelengths</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">wavelengths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">],</span>
    <span class="n">as_reflectance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">resolution_dst</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">dst_crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fill_value_default</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoTensor</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the reflectance of the given wavelengths</span>

<span class="sd">    Args:</span>
<span class="sd">        wavelengths (Union[float, List[float], NDArray]): List of wavelengths to load</span>
<span class="sd">        as_reflectance (bool, optional): return the values as reflectance rather than radiance. Defaults to True.</span>
<span class="sd">            If False values will have units of W/m^2/SR/um (`self.units`)</span>
<span class="sd">        raw (bool, optional): if True it will return the raw values,</span>
<span class="sd">            if False it will return the values reprojected to the specified CRS and resolution. Defaults to True.</span>
<span class="sd">        resolution_dst (int, optional): if raw is False, it will reproject the values to this resolution. Defaults to 30.</span>
<span class="sd">        dst_crs (Optional[Any], optional): if None it will use the corresponding UTM zone.</span>
<span class="sd">        fill_value_default (float, optional): fill value. Defaults to -1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[GeoTensor, NDArray]: if raw is True it will return a NDArray with the values, otherwise it will return a GeoTensor</span>
<span class="sd">            with the reprojected values in its `.values` attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wavelengths</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>

    <span class="n">load_swir</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">wvl</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wvl</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">wvl</span> <span class="ow">in</span> <span class="n">wavelengths</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">load_vnir</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">wvl</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wvl</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">wvl</span> <span class="ow">in</span> <span class="n">wavelengths</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">load_swir</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_raw</span><span class="p">(</span><span class="n">swir_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wavelength_swir_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength_swir</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">fwhm_swir_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_swir</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">load_vnir</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_raw</span><span class="p">(</span><span class="n">swir_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">wavelength_vnir_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength_vnir</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">fwhm_vnir_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_vnir</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ltoa_img</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fwhm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="ow">and</span> <span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">index_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength_swir_mean</span><span class="p">))</span>
            <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fwhm_swir_mean</span><span class="p">[</span><span class="n">index_band</span><span class="p">])</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_swir</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">index_band</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength_vnir_mean</span><span class="p">))</span>
            <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fwhm_vnir_mean</span><span class="p">[</span><span class="n">index_band</span><span class="p">])</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltoa_vnir</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">index_band</span><span class="p">]</span>

        <span class="n">ltoa_img</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="c1"># Transpose to row major</span>
    <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">as_reflectance</span><span class="p">:</span>
        <span class="n">thuiller</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">load_thuillier_irradiance</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">srf</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Nanometer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="n">solar_irradiance_norm</span> <span class="o">=</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Radiance(mW/m2/nm)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="n">response</span>
        <span class="p">)</span>  <span class="c1"># mW/m$^2$/nm</span>
        <span class="n">solar_irradiance_norm</span> <span class="o">/=</span> <span class="mi">1_000</span>  <span class="c1"># W/m$^2$/nm</span>

        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">radiance_to_reflectance</span><span class="p">(</span>
            <span class="n">ltoa_img</span><span class="p">,</span>
            <span class="n">solar_irradiance_norm</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
            <span class="n">observation_date_corr_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ltoa_img</span>

    <span class="k">return</span> <span class="n">griddata</span><span class="o">.</span><span class="n">read_to_crs</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="n">lons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lons</span><span class="p">,</span>
        <span class="n">lats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lats</span><span class="p">,</span>
        <span class="n">resolution_dst</span><span class="o">=</span><span class="n">resolution_dst</span><span class="p">,</span>
        <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span>
        <span class="n">fill_value_default</span><span class="o">=</span><span class="n">fill_value_default</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="emit-reader">EMIT Reader<a class="headerlink" href="#emit-reader" title="Permanent link">&para;</a></h2>
<p>The EMIT (Earth Surface Mineral Dust Source Investigation) reader provides access to NASA's imaging spectrometer data from the International Space Station. This reader works with Level 1B calibrated radiance data (not atmospherically corrected).</p>
<p>Key features:</p>
<ul>
<li>Reading L1B hyperspectral radiance data from NetCDF4 format files</li>
<li>Working with the 380-2500 nm spectral range with 7.4 nm sampling</li>
<li>Irregular grid georeferencing through GLT (Geographic Lookup Table)</li>
<li>Support for the observation geometry information (solar and viewing angles)</li>
<li>Integration with L2A mask products for cloud and shadow detection</li>
<li>Quality-aware analysis with cloud, cirrus, and spacecraft flag masks</li>
<li>Conversion from radiance (μW/cm²/sr/nm) to top-of-atmosphere reflectance</li>
<li>Support for downloading data from NASA DAAC portals</li>
<li>Automatic detection and use of appropriate UTM projection</li>
</ul>
<p><strong>Tutorial example:</strong></p>
<ul>
<li><a href="../../emit_explore/">Working with EMIT images</a></li>
</ul>
<h3 id="api-reference_4">API Reference<a class="headerlink" href="#api-reference_4" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="georeader.readers.emit"></a>
    <div class="doc doc-contents first">

        <p>Module to read EMIT images.</p>
<p>Requires: netCDF4:
pip install netCDF4 </p>
<p>Some of the functions of this module are based on the official EMIT repo: https://github.com/emit-sds/emit-utils/</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="georeader.readers.emit.EMITImage" class="doc doc-heading">
            <code>EMITImage</code>


<a href="#georeader.readers.emit.EMITImage" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class to read L1B EMIT (Earth Surface Mineral Dust Source Investigation) images.</p>
<p>This class provides functionality to read and manipulate EMIT satellite imagery products.
It handles the specific format and metadata of EMIT HDF files, supporting operations
like loading radiometry data, masks, and viewing/solar angles.</p>
<p>This class incorporates features from the official EMIT utilities:
https://github.com/emit-sds/emit-utils/</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the EMIT .nc file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>glt</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional pre-loaded GLT (Geographic Lookup Table).
If None, it will be loaded from the file. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>band_selection</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[int, <span title="typing.Tuple">Tuple</span>[int, ...], slice]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional band selection.
Defaults to slice(None) (all bands).</p>
              </div>
            </td>
            <td>
                  <code>slice(None)</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.filename">filename</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the EMIT file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.nc_ds">nc_ds</span></code></td>
            <td>
                  <code><span title="netCDF4.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>netCDF4 dataset for the EMIT file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage._nc_ds_obs">_nc_ds_obs</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="netCDF4.Dataset">Dataset</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>netCDF4 dataset for observation data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage._nc_ds_l2amask">_nc_ds_l2amask</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="netCDF4.Dataset">Dataset</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>netCDF4 dataset for L2A mask.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.real_transform">real_transform</span></code></td>
            <td>
                  <code><span title="rasterio.Affine">Affine</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Affine transform for the image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.time_coverage_start">time_coverage_start</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time of the acquisition.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.time_coverage_end">time_coverage_end</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time of the acquisition.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.dtype">dtype</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type of the radiometry data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.dims">dims</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of dimensions ("band", "y", "x").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.fill_value_default">fill_value_default</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default fill value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.nodata">nodata</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>No data value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.units">units</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Units of the radiometry data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.glt">glt</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geographic Lookup Table as a GeoTensor.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.valid_glt">valid_glt</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean mask of valid GLT values.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.glt_relative">glt_relative</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relative Geographic Lookup Table.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.window_raw">window_raw</span></code></td>
            <td>
                  <code><span title="rasterio.windows.Window">Window</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Window for raw data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.bandname_dimension">bandname_dimension</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimension name for bands.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.band_selection">band_selection</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current band selection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.wavelengths">wavelengths</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wavelengths of the selected bands.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.emit.EMITImage.fwhm">fwhm</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full Width at Half Maximum for each band.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">georeader.readers.emit</span> <span class="kn">import</span> <span class="n">EMITImage</span><span class="p">,</span> <span class="n">download_product</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="s1">&#39;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/EMIT_L1B_RAD_001_20220828T051941_2224004_006/EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath</span> <span class="o">=</span> <span class="n">download_product</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">emit</span> <span class="o">=</span> <span class="n">EMITImage</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Reproject to UTM</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crs_utm</span> <span class="o">=</span> <span class="n">georeader</span><span class="o">.</span><span class="n">get_utm_epsg</span><span class="p">(</span><span class="n">emit</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">emit_utm</span> <span class="o">=</span> <span class="n">emit</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs_utm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load as reflectance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reflectance</span> <span class="o">=</span> <span class="n">emit_utm</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">as_reflectance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get cloud mask</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">emit</span><span class="o">.</span><span class="n">nc_ds_l2amask</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/emit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EMITImage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to read L1B EMIT (Earth Surface Mineral Dust Source Investigation) images.</span>

<span class="sd">    This class provides functionality to read and manipulate EMIT satellite imagery products.</span>
<span class="sd">    It handles the specific format and metadata of EMIT HDF files, supporting operations</span>
<span class="sd">    like loading radiometry data, masks, and viewing/solar angles.</span>

<span class="sd">    This class incorporates features from the official EMIT utilities:</span>
<span class="sd">    https://github.com/emit-sds/emit-utils/</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): Path to the EMIT .nc file.</span>
<span class="sd">        glt (Optional[GeoTensor]): Optional pre-loaded GLT (Geographic Lookup Table).</span>
<span class="sd">            If None, it will be loaded from the file. Defaults to None.</span>
<span class="sd">        band_selection (Optional[Union[int, Tuple[int, ...], slice]]): Optional band selection.</span>
<span class="sd">            Defaults to slice(None) (all bands).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        filename (str): Path to the EMIT file.</span>
<span class="sd">        nc_ds (netCDF4.Dataset): netCDF4 dataset for the EMIT file.</span>
<span class="sd">        _nc_ds_obs (Optional[netCDF4.Dataset]): netCDF4 dataset for observation data.</span>
<span class="sd">        _nc_ds_l2amask (Optional[netCDF4.Dataset]): netCDF4 dataset for L2A mask.</span>
<span class="sd">        real_transform (rasterio.Affine): Affine transform for the image.</span>
<span class="sd">        time_coverage_start (datetime): Start time of the acquisition.</span>
<span class="sd">        time_coverage_end (datetime): End time of the acquisition.</span>
<span class="sd">        dtype: Data type of the radiometry data.</span>
<span class="sd">        dims (Tuple[str]): Names of dimensions (&quot;band&quot;, &quot;y&quot;, &quot;x&quot;).</span>
<span class="sd">        fill_value_default: Default fill value.</span>
<span class="sd">        nodata: No data value.</span>
<span class="sd">        units (str): Units of the radiometry data.</span>
<span class="sd">        glt (GeoTensor): Geographic Lookup Table as a GeoTensor.</span>
<span class="sd">        valid_glt (numpy.ndarray): Boolean mask of valid GLT values.</span>
<span class="sd">        glt_relative (GeoTensor): Relative Geographic Lookup Table.</span>
<span class="sd">        window_raw (rasterio.windows.Window): Window for raw data.</span>
<span class="sd">        bandname_dimension (str): Dimension name for bands.</span>
<span class="sd">        band_selection: Current band selection.</span>
<span class="sd">        wavelengths (numpy.ndarray): Wavelengths of the selected bands.</span>
<span class="sd">        fwhm (numpy.ndarray): Full Width at Half Maximum for each band.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from georeader.readers.emit import EMITImage, download_product</span>
<span class="sd">        &gt;&gt;&gt; link = &#39;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/EMIT_L1B_RAD_001_20220828T051941_2224004_006/EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; filepath = download_product(link)</span>
<span class="sd">        &gt;&gt;&gt; emit = EMITImage(filepath)</span>
<span class="sd">        &gt;&gt;&gt; # Reproject to UTM</span>
<span class="sd">        &gt;&gt;&gt; crs_utm = georeader.get_utm_epsg(emit.footprint(&quot;EPSG:4326&quot;))</span>
<span class="sd">        &gt;&gt;&gt; emit_utm = emit.to_crs(crs_utm)</span>
<span class="sd">        &gt;&gt;&gt; # Load as reflectance</span>
<span class="sd">        &gt;&gt;&gt; reflectance = emit_utm.load(as_reflectance=True)</span>
<span class="sd">        &gt;&gt;&gt; # Get cloud mask</span>
<span class="sd">        &gt;&gt;&gt; cloud_mask = emit.nc_ds_l2amask</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attributes_set_if_exists</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_nc_ds_obs&quot;</span><span class="p">,</span> <span class="s2">&quot;_mean_sza&quot;</span><span class="p">,</span> <span class="s2">&quot;_mean_vza&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;_observation_bands&quot;</span><span class="p">,</span> <span class="s2">&quot;_nc_ds_l2amask&quot;</span><span class="p">,</span> <span class="s2">&quot;_mask_bands&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;_nc_ds&quot;</span><span class="p">,</span> <span class="s2">&quot;obs_file&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;l2amaskfile&quot;</span><span class="p">]</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">glt</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">GeoTensor</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">band_selection</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span><span class="nb">slice</span><span class="p">]]</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_obs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_l2amask</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_bands</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mask_bands</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">set_auto_mask</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># disable automatic masking when reading data</span>
        <span class="c1"># self.real_shape = (self.nc_ds[&#39;radiance&#39;].shape[-1],) + self.nc_ds[&#39;radiance&#39;].shape[:-1]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mean_sza</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mean_vza</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_file</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l2amaskfile</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">time_coverage_start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S%z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">time_coverage_end</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S%z&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;radiance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;radiance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;radiance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s2">&quot;radiance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>

        <span class="k">if</span> <span class="n">glt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">glt_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;glt_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">glt_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;glt_x&#39;</span><span class="p">])</span>
            <span class="n">glt_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;glt_y&#39;</span><span class="p">])</span>
            <span class="c1"># glt_arr -= 1 # account for 1-based indexing</span>

            <span class="c1"># https://rasterio.readthedocs.io/en/stable/api/rasterio.crs.html</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glt</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">glt_arr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_transform</span><span class="p">,</span> 
                                 <span class="n">crs</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_wkt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">spatial_ref</span><span class="p">),</span>
                                 <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glt</span> <span class="o">=</span> <span class="n">glt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">valid_glt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">values</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds_indexes_raw</span><span class="p">()</span> <span class="c1"># values are 1-based!</span>

        <span class="c1"># glt has the absolute indexes of the netCDF object</span>
        <span class="c1"># glt_relative has the relative indexes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glt_relative</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glt_relative</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_glt</span><span class="p">]</span> <span class="o">-=</span> <span class="n">xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glt_relative</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_glt</span><span class="p">]</span> <span class="o">-=</span> <span class="n">ymin</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">col_off</span><span class="o">=</span><span class="n">xmin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">row_off</span><span class="o">=</span><span class="n">ymin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> 
                                                  <span class="n">width</span><span class="o">=</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;wavelengths&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bandname_dimension</span> <span class="o">=</span> <span class="s2">&quot;wavelengths&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;radiance_wl&quot;</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bandname_dimension</span> <span class="o">=</span> <span class="s2">&quot;radiance_wl&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot find wavelength dimension in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span> <span class="o">=</span> <span class="n">band_selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">bandname_dimension</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;fwhm&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observation_date_correction_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">(</span><span class="n">date_of_acquisition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_start</span><span class="p">,</span>
                                                                                                      <span class="n">center_coords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">crs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">n_bands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span><span class="p">)</span>
            <span class="k">return</span>  <span class="p">(</span><span class="n">n_bands</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Affine</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">transform</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">res</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">bounds</span>

    <span class="k">def</span> <span class="nf">footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Polygon</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the footprint of the image in the given CRS. If no CRS is given, the footprint is returned in the native CRS.</span>
<span class="sd">        This function takes into account the valid_glt mask to compute the footprint.</span>

<span class="sd">        Args:</span>
<span class="sd">            crs (Optional[str], optional): The CRS to return the footprint in. Defaults to None. </span>
<span class="sd">                If None, the footprint is returned in the native CRS.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Polygon: The footprint of the image in the given CRS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_pol&#39;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">georeader.vectorize</span> <span class="kn">import</span> <span class="n">get_polygons</span>
            <span class="n">pols</span> <span class="o">=</span> <span class="n">get_polygons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_glt</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">pols</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pol_crs</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pol_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span>

        <span class="n">pol_glt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pol_crs</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">pol_glt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_band_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_selection</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span><span class="nb">slice</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the band selection. Band selection is absolute w.r.t self.nc_ds[&#39;radiance&#39;]</span>

<span class="sd">        Args:</span>
<span class="sd">            band_selection (Optional[Union[int, Tuple[int, ...],slice]], optional): slicing or selection of the bands. Defaults to None.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; emit_image.set_band_selection(slice(0, 3)) # will only load the three first bands</span>
<span class="sd">            &gt;&gt;&gt; emit_image.wavelengths # will only return the wavelengths of the three first bands</span>
<span class="sd">            &gt;&gt;&gt; emit_image.load() # will only load the three first bands</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">band_selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">band_selection</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span> <span class="o">=</span> <span class="n">band_selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">bandname_dimension</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;fwhm&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">]</span>

    <span class="o">@</span> <span class="nb">property</span>
    <span class="k">def</span> <span class="nf">nc_ds_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_file</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the observation file. In this file we have information about angles (solar and viewing),</span>
<span class="sd">        elevation and ilumination based on elevation and path length.</span>

<span class="sd">        This function downloads the observation file if it does not exist from the JPL portal.</span>

<span class="sd">        It caches the observation file in the object. (self.nc_ds_obs)</span>

<span class="sd">        Args:</span>
<span class="sd">            obs_file (Optional[str], optional): Path to the observation file. </span>
<span class="sd">                Defaults to None. If none it will download the observation file </span>
<span class="sd">                from the EMIT server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_obs</span>

        <span class="k">if</span> <span class="n">obs_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">link_obs_file</span> <span class="o">=</span> <span class="n">get_obs_link</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">obs_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">link_obs_file</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">obs_file</span><span class="p">):</span>
                <span class="n">download_product</span><span class="p">(</span><span class="n">link_obs_file</span><span class="p">,</span> <span class="n">obs_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obs_file</span> <span class="o">=</span> <span class="n">obs_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_obs</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">obs_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_obs</span><span class="o">.</span><span class="n">set_auto_mask</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_bands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;observation_bands&#39;</span><span class="p">][:]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_obs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nc_ds_l2amask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l2amaskfile</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the L2A mask file. In this file we have information about the cloud mask.</span>

<span class="sd">        This function downloads the L2A mask file if it does not exist from the JPL portal.</span>

<span class="sd">        It caches the L2A mask file in the object. (self.nc_ds_l2amask)</span>

<span class="sd">        See https://lpdaac.usgs.gov/products/emitl2arflv001/ for info about the L2A mask file.</span>

<span class="sd">        Args:</span>
<span class="sd">            l2amaskfile (Optional[str], optional): Path to the L2A mask file. </span>
<span class="sd">                Defaults to None. If none it will download the L2A mask file </span>
<span class="sd">                from the EMIT server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_l2amask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_l2amask</span>

        <span class="k">if</span> <span class="n">l2amaskfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">link_l2amaskfile</span> <span class="o">=</span> <span class="n">get_l2amask_link</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">l2amaskfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">link_l2amaskfile</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">l2amaskfile</span><span class="p">):</span>
                <span class="n">download_product</span><span class="p">(</span><span class="n">link_l2amaskfile</span><span class="p">,</span> <span class="n">l2amaskfile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">l2amaskfile</span> <span class="o">=</span> <span class="n">l2amaskfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_l2amask</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">l2amaskfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_l2amask</span><span class="o">.</span><span class="n">set_auto_mask</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mask_bands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_l2amask</span><span class="p">[</span><span class="s2">&quot;sensor_band_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;mask_bands&quot;</span><span class="p">][:]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nc_ds_l2amask</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mask_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the mask bands -&gt; [&#39;Cloud flag&#39;, &#39;Cirrus flag&#39;, &#39;Water flag&#39;, &#39;Spacecraft Flag&#39;,</span>
<span class="sd">       &#39;Dilated Cloud Flag&#39;, &#39;AOD550&#39;, &#39;H2O (g cm-2)&#39;, &#39;Aggregate Flag&#39;] &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_l2amask</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_bands</span>

    <span class="k">def</span> <span class="nf">validmask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_buffer</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the validmask mask</span>


<span class="sd">        Returns:</span>
<span class="sd">            GeoTensor: bool mask. True means that the pixel is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">validmask</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">invalid_mask_raw</span><span class="p">(</span><span class="n">with_buffer</span><span class="o">=</span><span class="n">with_buffer</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">georreference</span><span class="p">(</span><span class="n">validmask</span><span class="p">,</span>
                                  <span class="n">fill_value_default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">invalid_mask_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_buffer</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the non georreferenced quality mask. True means that the pixel is not valid.</span>

<span class="sd">        This mask is computed as the sum of the Cloud flag, Cirrus flag, Spacecraft flag and Dilated Cloud Flag.</span>
<span class="sd">        True means that the pixel is not valid.</span>

<span class="sd">        From: https://github.com/nasa/EMIT-Data-Resources/blob/main/python/how-tos/How_to_use_EMIT_Quality_data.ipynb</span>
<span class="sd">        and https://github.com/nasa/EMIT-Data-Resources/blob/main/python/modules/emit_tools.py#L277</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">band_index</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">with_buffer</span><span class="p">:</span>
            <span class="n">band_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
        <span class="n">mask_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_l2amask</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">,</span> <span class="n">band_index</span><span class="p">]</span>
        <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mask_arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask_arr</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mask_arr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">percentage_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the percentage of clear pixels in the image</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: percentage of clear pixels</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">invalids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalid_mask_raw</span><span class="p">(</span><span class="n">with_buffer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">invalids</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">invalids</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;cloud_mask&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mask layer with the given name.</span>
<span class="sd">        Mask shall be one of self.mask_bands -&gt; [&#39;Cloud flag&#39;, &#39;Cirrus flag&#39;, &#39;Water flag&#39;, &#39;Spacecraft Flag&#39;,</span>
<span class="sd">       &#39;Dilated Cloud Flag&#39;, &#39;AOD550&#39;, &#39;H2O (g cm-2)&#39;, &#39;Aggregate Flag&#39;]</span>

<span class="sd">        Args:</span>
<span class="sd">            mask_name (str, optional): Name of the mask. Defaults to &quot;cloud_mask&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GeoTensor: mask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">band_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_bands</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mask_name</span><span class="p">)</span>
        <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
        <span class="n">mask_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_l2amask</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">,</span> <span class="n">band_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">georreference</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span>
                                  <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_l2amask</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">water_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the water mask &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="s2">&quot;Water flag&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observation_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the observation bands &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_bands</span>

    <span class="k">def</span> <span class="nf">observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the observation with the given name &quot;&quot;&quot;</span>
        <span class="n">band_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_bands</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
        <span class="n">obs_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">,</span> <span class="n">band_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">georreference</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> 
                                  <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sza</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the solar zenith angle as a GeoTensor &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation</span><span class="p">(</span><span class="s1">&#39;To-sun zenith (0 to 90 degrees from zenith)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vza</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the view zenith angle as a GeoTensor &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation</span><span class="p">(</span><span class="s1">&#39;To-sensor zenith (0 to 90 degrees from zenith)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">obs_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">][</span><span class="s2">&quot;elev&quot;</span><span class="p">]</span>
        <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">georreference</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">[</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">],</span> 
                                  <span class="n">fill_value_default</span><span class="o">=</span><span class="n">obs_arr</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mean_sza</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the mean solar zenith angle &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_sza</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_sza</span>

        <span class="n">band_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_bands</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;To-sun zenith (0 to 90 degrees from zenith)&#39;</span><span class="p">)</span>
        <span class="n">sza_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="n">band_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mean_sza</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sza_arr</span><span class="p">[</span><span class="n">sza_arr</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_sza</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mean_vza</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the mean view zenith angle &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_vza</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_vza</span>
        <span class="n">band_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_bands</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;To-sensor zenith (0 to 90 degrees from zenith)&#39;</span><span class="p">)</span>
        <span class="n">vza_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="n">band_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mean_vza</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vza_arr</span><span class="p">[</span><span class="n">vza_arr</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_vza</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;__class__&#39;</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">EMITImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">glt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">band_selection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">)</span>

        <span class="c1"># copy nc_ds_obs if it exists</span>
        <span class="k">for</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes_set_if_exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">out</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;__class__&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span><span class="n">Any</span><span class="o">=</span><span class="s2">&quot;UTM&quot;</span><span class="p">,</span> 
               <span class="n">resolution_dst_crs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;__class__&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reproject the image to a new crs</span>

<span class="sd">        Args:</span>
<span class="sd">            crs (Any): CRS. </span>

<span class="sd">        Returns:</span>
<span class="sd">            EmitImage: EMIT image in the new CRS</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; emit_image = EMITImage(&quot;path/to/emit_image.nc&quot;)</span>
<span class="sd">            &gt;&gt;&gt; emit_image_utm = emit_image.to_crs(crs=&quot;UTM&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">crs</span> <span class="o">==</span> <span class="s2">&quot;UTM&quot;</span><span class="p">:</span>
            <span class="n">footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="n">get_utm_epsg</span><span class="p">(</span><span class="n">footprint</span><span class="p">)</span>

        <span class="n">glt</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">read_to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">resampling</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">nearest</span><span class="p">,</span> 
                               <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="n">resolution_dst_crs</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">EMITImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">glt</span><span class="o">=</span><span class="n">glt</span><span class="p">,</span> <span class="n">band_selection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">)</span>
        <span class="c1"># Copy _pol attribute if it exists</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_pol&#39;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;_pol&#39;</span><span class="p">,</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">out</span>


    <span class="k">def</span> <span class="nf">read_from_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">Window</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;__class__&#39;</span><span class="p">:</span>
        <span class="n">glt_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">read_from_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">boundless</span><span class="o">=</span><span class="n">boundless</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">EMITImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">glt</span><span class="o">=</span><span class="n">glt_window</span><span class="p">,</span> <span class="n">band_selection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">)</span>

        <span class="c1"># copy attributes as in __copy__ method</span>
        <span class="k">for</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes_set_if_exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">read_from_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bands</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">slice</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;__class__&#39;</span><span class="p">:</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">set_band_selection</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copy</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundless</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_raw</span><span class="p">()</span> <span class="c1"># (C, H, W) or (H, W)</span>
        <span class="k">if</span> <span class="n">as_reflectance</span><span class="p">:</span>
            <span class="n">invalids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">)</span>
            <span class="n">thuiller</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">load_thuillier_irradiance</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">srf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">,</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Nanometer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">solar_irradiance_norm</span> <span class="o">=</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Radiance(mW/m2/nm)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1_000</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">radiance_to_reflectance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">solar_irradiance_norm</span><span class="p">,</span>
                                                       <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                                       <span class="n">observation_date_corr_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">invalids</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">georreference</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">bands_read</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">WAVELENGTHS_RGB</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">ei_rgb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_bands</span><span class="p">(</span><span class="n">bands_read</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ei_rgb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="o">=</span><span class="n">as_reflectance</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the shape of the raw data in (C, H, W) format &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span><span class="p">),)</span> <span class="o">+</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bounds_indexes_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the bounds of the raw data: (min_x, min_y, max_x, max_y) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_bounds_indexes_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_glt</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transpose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the raw data, without orthorectification</span>

<span class="sd">        Args:</span>
<span class="sd">            transpose (bool, optional): Transpose the data if it has 3 dimentsions to (C, H, W) </span>
<span class="sd">                Defaults to True. if False return (H, W, C)</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array: raw data (C, H, W) or (H, W)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;radiance&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;radiance&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">])</span>

        <span class="c1"># transpose to (C, H, W)</span>
        <span class="k">if</span> <span class="n">transpose</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">data</span>


    <span class="k">def</span> <span class="nf">georreference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> 
                      <span class="n">fill_value_default</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Georreference an image in sensor coordinates to coordinates of the current </span>
<span class="sd">        georreferenced object. If you do some processing with the raw data, you can </span>
<span class="sd">        georreference the raw output with this function.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (np.array): raw data (C, H, W) or (H, W). </span>

<span class="sd">        Returns:</span>
<span class="sd">            GeoTensor: georreferenced version of data (C, H&#39;, W&#39;) or (H&#39;, W&#39;)</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; emit_image = EMITImage(&quot;path/to/emit_image.nc&quot;)</span>
<span class="sd">            &gt;&gt;&gt; emit_image_rgb = emit_image.read_from_bands([35, 23, 11])</span>
<span class="sd">            &gt;&gt;&gt; data_rgb = emit_image_rgb.load_raw() # (3, H, W)</span>
<span class="sd">            &gt;&gt;&gt; data_rgb_ortho = emit_image.georreference(data_rgb) # (3, H&#39;, W&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">georreference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glt_relative</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_glt</span><span class="p">,</span> 
                             <span class="n">fill_value_default</span><span class="o">=</span><span class="n">fill_value_default</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="c1"># return np.zeros(self.shape, dtype=self.dtype)</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">boundless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; </span>
<span class="s2">         File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span>
<span class="s2">         Transform: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="si">}</span>
<span class="s2">         Shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span>
<span class="s2">         Resolution: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="si">}</span>
<span class="s2">         Bounds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="si">}</span>
<span class="s2">         CRS: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="si">}</span>
<span class="s2">         units: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="georeader.readers.emit.EMITImage.mask_bands" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_bands</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#georeader.readers.emit.EMITImage.mask_bands" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the mask bands -&gt; ['Cloud flag', 'Cirrus flag', 'Water flag', 'Spacecraft Flag',
'Dilated Cloud Flag', 'AOD550', 'H2O (g cm-2)', 'Aggregate Flag']</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="georeader.readers.emit.EMITImage.mean_sza" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mean_sza</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#georeader.readers.emit.EMITImage.mean_sza" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the mean solar zenith angle</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="georeader.readers.emit.EMITImage.mean_vza" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mean_vza</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#georeader.readers.emit.EMITImage.mean_vza" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the mean view zenith angle</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="georeader.readers.emit.EMITImage.nc_ds_l2amask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nc_ds_l2amask</span><span class="p">:</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#georeader.readers.emit.EMITImage.nc_ds_l2amask" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Loads the L2A mask file. In this file we have information about the cloud mask.</p>
<p>This function downloads the L2A mask file if it does not exist from the JPL portal.</p>
<p>It caches the L2A mask file in the object. (self.nc_ds_l2amask)</p>
<p>See https://lpdaac.usgs.gov/products/emitl2arflv001/ for info about the L2A mask file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>l2amaskfile</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the L2A mask file. 
Defaults to None. If none it will download the L2A mask file 
from the EMIT server.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="georeader.readers.emit.EMITImage.nc_ds_obs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nc_ds_obs</span><span class="p">:</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#georeader.readers.emit.EMITImage.nc_ds_obs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Loads the observation file. In this file we have information about angles (solar and viewing),
elevation and ilumination based on elevation and path length.</p>
<p>This function downloads the observation file if it does not exist from the JPL portal.</p>
<p>It caches the observation file in the object. (self.nc_ds_obs)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obs_file</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the observation file. 
Defaults to None. If none it will download the observation file 
from the EMIT server.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="georeader.readers.emit.EMITImage.observation_bands" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">observation_bands</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#georeader.readers.emit.EMITImage.observation_bands" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the observation bands</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="georeader.readers.emit.EMITImage.percentage_clear" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">percentage_clear</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#georeader.readers.emit.EMITImage.percentage_clear" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the percentage of clear pixels in the image</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>percentage of clear pixels</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="georeader.readers.emit.EMITImage.shape_raw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shape_raw</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#georeader.readers.emit.EMITImage.shape_raw" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the shape of the raw data in (C, H, W) format</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.footprint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">footprint</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.footprint" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the footprint of the image in the given CRS. If no CRS is given, the footprint is returned in the native CRS.
This function takes into account the valid_glt mask to compute the footprint.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>crs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The CRS to return the footprint in. Defaults to None. 
If None, the footprint is returned in the native CRS.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Polygon</code></td>            <td>
                  <code><span title="shapely.geometry.Polygon">Polygon</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The footprint of the image in the given CRS.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Polygon</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the footprint of the image in the given CRS. If no CRS is given, the footprint is returned in the native CRS.</span>
<span class="sd">    This function takes into account the valid_glt mask to compute the footprint.</span>

<span class="sd">    Args:</span>
<span class="sd">        crs (Optional[str], optional): The CRS to return the footprint in. Defaults to None. </span>
<span class="sd">            If None, the footprint is returned in the native CRS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Polygon: The footprint of the image in the given CRS.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_pol&#39;</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">georeader.vectorize</span> <span class="kn">import</span> <span class="n">get_polygons</span>
        <span class="n">pols</span> <span class="o">=</span> <span class="n">get_polygons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_glt</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">pols</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pol_crs</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pol_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pol</span>

    <span class="n">pol_glt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pol_crs</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">pol_glt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.georreference" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">georreference</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fill_value_default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.georreference" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Georreference an image in sensor coordinates to coordinates of the current 
georreferenced object. If you do some processing with the raw data, you can 
georreference the raw output with this function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>raw data (C, H, W) or (H, W). </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>GeoTensor</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>georreferenced version of data (C, H', W') or (H', W')</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>emit_image = EMITImage("path/to/emit_image.nc")
emit_image_rgb = emit_image.read_from_bands([35, 23, 11])
data_rgb = emit_image_rgb.load_raw() # (3, H, W)
data_rgb_ortho = emit_image.georreference(data_rgb) # (3, H', W')</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">georreference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> 
                  <span class="n">fill_value_default</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Georreference an image in sensor coordinates to coordinates of the current </span>
<span class="sd">    georreferenced object. If you do some processing with the raw data, you can </span>
<span class="sd">    georreference the raw output with this function.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (np.array): raw data (C, H, W) or (H, W). </span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoTensor: georreferenced version of data (C, H&#39;, W&#39;) or (H&#39;, W&#39;)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; emit_image = EMITImage(&quot;path/to/emit_image.nc&quot;)</span>
<span class="sd">        &gt;&gt;&gt; emit_image_rgb = emit_image.read_from_bands([35, 23, 11])</span>
<span class="sd">        &gt;&gt;&gt; data_rgb = emit_image_rgb.load_raw() # (3, H, W)</span>
<span class="sd">        &gt;&gt;&gt; data_rgb_ortho = emit_image.georreference(data_rgb) # (3, H&#39;, W&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">georreference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glt_relative</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_glt</span><span class="p">,</span> 
                         <span class="n">fill_value_default</span><span class="o">=</span><span class="n">fill_value_default</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.invalid_mask_raw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">invalid_mask_raw</span><span class="p">(</span><span class="n">with_buffer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.invalid_mask_raw" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the non georreferenced quality mask. True means that the pixel is not valid.</p>
<p>This mask is computed as the sum of the Cloud flag, Cirrus flag, Spacecraft flag and Dilated Cloud Flag.
True means that the pixel is not valid.</p>
<p>From: https://github.com/nasa/EMIT-Data-Resources/blob/main/python/how-tos/How_to_use_EMIT_Quality_data.ipynb
and https://github.com/nasa/EMIT-Data-Resources/blob/main/python/modules/emit_tools.py#L277</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">invalid_mask_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_buffer</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the non georreferenced quality mask. True means that the pixel is not valid.</span>

<span class="sd">    This mask is computed as the sum of the Cloud flag, Cirrus flag, Spacecraft flag and Dilated Cloud Flag.</span>
<span class="sd">    True means that the pixel is not valid.</span>

<span class="sd">    From: https://github.com/nasa/EMIT-Data-Resources/blob/main/python/how-tos/How_to_use_EMIT_Quality_data.ipynb</span>
<span class="sd">    and https://github.com/nasa/EMIT-Data-Resources/blob/main/python/modules/emit_tools.py#L277</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">band_index</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">with_buffer</span><span class="p">:</span>
        <span class="n">band_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
    <span class="n">mask_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_l2amask</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">,</span> <span class="n">band_index</span><span class="p">]</span>
    <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mask_arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask_arr</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask_arr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.load_raw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_raw</span><span class="p">(</span><span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.load_raw" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load the raw data, without orthorectification</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>transpose</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transpose the data if it has 3 dimentsions to (C, H, W) 
Defaults to True. if False return (H, W, C)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.array: raw data (C, H, W) or (H, W)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transpose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the raw data, without orthorectification</span>

<span class="sd">    Args:</span>
<span class="sd">        transpose (bool, optional): Transpose the data if it has 3 dimentsions to (C, H, W) </span>
<span class="sd">            Defaults to True. if False return (H, W, C)</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.array: raw data (C, H, W) or (H, W)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;radiance&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;radiance&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">])</span>

    <span class="c1"># transpose to (C, H, W)</span>
    <span class="k">if</span> <span class="n">transpose</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask</span><span class="p">(</span><span class="n">mask_name</span><span class="o">=</span><span class="s1">&#39;cloud_mask&#39;</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.mask" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the mask layer with the given name.
 Mask shall be one of self.mask_bands -&gt; ['Cloud flag', 'Cirrus flag', 'Water flag', 'Spacecraft Flag',
'Dilated Cloud Flag', 'AOD550', 'H2O (g cm-2)', 'Aggregate Flag']</p>
<p>Args:
     mask_name (str, optional): Name of the mask. Defaults to "cloud_mask".</p>
<p>Returns:
     GeoTensor: mask</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;cloud_mask&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the mask layer with the given name.</span>
<span class="sd">    Mask shall be one of self.mask_bands -&gt; [&#39;Cloud flag&#39;, &#39;Cirrus flag&#39;, &#39;Water flag&#39;, &#39;Spacecraft Flag&#39;,</span>
<span class="sd">   &#39;Dilated Cloud Flag&#39;, &#39;AOD550&#39;, &#39;H2O (g cm-2)&#39;, &#39;Aggregate Flag&#39;]</span>

<span class="sd">    Args:</span>
<span class="sd">        mask_name (str, optional): Name of the mask. Defaults to &quot;cloud_mask&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoTensor: mask</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">band_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_bands</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mask_name</span><span class="p">)</span>
    <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
    <span class="n">mask_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_l2amask</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">,</span> <span class="n">band_index</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">georreference</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span>
                              <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_l2amask</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.observation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">observation</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.observation" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the observation with the given name</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns the observation with the given name &quot;&quot;&quot;</span>
    <span class="n">band_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_bands</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_raw</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
    <span class="n">obs_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">][</span><span class="n">slice_y</span><span class="p">,</span> <span class="n">slice_x</span><span class="p">,</span> <span class="n">band_index</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">georreference</span><span class="p">(</span><span class="n">obs_arr</span><span class="p">,</span> 
                              <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_ds_obs</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.set_band_selection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_band_selection</span><span class="p">(</span><span class="n">band_selection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.set_band_selection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Set the band selection. Band selection is absolute w.r.t self.nc_ds['radiance']</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>band_selection</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[int, <span title="typing.Tuple">Tuple</span>[int, ...], slice]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>slicing or selection of the bands. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>emit_image.set_band_selection(slice(0, 3)) # will only load the three first bands
emit_image.wavelengths # will only return the wavelengths of the three first bands
emit_image.load() # will only load the three first bands</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_band_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">band_selection</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span><span class="nb">slice</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the band selection. Band selection is absolute w.r.t self.nc_ds[&#39;radiance&#39;]</span>

<span class="sd">    Args:</span>
<span class="sd">        band_selection (Optional[Union[int, Tuple[int, ...],slice]], optional): slicing or selection of the bands. Defaults to None.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; emit_image.set_band_selection(slice(0, 3)) # will only load the three first bands</span>
<span class="sd">        &gt;&gt;&gt; emit_image.wavelengths # will only return the wavelengths of the three first bands</span>
<span class="sd">        &gt;&gt;&gt; emit_image.load() # will only load the three first bands</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">band_selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">band_selection</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span> <span class="o">=</span> <span class="n">band_selection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">bandname_dimension</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;sensor_band_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;fwhm&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.sza" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sza</span><span class="p">()</span></code>

<a href="#georeader.readers.emit.EMITImage.sza" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the solar zenith angle as a GeoTensor</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sza</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return the solar zenith angle as a GeoTensor &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation</span><span class="p">(</span><span class="s1">&#39;To-sun zenith (0 to 90 degrees from zenith)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.to_crs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="s1">&#39;UTM&#39;</span><span class="p">,</span> <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.to_crs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reproject the image to a new crs</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>crs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CRS. </p>
              </div>
            </td>
            <td>
                  <code>&#39;UTM&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>EmitImage</code></td>            <td>
                  <code>__class__</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>EMIT image in the new CRS</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>emit_image = EMITImage("path/to/emit_image.nc")
emit_image_utm = emit_image.to_crs(crs="UTM")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span><span class="n">Any</span><span class="o">=</span><span class="s2">&quot;UTM&quot;</span><span class="p">,</span> 
           <span class="n">resolution_dst_crs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;__class__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reproject the image to a new crs</span>

<span class="sd">    Args:</span>
<span class="sd">        crs (Any): CRS. </span>

<span class="sd">    Returns:</span>
<span class="sd">        EmitImage: EMIT image in the new CRS</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; emit_image = EMITImage(&quot;path/to/emit_image.nc&quot;)</span>
<span class="sd">        &gt;&gt;&gt; emit_image_utm = emit_image.to_crs(crs=&quot;UTM&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">crs</span> <span class="o">==</span> <span class="s2">&quot;UTM&quot;</span><span class="p">:</span>
        <span class="n">footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
        <span class="n">crs</span> <span class="o">=</span> <span class="n">get_utm_epsg</span><span class="p">(</span><span class="n">footprint</span><span class="p">)</span>

    <span class="n">glt</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">read_to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glt</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">resampling</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">nearest</span><span class="p">,</span> 
                           <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="n">resolution_dst_crs</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">EMITImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">glt</span><span class="o">=</span><span class="n">glt</span><span class="p">,</span> <span class="n">band_selection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">band_selection</span><span class="p">)</span>
    <span class="c1"># Copy _pol attribute if it exists</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_pol&#39;</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;_pol&#39;</span><span class="p">,</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.validmask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validmask</span><span class="p">(</span><span class="n">with_buffer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.EMITImage.validmask" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the validmask mask</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>GeoTensor</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool mask. True means that the pixel is valid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validmask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_buffer</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the validmask mask</span>


<span class="sd">    Returns:</span>
<span class="sd">        GeoTensor: bool mask. True means that the pixel is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">validmask</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">invalid_mask_raw</span><span class="p">(</span><span class="n">with_buffer</span><span class="o">=</span><span class="n">with_buffer</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">georreference</span><span class="p">(</span><span class="n">validmask</span><span class="p">,</span>
                              <span class="n">fill_value_default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.vza" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vza</span><span class="p">()</span></code>

<a href="#georeader.readers.emit.EMITImage.vza" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the view zenith angle as a GeoTensor</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">vza</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return the view zenith angle as a GeoTensor &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation</span><span class="p">(</span><span class="s1">&#39;To-sensor zenith (0 to 90 degrees from zenith)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.emit.EMITImage.water_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">water_mask</span><span class="p">()</span></code>

<a href="#georeader.readers.emit.EMITImage.water_mask" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the water mask</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">water_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns the water mask &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="s2">&quot;Water flag&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="georeader.readers.emit.download_product" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_product</span><span class="p">(</span><span class="n">link_down</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.download_product" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Download a product from the EMIT website (https://search.earthdata.nasa.gov/search). 
It requires that you have an account in the NASA Earthdata portal. </p>
<p>This code is based on this example: https://git.earthdata.nasa.gov/projects/LPDUR/repos/daac_data_download_python/browse</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_down</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>link to the product</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filename to save the product</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_progress_bar</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>display tqdm progress bar</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>auth</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple with user and password to download the product. If None, it will try to read the user and password from ~/.georeader/auth_emit.json </p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>link_down = 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/EMIT_L1B_RAD_001_20220828T051941_2224004_006/EMIT_L1B_RAD_001_20220828T051941_2224004_006.nc'
filename = download_product(link_down)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_product</span><span class="p">(</span><span class="n">link_down</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">display_progress_bar</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">auth</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a product from the EMIT website (https://search.earthdata.nasa.gov/search). </span>
<span class="sd">    It requires that you have an account in the NASA Earthdata portal. </span>

<span class="sd">    This code is based on this example: https://git.earthdata.nasa.gov/projects/LPDUR/repos/daac_data_download_python/browse</span>

<span class="sd">    Args:</span>
<span class="sd">        link_down: link to the product</span>
<span class="sd">        filename: filename to save the product</span>
<span class="sd">        display_progress_bar: display tqdm progress bar</span>
<span class="sd">        auth: tuple with user and password to download the product. If None, it will try to read the user and password from ~/.georeader/auth_emit.json </span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; link_down = &#39;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/EMIT_L1B_RAD_001_20220828T051941_2224004_006/EMIT_L1B_RAD_001_20220828T051941_2224004_006.nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; filename = download_product(link_down)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">auth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">AUTH_METHOD</span> <span class="o">==</span> <span class="s2">&quot;auth&quot;</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="n">get_auth</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">AUTH_METHOD</span> <span class="o">==</span> <span class="s2">&quot;token&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">TOKEN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;You need to set the TOKEN variable to download EMIT images&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">get_headers</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">download_product_base</span><span class="p">(</span><span class="n">link_down</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
                                 <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                 <span class="n">display_progress_bar</span><span class="o">=</span><span class="n">display_progress_bar</span><span class="p">,</span> 
                                 <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="georeader.readers.emit.get_radiance_link" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_radiance_link</span><span class="p">(</span><span class="n">product_path</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.get_radiance_link" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get the link to download a product from the EMIT website.
See: https://git.earthdata.nasa.gov/projects/LPDUR/repos/daac_data_download_python/browse</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>product_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the product or filename of the product or product name with or without extension.
e.g. 'EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>product_path = 'EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'
link = get_radiance_link(product_path)
'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/EMIT_L1B_RAD_001_20220827T060753_2223904_013/EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_radiance_link</span><span class="p">(</span><span class="n">product_path</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the link to download a product from the EMIT website.</span>
<span class="sd">    See: https://git.earthdata.nasa.gov/projects/LPDUR/repos/daac_data_download_python/browse</span>

<span class="sd">    Args:</span>
<span class="sd">        product_path: path to the product or filename of the product or product name with or without extension.</span>
<span class="sd">            e.g. &#39;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; product_path = &#39;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; link = get_radiance_link(product_path)</span>
<span class="sd">        &#39;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/EMIT_L1B_RAD_001_20220827T060753_2223904_013/EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="s2">&quot;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&quot;</span>
    <span class="n">namefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">product_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">product_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">namefile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">content_id</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;L1B&quot;</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RAD&quot;</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_id</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">product_id</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_id</span><span class="p">)</span>
    <span class="n">link</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/</span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s2">.nc&quot;</span>
    <span class="k">return</span> <span class="n">link</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="georeader.readers.emit.get_obs_link" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_obs_link</span><span class="p">(</span><span class="n">product_path</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.get_obs_link" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get the link to download a product from the EMIT website.
See: https://git.earthdata.nasa.gov/projects/LPDUR/repos/daac_data_download_python/browse</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>product_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the product or filename of the product with or without extension.
e.g. 'EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>product_path = 'EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'
link = get_radiance_link(product_path)
'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/EMIT_L1B_RAD_001_20220827T060753_2223904_013/EMIT_L1B_OBS_001_20220827T060753_2223904_013.nc'</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_obs_link</span><span class="p">(</span><span class="n">product_path</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the link to download a product from the EMIT website.</span>
<span class="sd">    See: https://git.earthdata.nasa.gov/projects/LPDUR/repos/daac_data_download_python/browse</span>

<span class="sd">    Args:</span>
<span class="sd">        product_path: path to the product or filename of the product with or without extension.</span>
<span class="sd">            e.g. &#39;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; product_path = &#39;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; link = get_radiance_link(product_path)</span>
<span class="sd">        &#39;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/EMIT_L1B_RAD_001_20220827T060753_2223904_013/EMIT_L1B_OBS_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">namefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">product_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">product_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">namefile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">content_id</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;L1B&quot;</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RAD&quot;</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_id</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">product_id</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_id</span><span class="p">)</span>

    <span class="n">content_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OBS&quot;</span>
    <span class="n">namefile</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_id</span><span class="p">)</span>

    <span class="n">link</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL1BRAD.001/</span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">namefile</span><span class="si">}</span><span class="s2">.nc&quot;</span>
    <span class="k">return</span> <span class="n">link</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="georeader.readers.emit.get_ch4enhancement_link" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ch4enhancement_link</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.get_ch4enhancement_link" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get the link to download a product from the EMIT website.
See: https://git.earthdata.nasa.gov/projects/LPDUR/repos/daac_data_download_python/browse</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>product_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the product or filename of the product with or without extension.
e.g. 'EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>product_path = 'EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'
link = get_radiance_link(product_path)
'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2BCH4ENH.001/EMIT_L2B_CH4ENH_001_20220810T064957_2222205_033/EMIT_L2B_CH4ENH_001_20220810T064957_2222205_033.tif'</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_ch4enhancement_link</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the link to download a product from the EMIT website.</span>
<span class="sd">    See: https://git.earthdata.nasa.gov/projects/LPDUR/repos/daac_data_download_python/browse</span>

<span class="sd">    Args:</span>
<span class="sd">        product_path: path to the product or filename of the product with or without extension.</span>
<span class="sd">            e.g. &#39;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; product_path = &#39;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; link = get_radiance_link(product_path)</span>
<span class="sd">        &#39;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2BCH4ENH.001/EMIT_L2B_CH4ENH_001_20220810T064957_2222205_033/EMIT_L2B_CH4ENH_001_20220810T064957_2222205_033.tif&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">namefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tile</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">product_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">namefile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">content_id</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;L2B&quot;</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CH4ENH&quot;</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_id</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">product_id</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_id</span><span class="p">)</span>
    <span class="n">link</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2BCH4ENH.001/</span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s2">.tif&quot;</span>
    <span class="k">return</span> <span class="n">link</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="georeader.readers.emit.get_l2amask_link" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_l2amask_link</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.get_l2amask_link" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get the link to download a product from the EMIT website (https://search.earthdata.nasa.gov/search)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tile</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the product or filename of the L1B product with or without extension.
e.g. 'EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>link to the L2A mask product</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>tile = 'EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc'
link = get_l2amask_link(tile)
'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2ARFL.001/EMIT_L2A_RFL_001_20220827T060753_2223904_013/EMIT_L2A_MASK_001_20220827T060753_2223904_013.nc'</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_l2amask_link</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the link to download a product from the EMIT website (https://search.earthdata.nasa.gov/search)</span>

<span class="sd">    Args:</span>
<span class="sd">        tile (str): path to the product or filename of the L1B product with or without extension.</span>
<span class="sd">            e.g. &#39;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: link to the L2A mask product</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; tile = &#39;EMIT_L1B_RAD_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; link = get_l2amask_link(tile)</span>
<span class="sd">        &#39;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2ARFL.001/EMIT_L2A_RFL_001_20220827T060753_2223904_013/EMIT_L2A_MASK_001_20220827T060753_2223904_013.nc&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">namefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tile</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">namefile</span> <span class="o">=</span> <span class="n">namefile</span> <span class="o">+</span> <span class="s2">&quot;.nc&quot;</span>

    <span class="n">product_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">namefile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">content_id</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;L2A&quot;</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RFL&quot;</span>
    <span class="n">content_id</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_id</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">product_id</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_id</span><span class="p">)</span>

    <span class="n">content_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MASK&quot;</span>
    <span class="n">namefilenew</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.nc&quot;</span>
    <span class="n">link</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2ARFL.001/</span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">namefilenew</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">link</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="georeader.readers.emit.valid_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">valid_mask</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">with_buffer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="s1">&#39;UTM&#39;</span><span class="p">,</span> <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></code>

<a href="#georeader.readers.emit.valid_mask" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Loads the valid mask from the EMIT L2AMASK file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the L2AMASK file. e.g. EMIT_L2A_MASK_001_20220827T060753_2223904_013.nc</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_buffer</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the buffer band is used to compute the valid mask. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>GeoTensor</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a>, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>valid mask</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/emit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">valid_mask</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">with_buffer</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
               <span class="n">dst_crs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;UTM&quot;</span><span class="p">,</span> 
               <span class="n">resolution_dst_crs</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">GeoTensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads the valid mask from the EMIT L2AMASK file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): path to the L2AMASK file. e.g. EMIT_L2A_MASK_001_20220827T060753_2223904_013.nc</span>
<span class="sd">        with_buffer (bool, optional): If True, the buffer band is used to compute the valid mask. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoTensor: valid mask</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nc_ds</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
    <span class="n">nc_ds</span><span class="o">.</span><span class="n">set_auto_mask</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">real_transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">nc_ds</span><span class="o">.</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">glt_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,)</span> <span class="o">+</span> <span class="n">nc_ds</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;glt_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">glt_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;glt_x&#39;</span><span class="p">])</span>
    <span class="n">glt_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;glt_y&#39;</span><span class="p">])</span>
    <span class="c1"># glt_arr -= 1 # account for 1-based indexing</span>

    <span class="c1"># https://rasterio.readthedocs.io/en/stable/api/rasterio.crs.html</span>
    <span class="n">glt</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">glt_arr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">real_transform</span><span class="p">,</span> 
                    <span class="n">crs</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_wkt</span><span class="p">(</span><span class="n">nc_ds</span><span class="o">.</span><span class="n">spatial_ref</span><span class="p">),</span>
                    <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dst_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dst_crs</span> <span class="o">==</span> <span class="s2">&quot;UTM&quot;</span><span class="p">:</span>
            <span class="n">footprint</span> <span class="o">=</span> <span class="n">glt</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
            <span class="n">dst_crs</span> <span class="o">=</span> <span class="n">get_utm_epsg</span><span class="p">(</span><span class="n">footprint</span><span class="p">)</span>

        <span class="n">glt</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">read_to_crs</span><span class="p">(</span><span class="n">glt</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span> 
                               <span class="n">resampling</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">nearest</span><span class="p">,</span> 
                               <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="n">resolution_dst_crs</span><span class="p">)</span>

    <span class="n">valid_glt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">glt</span><span class="o">.</span><span class="n">values</span> <span class="o">!=</span> <span class="n">glt</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">glt</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">valid_glt</span><span class="p">])</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">glt</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">valid_glt</span><span class="p">])</span>

    <span class="n">glt_relative</span> <span class="o">=</span> <span class="n">glt</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">glt_relative</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">valid_glt</span><span class="p">]</span> <span class="o">-=</span> <span class="n">xmin</span>
    <span class="n">glt_relative</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">valid_glt</span><span class="p">]</span> <span class="o">-=</span> <span class="n">ymin</span>
    <span class="c1"># mask_bands = nc_ds[&quot;sensor_band_parameters&quot;][&quot;mask_bands&quot;][:]</span>

    <span class="n">band_index</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">with_buffer</span><span class="p">:</span>
        <span class="n">band_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">mask_arr</span> <span class="o">=</span> <span class="n">nc_ds</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">band_index</span><span class="p">]</span>
    <span class="n">invalidmask_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">invalidmask_raw</span> <span class="o">=</span> <span class="p">(</span><span class="n">invalidmask_raw</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">validmask</span> <span class="o">=</span> <span class="o">~</span><span class="n">invalidmask_raw</span>

    <span class="n">percentage_clear</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">validmask</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">validmask</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">georreference</span><span class="p">(</span><span class="n">glt_relative</span><span class="p">,</span> <span class="n">validmask</span><span class="p">,</span> <span class="n">valid_glt</span><span class="p">,</span>
                         <span class="n">fill_value_default</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">percentage_clear</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="enmap-reader">EnMAP Reader<a class="headerlink" href="#enmap-reader" title="Permanent link">&para;</a></h2>
<p>The EnMAP (Environmental Mapping and Analysis Program) reader processes data from the German hyperspectral satellite mission. This reader works with Level 1B radiometrically calibrated data (not atmospherically corrected) that contains radiance values in physical units.</p>
<p>Key features:</p>
<ul>
<li>Reading L1B hyperspectral radiance data from GeoTIFF format with accompanying XML metadata</li>
<li>Working with separate VNIR (420-1000 nm) and SWIR (900-2450 nm) spectral ranges</li>
<li>Support for 228 spectral channels with 6.5 nm (VNIR) and 10 nm (SWIR) sampling</li>
<li>Integration with Rational Polynomial Coefficients (RPCs) for accurate geometric correction</li>
<li>Conversion from radiance (mW/m²/sr/nm) to top-of-atmosphere reflectance</li>
<li>Access to solar illumination and viewing geometry for radiometric calculations</li>
<li>Support for quality masks</li>
</ul>
<p><strong>Tutorial example:</strong></p>
<ul>
<li><a href="../../enmap_with_cloudsen12/">Working with EnMAP and CloudSEN12</a></li>
</ul>
<h3 id="api-reference_5">API Reference<a class="headerlink" href="#api-reference_5" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="georeader.readers.enmap"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="georeader.readers.enmap.EnMAP" class="doc doc-heading">
            <code>EnMAP</code>


<a href="#georeader.readers.enmap.EnMAP" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>EnMAP (Environmental Mapping and Analysis Program) image reader.</p>
<p>This class provides functionality to read and manipulate EnMAP satellite imagery products.
It handles the specific format and metadata of EnMAP files, supporting operations
like loading specific wavelengths, RGB composites, and converting to reflectance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xml_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the EnMAP XML metadata file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>by_folder</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, files are organized by folder structure.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_focus</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="rasterio.windows.Window">Window</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Window to focus on a specific
region of the image. Defaults to None (entire image).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="fsspec.AbstractFileSystem">AbstractFileSystem</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filesystem to use for file access.
Defaults to None (local filesystem).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.xml_file">xml_file</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the XML metadata file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.by_folder">by_folder</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether files are organized by folder structure.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.swir_file">swir_file</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the SWIR image file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.fs">fs</span></code></td>
            <td>
                  <code><span title="fsspec.AbstractFileSystem">AbstractFileSystem</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filesystem used for file access.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.swir">swir</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.rasterio_reader.RasterioReader" href="../rasterio_reader/#georeader.rasterio_reader.RasterioReader">RasterioReader</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reader for SWIR image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.vnir">vnir</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="georeader.rasterio_reader.RasterioReader" href="../rasterio_reader/#georeader.rasterio_reader.RasterioReader">RasterioReader</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reader for VNIR image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.wl_center">wl_center</span></code></td>
            <td>
                  <code>Dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of center wavelengths for each band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.wl_fwhm">wl_fwhm</span></code></td>
            <td>
                  <code>Dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of FWHM (Full Width at Half Maximum) for each band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.hsf">hsf</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean ground elevation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.sza">sza</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Solar zenith angle.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.saa">saa</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Solar azimuth angle.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.vaa">vaa</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Viewing azimuth angle.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.vza">vza</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Viewing zenith angle.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.gain_arr">gain_arr</span></code></td>
            <td>
                  <code>Dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of gain values for each band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.offs_arr">offs_arr</span></code></td>
            <td>
                  <code>Dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of offset values for each band.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.rpcs_vnir">rpcs_vnir</span></code></td>
            <td>
                  <code>Dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rational Polynomial Coefficients for VNIR.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.rpcs_swir">rpcs_swir</span></code></td>
            <td>
                  <code>Dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rational Polynomial Coefficients for SWIR.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.swir_range">swir_range</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wavelength range of SWIR bands.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.vnir_range">vnir_range</span></code></td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[float, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wavelength range of VNIR bands.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.units">units</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Units of radiance data (mW/m2/sr/nm).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.time_coverage_start">time_coverage_start</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time of acquisition.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="georeader.readers.enmap.EnMAP.time_coverage_end">time_coverage_end</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time of acquisition.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize the EnMAP reader with a data path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">enmap</span> <span class="o">=</span> <span class="n">EnMAP</span><span class="p">(</span><span class="s1">&#39;/path/to/enmap_metadata.xml&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load RGB bands as reflectance with RPCs applied</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rgb</span> <span class="o">=</span> <span class="n">enmap</span><span class="o">.</span><span class="n">load_rgb</span><span class="p">(</span><span class="n">as_reflectance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">apply_rpcs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load specific wavelengths</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bands</span> <span class="o">=</span> <span class="n">enmap</span><span class="o">.</span><span class="n">load_wavelengths</span><span class="p">([</span><span class="mi">850</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">2200</span><span class="p">],</span> <span class="n">as_reflectance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load cloud mask or other quality products</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clouds</span> <span class="o">=</span> <span class="n">enmap</span><span class="o">.</span><span class="n">load_product</span><span class="p">(</span><span class="s1">&#39;QL_QUALITY_CLOUD&#39;</span><span class="p">)</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>georeader/readers/enmap.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EnMAP</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EnMAP (Environmental Mapping and Analysis Program) image reader.</span>

<span class="sd">    This class provides functionality to read and manipulate EnMAP satellite imagery products.</span>
<span class="sd">    It handles the specific format and metadata of EnMAP files, supporting operations</span>
<span class="sd">    like loading specific wavelengths, RGB composites, and converting to reflectance.</span>

<span class="sd">    Args:</span>
<span class="sd">        xml_file (str): Path to the EnMAP XML metadata file.</span>
<span class="sd">        by_folder (bool): If True, files are organized by folder structure.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        window_focus (Optional[Window]): Window to focus on a specific</span>
<span class="sd">            region of the image. Defaults to None (entire image).</span>
<span class="sd">        fs (Optional[fsspec.AbstractFileSystem]): Filesystem to use for file access.</span>
<span class="sd">            Defaults to None (local filesystem).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        xml_file (str): Path to the XML metadata file.</span>
<span class="sd">        by_folder (bool): Whether files are organized by folder structure.</span>
<span class="sd">        swir_file (str): Path to the SWIR image file.</span>
<span class="sd">        fs (fsspec.AbstractFileSystem): Filesystem used for file access.</span>
<span class="sd">        swir (RasterioReader): Reader for SWIR image.</span>
<span class="sd">        vnir (RasterioReader): Reader for VNIR image.</span>
<span class="sd">        wl_center (Dict): Dictionary of center wavelengths for each band.</span>
<span class="sd">        wl_fwhm (Dict): Dictionary of FWHM (Full Width at Half Maximum) for each band.</span>
<span class="sd">        hsf (float): Mean ground elevation.</span>
<span class="sd">        sza (float): Solar zenith angle.</span>
<span class="sd">        saa (float): Solar azimuth angle.</span>
<span class="sd">        vaa (float): Viewing azimuth angle.</span>
<span class="sd">        vza (float): Viewing zenith angle.</span>
<span class="sd">        gain_arr (Dict): Dictionary of gain values for each band.</span>
<span class="sd">        offs_arr (Dict): Dictionary of offset values for each band.</span>
<span class="sd">        rpcs_vnir: Rational Polynomial Coefficients for VNIR.</span>
<span class="sd">        rpcs_swir: Rational Polynomial Coefficients for SWIR.</span>
<span class="sd">        swir_range (Tuple[float, float]): Wavelength range of SWIR bands.</span>
<span class="sd">        vnir_range (Tuple[float, float]): Wavelength range of VNIR bands.</span>
<span class="sd">        units (str): Units of radiance data (mW/m2/sr/nm).</span>
<span class="sd">        time_coverage_start (datetime): Start time of acquisition.</span>
<span class="sd">        time_coverage_end (datetime): End time of acquisition.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Initialize the EnMAP reader with a data path</span>
<span class="sd">        &gt;&gt;&gt; enmap = EnMAP(&#39;/path/to/enmap_metadata.xml&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # Load RGB bands as reflectance with RPCs applied</span>
<span class="sd">        &gt;&gt;&gt; rgb = enmap.load_rgb(as_reflectance=True, apply_rpcs=True)</span>
<span class="sd">        &gt;&gt;&gt; # Load specific wavelengths</span>
<span class="sd">        &gt;&gt;&gt; bands = enmap.load_wavelengths([850, 1600, 2200], as_reflectance=True)</span>
<span class="sd">        &gt;&gt;&gt; # Load cloud mask or other quality products</span>
<span class="sd">        &gt;&gt;&gt; clouds = enmap.load_product(&#39;QL_QUALITY_CLOUD&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">xml_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">by_folder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">window_focus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Window</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">fsspec</span><span class="o">.</span><span class="n">AbstractFileSystem</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span> <span class="o">=</span> <span class="n">xml_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_folder</span> <span class="o">=</span> <span class="n">by_folder</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.XML&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid SWIR file path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="si">}</span><span class="s2"> must be a XML file&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_folder</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">PRODUCT_FOLDERS</span><span class="p">[</span><span class="s2">&quot;METADATA&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Invalid SWIR file path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="si">}</span><span class="s2"> must contain </span><span class="si">{</span><span class="n">PRODUCT_FOLDERS</span><span class="p">[</span><span class="s1">&#39;METADATA&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> if by folder&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="n">PRODUCT_FOLDERS</span><span class="p">[</span><span class="s2">&quot;METADATA&quot;</span><span class="p">],</span> <span class="n">PRODUCT_FOLDERS</span><span class="p">[</span><span class="s2">&quot;SPECTRAL_IMAGE_SWIR&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.XML&quot;</span><span class="p">,</span> <span class="s2">&quot;.TIF&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;.tif&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="s2">&quot;METADATA&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Invalid SWIR file path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="si">}</span><span class="s2"> must contain METADATA if not by folder&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;METADATA&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECTRAL_IMAGE_SWIR&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.XML&quot;</span><span class="p">,</span> <span class="s2">&quot;.TIF&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;.tif&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.TIF&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid SWIR file path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="si">}</span><span class="s2"> must be a TIF file&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;gs://&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;az://&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">fs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Filesystem must be provided if using cloud storage&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span>
            <span class="k">assert</span> <span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="si">}</span><span class="s2"> does not exist&quot;</span>
            <span class="k">assert</span> <span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="si">}</span><span class="s2"> does not exist&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span> <span class="ow">or</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="si">}</span><span class="s2"> does not exist&quot;</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="si">}</span><span class="s2"> does not exist&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">swir</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="p">,</span> <span class="n">window_focus</span><span class="o">=</span><span class="n">window_focus</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vnir</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="n">PRODUCT_FOLDERS</span><span class="p">[</span><span class="s2">&quot;SPECTRAL_IMAGE_SWIR&quot;</span><span class="p">],</span>
                    <span class="n">PRODUCT_FOLDERS</span><span class="p">[</span><span class="s2">&quot;SPECTRAL_IMAGE_VNIR&quot;</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="n">window_focus</span><span class="o">=</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vnir</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;SPECTRAL_IMAGE_SWIR&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECTRAL_IMAGE_VNIR&quot;</span><span class="p">),</span>
                <span class="n">window_focus</span><span class="o">=</span><span class="n">window_focus</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsf</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sza</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saa</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vaa</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vza</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gain_arr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offs_arr</span><span class="p">,</span>
                <span class="n">startTime</span><span class="p">,</span>
                <span class="n">endTime</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rpcs_vnir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rpcs_swir</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">read_xml</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;mW/m2/sr/nm&quot;</span>  <span class="c1"># == W/m^2/SR/um</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_start</span> <span class="o">=</span> <span class="n">startTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_end</span> <span class="o">=</span> <span class="n">endTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observation_date_correction_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">reflectance</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">(</span>
                    <span class="n">date_of_acquisition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_start</span><span class="p">,</span>
                    <span class="n">center_coords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_date_correction_factor</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">window_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Window</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">window_focus</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">]),</span>
        <span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">transform</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">crs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">res</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">width</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span><span class="o">.</span><span class="n">height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">bounds</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fill_value_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">fill_value_default</span>

    <span class="k">def</span> <span class="nf">footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">product_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PRODUCT_FOLDERS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid product name: </span><span class="si">{</span><span class="n">product_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_folder</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">PRODUCT_FOLDERS</span><span class="p">[</span><span class="n">product_name</span><span class="p">]</span>
            <span class="n">product_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">PRODUCT_FOLDERS</span><span class="p">[</span><span class="s2">&quot;SPECTRAL_IMAGE_SWIR&quot;</span><span class="p">],</span> <span class="n">folder</span>
            <span class="p">)</span>

            <span class="n">raster_product</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span>
                <span class="n">product_path</span><span class="p">,</span> <span class="n">window_focus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span>
            <span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">product_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;SPECTRAL_IMAGE_SWIR&quot;</span><span class="p">,</span> <span class="n">product_name</span><span class="p">)</span>
            <span class="n">raster_product</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span>
                <span class="n">product_path</span><span class="p">,</span> <span class="n">window_focus</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_focus</span>
            <span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="c1"># Convert to radiance if SPECTRAL_IMAGE_SWIR or SPECRTAL_IMAGE_VNIR</span>
        <span class="k">if</span> <span class="n">product_name</span> <span class="o">==</span> <span class="s2">&quot;SPECTRAL_IMAGE_SWIR&quot;</span><span class="p">:</span>
            <span class="n">name_coef</span> <span class="o">=</span> <span class="s2">&quot;swir&quot;</span>
        <span class="k">elif</span> <span class="n">product_name</span> <span class="o">==</span> <span class="s2">&quot;SPECTRAL_IMAGE_VNIR&quot;</span><span class="p">:</span>
            <span class="n">name_coef</span> <span class="o">=</span> <span class="s2">&quot;vnir&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name_coef</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># https://github.com/GFZ/enpt/blob/main/enpt/model/images/images_sensorgeo.py#L327</span>
        <span class="c1"># Lλ = QCAL * GAIN + OFFSET</span>
        <span class="c1"># NOTE: - DLR provides gains between 2000 and 10000, so we have to DEVIDE by gains</span>
        <span class="c1">#       - DLR gains / offsets are provided in W/m2/sr/nm, so we have to multiply by 1000 to get</span>
        <span class="c1">#         mW/m2/sr/nm as needed later</span>
        <span class="k">if</span> <span class="n">name_coef</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_arr</span><span class="p">[</span><span class="n">name_coef</span><span class="p">]</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_arr</span><span class="p">[</span><span class="n">name_coef</span><span class="p">]</span>
            <span class="n">invalids</span> <span class="o">=</span> <span class="n">raster_product</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">raster_product</span><span class="o">.</span><span class="n">fill_value_default</span>
            <span class="n">raster_product</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">gain</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">raster_product</span><span class="o">.</span><span class="n">values</span>
                <span class="o">+</span> <span class="n">offset</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">SC_COEFF</span>
            <span class="n">raster_product</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">invalids</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span>

        <span class="k">return</span> <span class="n">raster_product</span>

    <span class="k">def</span> <span class="nf">load_wavelengths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wavelengths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">],</span>
        <span class="n">as_reflectance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoTensor</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the reflectance of the given wavelengths</span>

<span class="sd">        Args:</span>
<span class="sd">            wavelengths (Union[float, List[float], NDArray]): List of wavelengths to load</span>
<span class="sd">            as_reflectance (bool, optional): return the values as reflectance rather than radiance.</span>
<span class="sd">                Defaults to True. If False values will have units of W/m^2/SR/um == mW/m2/sr/nm (`self.units`)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[GeoTensor, NDArray]: GeoTensor with the values in reflectance or radiance units.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If any wavelength is outside the sensor&#39;s range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wavelengths</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>

        <span class="c1"># Check all wavelengths are within the range of the sensor</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">wvl</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">wvl</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">wvl</span> <span class="ow">in</span> <span class="n">wavelengths</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid wavelength range, must be between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">wavelengths_loaded</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fwhm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">index_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">]))</span>
                <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">])</span>
                <span class="n">wavelengths_loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">])</span>
                <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;band&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">index_band</span><span class="p">]})</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                <span class="n">invalids</span> <span class="o">=</span> <span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">rst</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

                <span class="c1"># Convert to radiance</span>
                <span class="n">gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_arr</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">]</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_arr</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">]</span>
                <span class="n">img</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain</span> <span class="o">*</span> <span class="n">rst</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">SC_COEFF</span>
                <span class="n">img</span><span class="p">[</span><span class="n">invalids</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">]))</span>
                <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">])</span>
                <span class="n">wavelengths_loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">])</span>
                <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnir</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;band&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">index_band</span><span class="p">]})</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                <span class="n">invalids</span> <span class="o">=</span> <span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">rst</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

                <span class="c1"># Convert to radiance</span>
                <span class="n">gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_arr</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">]</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_arr</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">]</span>
                <span class="n">img</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain</span> <span class="o">*</span> <span class="n">rst</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">SC_COEFF</span>
                <span class="n">img</span><span class="p">[</span><span class="n">invalids</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span>

            <span class="n">ltoa_img</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">as_reflectance</span><span class="p">:</span>
            <span class="n">thuiller</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">load_thuillier_irradiance</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">srf</span><span class="p">(</span>
                <span class="n">wavelengths_loaded</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Nanometer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="p">)</span>

            <span class="n">solar_irradiance_norm</span> <span class="o">=</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Radiance(mW/m2/nm)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
                <span class="n">response</span>
            <span class="p">)</span>  <span class="c1"># mW/m$^2$/SR/nm</span>
            <span class="n">solar_irradiance_norm</span> <span class="o">/=</span> <span class="mi">1_000</span>  <span class="c1"># W/m$^2$/nm</span>

            <span class="c1"># Divide by 10 to convert from mW/m^2/SR/nm to µW /cm²/SR/nm</span>
            <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">radiance_to_reflectance</span><span class="p">(</span>
                <span class="n">ltoa_img</span><span class="p">,</span>
                <span class="n">solar_irradiance_norm</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                <span class="n">observation_date_corr_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">ltoa_img</span>

    <span class="k">def</span> <span class="nf">load_rgb</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">as_reflectance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">apply_rpcs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>
        <span class="n">resolution_dst_crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load RGB image from VNIR bands. Converts radiance to TOA reflectance if as_reflectance is True</span>
<span class="sd">        otherwise it will return the radiance values in W/m^2/SR/um == mW/m2/sr/nm (`self.units`)</span>

<span class="sd">        Args:</span>
<span class="sd">            as_reflectance (bool, optional): Convert radiance to TOA reflectance. Defaults to True.</span>
<span class="sd">            apply_rpcs (bool, optional): Apply RPCs to the image. Defaults to True.</span>
<span class="sd">            dst_crs (str, optional): Destination CRS. Defaults to &quot;EPSG:4326&quot;.</span>
<span class="sd">            resolution_dst_crs (Optional[Union[float, Tuple[float, float]]], optional):</span>
<span class="sd">                Resolution of the destination CRS. Defaults to None.</span>
<span class="sd">        Returns:</span>
<span class="sd">            GeoTensor: with the RGB image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wavelengths</span><span class="p">(</span><span class="n">WAVELENGTHS_RGB</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="o">=</span><span class="n">as_reflectance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">apply_rpcs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">read</span><span class="o">.</span><span class="n">read_rpcs</span><span class="p">(</span>
                <span class="n">rgb</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">rpcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rpcs_vnir</span><span class="p">,</span>
                <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span>
                <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="n">resolution_dst_crs</span><span class="p">,</span>
                <span class="n">fill_value_default</span><span class="o">=</span><span class="n">rgb</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">dst_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">read</span><span class="o">.</span><span class="n">read_to_crs</span><span class="p">(</span>
                <span class="n">rgb</span><span class="p">,</span> <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="n">resolution_dst_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">rgb</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
        <span class="n">swir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_product</span><span class="p">(</span><span class="s2">&quot;SPECTRAL_IMAGE_SWIR&quot;</span><span class="p">)</span>
        <span class="c1"># vnir = self.load_product(&#39;SPECTRAL_IMAGE_VNIR&#39;)</span>

        <span class="k">return</span> <span class="n">swir</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_file</span><span class="si">}</span>
<span class="s2">        Bounds: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="si">}</span>
<span class="s2">        Time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_coverage_start</span><span class="si">}</span>
<span class="s2">        Spatial shape (height, width): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="si">}</span>
<span class="s2">        VNIR Range: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="si">}</span><span class="s2"> nbands: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s1">&#39;vnir&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> </span>
<span class="s2">        SWIR Range: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="si">}</span><span class="s2"> nbands: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s1">&#39;swir&#39;</span><span class="p">])</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="georeader.readers.enmap.EnMAP.load_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_rgb</span><span class="p">(</span><span class="n">as_reflectance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">apply_rpcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#georeader.readers.enmap.EnMAP.load_rgb" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load RGB image from VNIR bands. Converts radiance to TOA reflectance if as_reflectance is True
otherwise it will return the radiance values in W/m^2/SR/um == mW/m2/sr/nm (<code>self.units</code>)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>as_reflectance</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Convert radiance to TOA reflectance. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>apply_rpcs</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Apply RPCs to the image. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dst_crs</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Destination CRS. Defaults to "EPSG:4326".</p>
              </div>
            </td>
            <td>
                  <code>&#39;EPSG:4326&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution_dst_crs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[float, <span title="typing.Tuple">Tuple</span>[float, float]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolution of the destination CRS. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    GeoTensor: with the RGB image</p>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/enmap.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_rgb</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">as_reflectance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">apply_rpcs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">dst_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>
    <span class="n">resolution_dst_crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoTensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load RGB image from VNIR bands. Converts radiance to TOA reflectance if as_reflectance is True</span>
<span class="sd">    otherwise it will return the radiance values in W/m^2/SR/um == mW/m2/sr/nm (`self.units`)</span>

<span class="sd">    Args:</span>
<span class="sd">        as_reflectance (bool, optional): Convert radiance to TOA reflectance. Defaults to True.</span>
<span class="sd">        apply_rpcs (bool, optional): Apply RPCs to the image. Defaults to True.</span>
<span class="sd">        dst_crs (str, optional): Destination CRS. Defaults to &quot;EPSG:4326&quot;.</span>
<span class="sd">        resolution_dst_crs (Optional[Union[float, Tuple[float, float]]], optional):</span>
<span class="sd">            Resolution of the destination CRS. Defaults to None.</span>
<span class="sd">    Returns:</span>
<span class="sd">        GeoTensor: with the RGB image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_wavelengths</span><span class="p">(</span><span class="n">WAVELENGTHS_RGB</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="o">=</span><span class="n">as_reflectance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">apply_rpcs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">read</span><span class="o">.</span><span class="n">read_rpcs</span><span class="p">(</span>
            <span class="n">rgb</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">rpcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rpcs_vnir</span><span class="p">,</span>
            <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span>
            <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="n">resolution_dst_crs</span><span class="p">,</span>
            <span class="n">fill_value_default</span><span class="o">=</span><span class="n">rgb</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">dst_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">read</span><span class="o">.</span><span class="n">read_to_crs</span><span class="p">(</span>
            <span class="n">rgb</span><span class="p">,</span> <span class="n">resolution_dst_crs</span><span class="o">=</span><span class="n">resolution_dst_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">rgb</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="georeader.readers.enmap.EnMAP.load_wavelengths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_wavelengths</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">as_reflectance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#georeader.readers.enmap.EnMAP.load_wavelengths" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load the reflectance of the given wavelengths</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>wavelengths</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[float, <span title="typing.List">List</span>[float], <span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of wavelengths to load</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_reflectance</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>return the values as reflectance rather than radiance.
Defaults to True. If False values will have units of W/m^2/SR/um == mW/m2/sr/nm (<code>self.units</code>)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="georeader.geotensor.GeoTensor" href="../geotensor_module/#georeader.geotensor.GeoTensor">GeoTensor</a>, <span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[GeoTensor, NDArray]: GeoTensor with the values in reflectance or radiance units.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any wavelength is outside the sensor's range.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>georeader/readers/enmap.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_wavelengths</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">wavelengths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">],</span>
    <span class="n">as_reflectance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoTensor</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the reflectance of the given wavelengths</span>

<span class="sd">    Args:</span>
<span class="sd">        wavelengths (Union[float, List[float], NDArray]): List of wavelengths to load</span>
<span class="sd">        as_reflectance (bool, optional): return the values as reflectance rather than radiance.</span>
<span class="sd">            Defaults to True. If False values will have units of W/m^2/SR/um == mW/m2/sr/nm (`self.units`)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[GeoTensor, NDArray]: GeoTensor with the values in reflectance or radiance units.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any wavelength is outside the sensor&#39;s range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wavelengths</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>

    <span class="c1"># Check all wavelengths are within the range of the sensor</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">wvl</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">wvl</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">wvl</span> <span class="ow">in</span> <span class="n">wavelengths</span>
        <span class="p">]</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid wavelength range, must be between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vnir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">wavelengths_loaded</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fwhm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ltoa_img</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="ow">and</span> <span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">index_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">]))</span>
            <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">])</span>
            <span class="n">wavelengths_loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">])</span>
            <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swir</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;band&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">index_band</span><span class="p">]})</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">invalids</span> <span class="o">=</span> <span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">rst</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="c1"># Convert to radiance</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_arr</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">]</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_arr</span><span class="p">[</span><span class="s2">&quot;swir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">]</span>
            <span class="n">img</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain</span> <span class="o">*</span> <span class="n">rst</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">SC_COEFF</span>
            <span class="n">img</span><span class="p">[</span><span class="n">invalids</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">]))</span>
            <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_fwhm</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">])</span>
            <span class="n">wavelengths_loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_center</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">])</span>
            <span class="n">rst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnir</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;band&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">index_band</span><span class="p">]})</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">invalids</span> <span class="o">=</span> <span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">rst</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="c1"># Convert to radiance</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_arr</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">]</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_arr</span><span class="p">[</span><span class="s2">&quot;vnir&quot;</span><span class="p">][</span><span class="n">index_band</span><span class="p">]</span>
            <span class="n">img</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain</span> <span class="o">*</span> <span class="n">rst</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">SC_COEFF</span>
            <span class="n">img</span><span class="p">[</span><span class="n">invalids</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span>

        <span class="n">ltoa_img</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ltoa_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
        <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
        <span class="n">fill_value_default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">as_reflectance</span><span class="p">:</span>
        <span class="n">thuiller</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">load_thuillier_irradiance</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">srf</span><span class="p">(</span>
            <span class="n">wavelengths_loaded</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Nanometer&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>

        <span class="n">solar_irradiance_norm</span> <span class="o">=</span> <span class="n">thuiller</span><span class="p">[</span><span class="s2">&quot;Radiance(mW/m2/nm)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="n">response</span>
        <span class="p">)</span>  <span class="c1"># mW/m$^2$/SR/nm</span>
        <span class="n">solar_irradiance_norm</span> <span class="o">/=</span> <span class="mi">1_000</span>  <span class="c1"># W/m$^2$/nm</span>

        <span class="c1"># Divide by 10 to convert from mW/m^2/SR/nm to µW /cm²/SR/nm</span>
        <span class="n">ltoa_img</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">radiance_to_reflectance</span><span class="p">(</span>
            <span class="n">ltoa_img</span><span class="p">,</span>
            <span class="n">solar_irradiance_norm</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
            <span class="n">observation_date_corr_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ltoa_img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/spaceml-org/georeader" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/georeader-spaceml" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>