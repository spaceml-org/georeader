
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="üõ∞Ô∏è Process raster data in python">
      
      
        <meta name="author" content="Gonzalo Mateo-Garc√≠a">
      
      
        <link rel="canonical" href="https://spaceml-org.github.io/georeader/Sentinel-2/convert_to_radiance/">
      
      
        <link rel="prev" href="../s2_mosaic_from_gee/">
      
      
        <link rel="next" href="../../emit_explore/">
      
      
      <link rel="icon" href="../../images/logo_georeader.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.43">
    
    
      
        <title>ToA reflectance to radiance - georeader</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="ToA reflectance to radiance - georeader" >
      
        <meta  property="og:description"  content="üõ∞Ô∏è Process raster data in python" >
      
        <meta  property="og:image"  content="https://spaceml-org.github.io/georeader/assets/images/social/Sentinel-2/convert_to_radiance.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://spaceml-org.github.io/georeader/Sentinel-2/convert_to_radiance/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="ToA reflectance to radiance - georeader" >
      
        <meta  name="twitter:description"  content="üõ∞Ô∏è Process raster data in python" >
      
        <meta  name="twitter:image"  content="https://spaceml-org.github.io/georeader/assets/images/social/Sentinel-2/convert_to_radiance.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sentinel-2-toa-reflectance-to-radiance" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="georeader" class="md-header__button md-logo" aria-label="georeader" data-md-component="logo">
      
  <img src="../../images/logo_georeader.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            georeader
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ToA reflectance to radiance
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/spaceml-org/georeader" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    spaceml-org/georeader
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="georeader" class="md-nav__button md-logo" aria-label="georeader" data-md-component="logo">
      
  <img src="../../images/logo_georeader.png" alt="logo">

    </a>
    georeader
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spaceml-org/georeader" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    spaceml-org/georeader
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/read_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    read
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/save_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    save
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/reflectance_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reflectance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/geotensor_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GeoTensor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/rasterio_reader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RasterioReader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/rasterize_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rasterize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/vectorize_module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vectorize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ee_image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ee_image
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Read overlapping rasters
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Read overlapping rasters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../read_overlapping_probav_and_sentinel2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overlapping S2 and Proba-V
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reading_overlapping_sentinel2_aviris/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overlapping S2 and AVIRIS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/tiling_and_stitching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tile and stitch AI predictions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sentinel-2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Sentinel-2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run_in_gee_image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    From Google Earth Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../read_S2_SAFE_from_bucket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    From the public bucket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explore_metadata_s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query_mosaic_s2_images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mosaic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s2_mosaic_from_gee/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mosaic from GEE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ToA reflectance to radiance
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ToA reflectance to radiance
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fetch-a-s2-image-from-gee" class="md-nav__link">
    <span class="md-ellipsis">
      Fetch a S2 image from GEE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetch-same-image-from-google-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      Fetch same image from Google bucket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fetch same image from Google bucket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-dn-to-reflectances" class="md-nav__link">
    <span class="md-ellipsis">
      Convert DN to reflectances
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetch-metadata-to-do-toa-reflectance-to-radiance-conversion" class="md-nav__link">
    <span class="md-ellipsis">
      Fetch metadata to do toa reflectance to radiance conversion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-from-the-safe-file" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata from the SAFE file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-irradiance-and-correction-factor-using-georeader" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate Irradiance and correction factor using georeader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calculate Irradiance and correction factor using georeader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#show-differences-in-solar-irradiance" class="md-nav__link">
    <span class="md-ellipsis">
      Show differences in solar irradiance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#show-relative-differences-between-the-calculated-and-official-factors" class="md-nav__link">
    <span class="md-ellipsis">
      Show relative differences between the calculated and official factors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#licence" class="md-nav__link">
    <span class="md-ellipsis">
      Licence
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hyperspectral sensors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Hyperspectral sensors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../emit_explore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMIT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simultaneous_prisma_emit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PRISMA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../enmap_with_cloudsen12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EnMAP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prisma_with_cloudsen12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PRISMA cloud detection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/error_read_write_in_remote_path/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSIL cache problem
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fetch-a-s2-image-from-gee" class="md-nav__link">
    <span class="md-ellipsis">
      Fetch a S2 image from GEE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetch-same-image-from-google-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      Fetch same image from Google bucket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fetch same image from Google bucket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-dn-to-reflectances" class="md-nav__link">
    <span class="md-ellipsis">
      Convert DN to reflectances
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetch-metadata-to-do-toa-reflectance-to-radiance-conversion" class="md-nav__link">
    <span class="md-ellipsis">
      Fetch metadata to do toa reflectance to radiance conversion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-from-the-safe-file" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata from the SAFE file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-irradiance-and-correction-factor-using-georeader" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate Irradiance and correction factor using georeader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calculate Irradiance and correction factor using georeader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#show-differences-in-solar-irradiance" class="md-nav__link">
    <span class="md-ellipsis">
      Show differences in solar irradiance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#show-relative-differences-between-the-calculated-and-official-factors" class="md-nav__link">
    <span class="md-ellipsis">
      Show relative differences between the calculated and official factors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#licence" class="md-nav__link">
    <span class="md-ellipsis">
      Licence
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="sentinel-2-toa-reflectance-to-radiance">Sentinel-2 ToA reflectance to radiance<a class="headerlink" href="#sentinel-2-toa-reflectance-to-radiance" title="Permanent link">&para;</a></h1>
<p><strong>Author</strong>: Gonzalo Mateo-Garc√≠a</p>
<p>In this notebook we show how to convert ToA reflectance from Sentinel-2 to radiance using the metadata fetched from the GEE or directly computing the conversion factors.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">ee</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">georeader</span> <span class="kn">import</span> <span class="n">plot</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>
<span class="kn">from</span> <span class="nn">georeader.readers</span> <span class="kn">import</span> <span class="n">ee_image</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">rasterio</span> <span class="kn">import</span> <span class="n">Affine</span>
<span class="kn">from</span> <span class="nn">georeader.readers</span> <span class="kn">import</span> <span class="n">S2_SAFE_reader</span>
<span class="kn">from</span> <span class="nn">georeader</span> <span class="kn">import</span> <span class="n">reflectance</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GS_NO_SIGN_REQUEST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;YES&quot;</span>

<span class="c1"># ee.Authenticate()</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="fetch-a-s2-image-from-gee">Fetch a S2 image from GEE<a class="headerlink" href="#fetch-a-s2-image-from-gee" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">collection_name</span> <span class="o">=</span> <span class="s2">&quot;COPERNICUS/S2_HARMONIZED&quot;</span>
<span class="n">tile</span> <span class="o">=</span> <span class="s2">&quot;S2A_MSIL1C_20240417T064631_N0510_R020_T40RCN_20240417T091941&quot;</span>
<span class="n">img_col</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">img_col</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">&quot;PRODUCT_ID&quot;</span><span class="p">,</span> <span class="n">tile</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">info_img</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># projgee = image.select(&quot;B2&quot;).projection().getInfo()</span>

<span class="n">aoi</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="mf">55.325</span><span class="p">,</span> <span class="mf">25.225</span><span class="p">,</span> <span class="mf">55.415</span><span class="p">,</span> <span class="mf">25.28</span><span class="p">)</span>

<span class="n">bands_0bname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">BANDS_S2_L1C</span><span class="p">)</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;B0&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_0bname</span><span class="p">]</span>
<span class="n">crs</span> <span class="o">=</span> <span class="n">info_img</span><span class="p">[</span><span class="s2">&quot;bands&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">Affine</span><span class="p">(</span><span class="o">*</span><span class="n">info_img</span><span class="p">[</span><span class="s2">&quot;bands&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;crs_transform&quot;</span><span class="p">])</span>
<span class="n">img_local</span> <span class="o">=</span> <span class="n">ee_image</span><span class="o">.</span><span class="n">export_image</span><span class="p">(</span><span class="n">info_img</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                  <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                                  <span class="n">bands_gee</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
                                  <span class="n">geometry</span><span class="o">=</span><span class="n">aoi</span><span class="p">)</span>
<span class="n">img_local</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn't match SamplesPerPixel. Defining non-color channels as ExtraSamples.
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code> 
         Transform: | 10.00, 0.00, 331260.00|
| 0.00,-10.00, 2797010.00|
| 0.00, 0.00, 1.00|
         Shape: (13, 622, 916)
         Resolution: (10.0, 10.0)
         Bounds: (331260.0, 2790790.0, 340420.0, 2797010.0)
         CRS: EPSG:32640
         fill_value_default: 0.0
        </code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="fetch-same-image-from-google-bucket">Fetch same image from Google bucket<a class="headerlink" href="#fetch-same-image-from-google-bucket" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">s2_safe_folder</span> <span class="o">=</span> <span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">s2_public_bucket_path</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">check_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File is located at: </span><span class="si">{</span><span class="n">s2_safe_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">s2obj</span> <span class="o">=</span> <span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">s2loader</span><span class="p">(</span><span class="n">s2_safe_folder</span><span class="p">,</span> <span class="n">out_res</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">s2obj</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>File is located at: gs://gcp-public-data-sentinel-2/tiles/40/R/CN/S2A_MSIL1C_20240417T064631_N0510_R020_T40RCN_20240417T091941.SAFE
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code> 
         gs://gcp-public-data-sentinel-2/tiles/40/R/CN/S2A_MSIL1C_20240417T064631_N0510_R020_T40RCN_20240417T091941.SAFE
         Transform: | 10.00, 0.00, 300000.00|
| 0.00,-10.00, 2800020.00|
| 0.00, 0.00, 1.00|
         Shape: (13, 10980, 10980)
         Resolution: (10.0, 10.0)
         Bounds: (300000.0, 2690220.0, 409800.0, 2800020.0)
         CRS: EPSG:32640
         bands: ['B01', 'B02', 'B03', 'B04', 'B05', 'B06', 'B07', 'B08', 'B8A', 'B09', 'B10', 'B11', 'B12']
         fill_value_default: 0
        </code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="convert-dn-to-reflectances">Convert DN to reflectances<a class="headerlink" href="#convert-dn-to-reflectances" title="Permanent link">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">toa_refl</span> <span class="o">=</span> <span class="n">img_local</span> <span class="o">/</span> <span class="mi">10_000</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="fetch-metadata-to-do-toa-reflectance-to-radiance-conversion">Fetch metadata to do toa reflectance to radiance conversion<a class="headerlink" href="#fetch-metadata-to-do-toa-reflectance-to-radiance-conversion" title="Permanent link">&para;</a></h2>
<p>See: <a href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_HARMONIZED#image-properties">Google Earth Engine Sentinel-2 image properties</a></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">solar_irradiance_gee</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="o">/</span><span class="mf">1_000.</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">info_img</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;SOLAR_IRRADIANCE&quot;</span><span class="p">)}</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> -&amp;gt; </span><span class="si">{</span><span class="n">solar_irradiance_gee</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;SOLAR_IRRADIANCE_</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>B1 -&gt; 1.88469
B2 -&gt; 1.9596600000000002
B3 -&gt; 1.82324
B4 -&gt; 1.51206
B5 -&gt; 1.4246400000000001
B6 -&gt; 1.28761
B7 -&gt; 1.16208
B8 -&gt; 1.04163
B8A -&gt; 0.9553200000000001
B9 -&gt; 0.81292
B10 -&gt; 0.36715
B11 -&gt; 0.24559
B12 -&gt; 0.08525
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">date_of_aquisition</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">info_img</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s2">&quot;system:time_start&quot;</span><span class="p">]</span><span class="o">/</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="n">date_of_aquisition</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>datetime.datetime(2024, 4, 17, 9, 2, 44, 342000, tzinfo=datetime.timezone.utc)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">mean_solar_zenith_angle</span> <span class="o">=</span> <span class="n">info_img</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;MEAN_SOLAR_ZENITH_ANGLE&#39;</span><span class="p">]</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">info_img</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s2">&quot;REFLECTANCE_CONVERSION_CORRECTION&quot;</span><span class="p">]</span>
<span class="n">mean_solar_zenith_angle</span><span class="p">,</span> <span class="n">U</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>(22.6291255460394, 0.994777427364766)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">observation_date_corr_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">mean_solar_zenith_angle</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">U</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">observation_date_corr_factor</span><span class="p">)</span>

<span class="n">rad</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">reflectance_to_radiance</span><span class="p">(</span><span class="n">toa_refl</span><span class="p">,</span> 
                                          <span class="n">solar_irradiance</span> <span class="o">=</span> <span class="p">[</span><span class="n">solar_irradiance_gee</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;SOLAR_IRRADIANCE_</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">],</span>
                                          <span class="n">observation_date_corr_factor</span><span class="o">=</span><span class="n">observation_date_corr_factor</span><span class="p">)</span>
<span class="n">rad</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>3.4214902841464196
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code> 
         Transform: | 10.00, 0.00, 331260.00|
| 0.00,-10.00, 2797010.00|
| 0.00, 0.00, 1.00|
         Shape: (13, 622, 916)
         Resolution: (10.0, 10.0)
         Bounds: (331260.0, 2790790.0, 340420.0, 2797010.0)
         CRS: EPSG:32640
         fill_value_default: 0.0
        </code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="metadata-from-the-safe-file">Metadata from the <code>SAFE</code> file<a class="headerlink" href="#metadata-from-the-safe-file" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">s2obj</span><span class="o">.</span><span class="n">read_metadata_tl</span><span class="p">()</span>
<span class="n">solar_irr_safe</span> <span class="o">=</span> <span class="n">s2obj</span><span class="o">.</span><span class="n">solar_irradiance</span><span class="p">()</span>
<span class="n">U_save</span> <span class="o">=</span> <span class="n">s2obj</span><span class="o">.</span><span class="n">scale_factor_U</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SZA: </span><span class="si">{</span><span class="n">s2obj</span><span class="o">.</span><span class="n">mean_sza</span><span class="si">}</span><span class="s2"> U: </span><span class="si">{</span><span class="n">U_save</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">solar_irr_safe</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_0bname</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> -&amp;gt; </span><span class="si">{</span><span class="n">solar_irr_safe</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>SZA: 22.6291255460394 U: 0.994777427364766
B01 -&gt; 1.88469
B02 -&gt; 1.9596600000000002
B03 -&gt; 1.82324
B04 -&gt; 1.51206
B05 -&gt; 1.4246400000000001
B06 -&gt; 1.28761
B07 -&gt; 1.16208
B08 -&gt; 1.04163
B8A -&gt; 0.9553200000000001
B09 -&gt; 0.81292
B10 -&gt; 0.36715
B11 -&gt; 0.24559
B12 -&gt; 0.08525
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="calculate-irradiance-and-correction-factor-using-georeader">Calculate Irradiance and correction factor using georeader<a class="headerlink" href="#calculate-irradiance-and-correction-factor-using-georeader" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">satellite</span> <span class="o">=</span> <span class="n">tile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># S2A, S2B or S2C</span>

<span class="n">srf_satellite</span> <span class="o">=</span> <span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">read_srf</span><span class="p">(</span><span class="n">satellite</span><span class="p">)</span>
<span class="n">irradiances</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">integrated_irradiance</span><span class="p">(</span><span class="n">srf_satellite</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1_000</span> <span class="c1"># Convert from mW/m2/sr/nm to W/m2/sr/nm</span>
<span class="n">solar_irradiance_calc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">srf_satellite</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">irradiances</span><span class="p">))</span>
<span class="n">solar_irradiance_calc</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>/home/gonzalo/mambaforge/envs/marsmlpy312/lib/python3.12/site-packages/openpyxl/worksheet/_reader.py:329: UserWarning: Unknown extension is not supported and will be removed
  warn(msg)
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{'B01': 1.884835040894774,
 'B02': 1.9585911091822743,
 'B03': 1.8241227793692252,
 'B04': 1.5121602113335022,
 'B05': 1.424787320092646,
 'B06': 1.2873886799012966,
 'B07': 1.1565783864975936,
 'B08': 0.9709833673468558,
 'B8A': 0.9532926414812208,
 'B09': 0.7941054027444697,
 'B10': 0.36748198011502775,
 'B11': 0.24593390086371422,
 'B12': 0.0856471195539582}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="show-differences-in-solar-irradiance">Show differences in solar irradiance<a class="headerlink" href="#show-differences-in-solar-irradiance" title="Permanent link">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_0bname</span><span class="p">:</span>
    <span class="n">bnozero</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;B0&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> -&amp;gt; GEE: </span><span class="si">{</span><span class="n">solar_irradiance_gee</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;SOLAR_IRRADIANCE_</span><span class="si">{</span><span class="n">bnozero</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> SAFE: </span><span class="si">{</span><span class="n">solar_irr_safe</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Calc: </span><span class="si">{</span><span class="n">solar_irradiance_calc</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>B01 -&gt; GEE: 1.88469 SAFE: 1.8847 Calc: 1.8848
B02 -&gt; GEE: 1.9596600000000002 SAFE: 1.9597 Calc: 1.9586
B03 -&gt; GEE: 1.82324 SAFE: 1.8232 Calc: 1.8241
B04 -&gt; GEE: 1.51206 SAFE: 1.5121 Calc: 1.5122
B05 -&gt; GEE: 1.4246400000000001 SAFE: 1.4246 Calc: 1.4248
B06 -&gt; GEE: 1.28761 SAFE: 1.2876 Calc: 1.2874
B07 -&gt; GEE: 1.16208 SAFE: 1.1621 Calc: 1.1566
B08 -&gt; GEE: 1.04163 SAFE: 1.0416 Calc: 0.9710
B8A -&gt; GEE: 0.9553200000000001 SAFE: 0.9553 Calc: 0.9533
B09 -&gt; GEE: 0.81292 SAFE: 0.8129 Calc: 0.7941
B10 -&gt; GEE: 0.36715 SAFE: 0.3671 Calc: 0.3675
B11 -&gt; GEE: 0.24559 SAFE: 0.2456 Calc: 0.2459
B12 -&gt; GEE: 0.08525 SAFE: 0.0853 Calc: 0.0856
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">observation_date_corr_factor_calc</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">observation_date_correction_factor</span><span class="p">(</span><span class="n">img_local</span><span class="o">.</span><span class="n">footprint</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                                   <span class="n">date_of_acquisition</span><span class="o">=</span><span class="n">date_of_aquisition</span><span class="p">)</span>
<span class="n">observation_date_corr_factor_calc</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>3.327182058670046</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">rad2</span> <span class="o">=</span> <span class="n">reflectance</span><span class="o">.</span><span class="n">reflectance_to_radiance</span><span class="p">(</span><span class="n">toa_refl</span><span class="p">,</span> 
                                          <span class="n">solar_irradiance</span> <span class="o">=</span> <span class="p">[</span><span class="n">solar_irradiance_calc</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_0bname</span><span class="p">],</span>
                                          <span class="n">observation_date_corr_factor</span><span class="o">=</span><span class="n">observation_date_corr_factor</span><span class="p">)</span>
<span class="n">rad2</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code> 
         Transform: | 10.00, 0.00, 331260.00|
| 0.00,-10.00, 2797010.00|
| 0.00, 0.00, 1.00|
         Shape: (13, 622, 916)
         Resolution: (10.0, 10.0)
         Bounds: (331260.0, 2790790.0, 340420.0, 2797010.0)
         CRS: EPSG:32640
         fill_value_default: 0.0
        </code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="show-relative-differences-between-the-calculated-and-official-factors">Show relative differences between the calculated and official factors<a class="headerlink" href="#show-relative-differences-between-the-calculated-and-official-factors" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands_0bname</span><span class="p">):</span>
    <span class="n">rad_b_or</span> <span class="o">=</span> <span class="n">rad</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;band&quot;</span><span class="p">:</span><span class="n">i</span><span class="p">})</span>
    <span class="n">rad_b_2</span> <span class="o">=</span> <span class="n">rad2</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s2">&quot;band&quot;</span><span class="p">:</span><span class="n">i</span><span class="p">})</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">rad_b_or</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="n">rad_b_2</span><span class="o">.</span><span class="n">values</span>
    <span class="n">mean_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
    <span class="n">std_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">mean_ratio</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">std_ratio</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>B01 0.9999 0.000000
B02 1.0005 0.000000
B03 0.9995 0.000000
B04 0.9999 0.000000
B05 0.9999 0.000000
B06 1.0002 0.000000
B07 1.0048 0.000000
B08 1.0728 0.000000
B8A 1.0021 0.000000
B09 1.0237 0.000000
B10 0.9991 0.000000
B11 0.9986 0.000000
B12 0.9954 0.000000
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="licence">Licence<a class="headerlink" href="#licence" title="Permanent link">&para;</a></h2>
<p>The georeader package is published under a <a href="https://www.gnu.org/licenses/lgpl-3.0.en.html">GNU Lesser GPL v3 licence</a></p>
<p><code>georeader</code> tutorials and notebooks are released under a <a href="https://creativecommons.org/licenses/by-nc/4.0/legalcode.txt">Creative Commons non-commercial licence</a>.</p>
<p>If you find this work useful please cite:</p>
<div class="highlight"><pre><span></span><code>@article{portales-julia_global_2023,
    title = {Global flood extent segmentation in optical satellite images},
    volume = {13},
    issn = {2045-2322},
    doi = {10.1038/s41598-023-47595-7},
    number = {1},
    urldate = {2023-11-30},
    journal = {Scientific Reports},
    author = {Portal√©s-Juli√†, Enrique and Mateo-Garc√≠a, Gonzalo and Purcell, Cormac and G√≥mez-Chova, Luis},
    month = nov,
    year = {2023},
    pages = {20316},
}
</code></pre></div>
</div>
</div>
</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/spaceml-org/georeader" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/georeader-spaceml" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>